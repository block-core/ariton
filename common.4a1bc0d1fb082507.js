"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2076],{58249:(W,M,l)=>{l.d(M,{K:()=>P});var g=l(10467),e=l(93953),T=l(34635),C=l(50296),E=l(69371),v=l(71943),n=l(22312),h=l(81317),p=l(68530);let P=(()=>{class f{constructor(){this.requests=(0,e.vPA)([]),this.friends=(0,e.vPA)([]),this.identity=(0,e.WQX)(T.K),this.connection=(0,e.WQX)(h.K),this.app=(0,e.WQX)(C.d)}createRequest(r){var t=this;return(0,g.A)(function*(){const i=yield v.l6.create({type:"FriendshipCredential",issuer:t.identity.did,subject:r,data:null});console.log("VC:",i);const d=yield t.identity.activeAgent().identity.get({didUri:t.identity.did}),c=yield i.sign({did:d.did});return console.log("VC JWT:",c),{record:(yield t.connection.request(r,{app:"friends",title:"I want to be your friend.",vc:c},h.X.Friend)).record}})()}accept(r){var t=this;return(0,g.A)(function*(){const i=r.data.vc;if(!i)throw new Error("The incoming VC is missing.");if(console.log("signedVcJwt:",i),!i)return;try{yield v.l6.verify({vcJwt:i})}catch(A){return void console.error("Error verifying VC:",A)}const d=v.l6.parseJwt({vcJwt:i}),c=d.issuer;if(d.issuer!=r.record.author)return void console.error("VC issuer is different than data record author");console.log("Friend request validated");const m=yield v.l6.create({type:n.eE.friendship,issuer:t.identity.did,subject:c,data:{vc:i}});console.log("TWO WAY VC:",m);const o=yield t.identity.activeAgent().identity.get({didUri:t.identity.did}),_=yield m.sign({did:o.did});console.log("TWO WAY VC JWT:",_);const{record:s}=yield t.identity.web5.dwn.records.create({data:_,message:{schema:n.eE.friendship,dataFormat:n.eE.format,published:!1}});console.log("TWO WAY VC RECORD:",s),s.send(t.identity.did);const a={vc:_,app:"friends"},u={type:h.X.Credential},{status:y,record:D}=yield t.identity.web5.dwn.records.create({data:a,store:!1,message:{tags:u,recipient:c,protocol:p.Q.protocol,protocolPath:"request",schema:p.Q.types.request.schema,dataFormat:p.Q.types.request.dataFormats[0]}});console.log("Request create status:",y);const{status:O}=yield D.send(c);return t.app.openSnackBar(202!==O.code?`Friend request failed.Code: ${O.code}, Details: ${O.detail}.`:"Friend request accepted"),{record:D,data:a,id:D.id}})()}reject(r){var t=this;return(0,g.A)(function*(){console.log("Rejecting request:",r);const i=r.record.recipient==t.identity.did?r.record.author:r.record.recipient;console.log("Target DID:",i),console.log("this.identity.did:",t.identity.did),console.log("entry.record.recipient:",r.record.recipient),console.log("entry.record.author:",r.record.author);const{status:d}=yield r.record.delete(),{status:c}=yield r.record.send(i);console.log("Delete status:",d),console.log("deleteSendStatus:",c),t.requests.update(m=>m.filter(o=>o!==r))})()}processFriends(){var r=this;return(0,g.A)(function*(){var{records:t}=yield r.identity.web5.dwn.records.query({message:{filter:{protocol:n.iU.uri,schema:E.Q.types.credential.schema,dataFormat:E.Q.types.credential.dataFormats[0]}}});console.log("VC Records:",t);for(const i of t){console.log("Record:",i);const d=yield i.data.json();console.log("JSON:",d);try{yield v.l6.verify({vcJwt:d.vc})}catch(_){console.error("Error verifying VC:",_),console.log("THIS REQUEST SHOULD BE DELETED FROM DWN",i.id)}const c=v.l6.parseJwt({vcJwt:d.vc});console.log("PARSED INVCOMING VC:",c),console.log("vc.issuer === this.identity.did:",c.issuer===r.identity.did);const{record:m}=yield r.identity.web5.dwn.records.create({data:d.vc,message:{schema:n.eE.friendship,dataFormat:n.eE.format,published:!1}});console.log("TWO WAY VC RECORD:",m);const{status:o}=yield m.send(r.identity.did);console.log("Record sent:",o,m),yield i?.delete()}})()}loadFriends(){var r=this;return(0,g.A)(function*(){var{records:t}=yield r.identity.web5.dwn.records.query({message:{filter:{schema:n.eE.friendship,dataFormat:n.eE.format}}});if(console.log("Friend VCs:"),console.log(t),r.friends.set([]),t)for(const c of t){let m=yield c.data.text(),o=v.l6.parseJwt({vcJwt:m}),_=o.issuer;o.issuer==r.identity.did&&(_=v.l6.parseJwt({vcJwt:o.vcDataModel.credentialSubject.vc}).issuer);let s={record:c,data:{did:_}};r.friends.update(a=>[...a,s]),console.log("All friends:",r.friends())}})()}static#e=this.\u0275fac=function(t){return new(t||f)};static#t=this.\u0275prov=e.jDH({token:f,factory:f.\u0275fac,providedIn:"root"})}return f})()},69226:(W,M,l)=>{l.d(M,{x:()=>C});var g=l(10467),e=l(93953),T=l(50296);let C=(()=>{class E{constructor(){this.appService=(0,e.WQX)(T.d),this.loaded=(0,e.vPA)(!1),this.bsn={tokens:[],sources:[],accounts:[],tags:[],accounts_filtered:[]},(0,e.QZP)(()=>{this.appService.initialized()&&this.load()})}shorten(n){return n.substring(0,5)+"..."+n.substring(n.length-5)}filter(n){this.bsn.accounts_filtered=n&&0!=n.length?this.bsn.accounts.filter(h=>h.tags.some(p=>n.includes(p.id))):this.bsn.accounts}load(){var n=this;return(0,g.A)(function*(){var h=yield fetch("https://bsn.mtla.me/json");if(h.ok){var p=yield h.json();n.updated=p.createDate;let P=p.knownTokens.map(t=>{const[i,d]=t.split("-");return{id:d,name:i,short:n.shorten(d)}}),f=p.usedSources.map(t=>{const[i,d]=t.split("-");return{id:d,name:i,short:n.shorten(d)}}),R=Object.entries(p.accounts).map(([t,i])=>({id:t,short:n.shorten(t),balances:i.balances,profile:i.profile,tags:i.tags?Object.entries(i.tags).map(([d,c])=>({id:d,value:c})):[]}));n.bsn.tokens=P,n.bsn.sources=f,n.bsn.accounts=R;const r=new Set;R.forEach(t=>{t.tags.forEach(i=>{r.add(i.id)})}),n.bsn.tags=Array.from(r).sort(),n.bsn.accounts_filtered=n.bsn.accounts,n.loaded.set(!0)}})()}static#e=this.\u0275fac=function(h){return new(h||E)};static#t=this.\u0275prov=e.jDH({token:E,factory:E.\u0275fac,providedIn:"root"})}return E})()},60385:(W,M,l)=>{l.d(M,{w:()=>m});var g=l(10467),e=l(93953),T=l(34635),C=l(25596),E=l(39434),v=l(345),n=l(78013),h=l(33347),p=l(14823),P=l(30046);const f=o=>["/profile",o];function R(o,_){if(1&o&&(e.nrm(0,"img",0),e.nI1(1,"safeResourceUrl")),2&o){let s;const a=e.XpG();e.Y8G("routerLink",e.eq3(4,f,null==(s=a.data().profile)?null:s.did))("src",e.bMT(1,2,a.data().avatar),e.B4B)}}function r(o,_){if(1&o&&e.nrm(0,"img",1),2&o){let s;const a=e.XpG();e.Y8G("routerLink",e.eq3(2,f,null==(s=a.data().profile)?null:s.did))("src","/avatar-placeholder.png",e.B4B)}}function t(o,_){if(1&o&&e.EFF(0),2&o){let s;const a=e.XpG(2);e.SpI(" (",null==(s=a.data().profile)?null:s.title,") ")}}function i(o,_){if(1&o&&(e.j41(0,"a",3),e.EFF(1),e.DNE(2,t,1,1),e.k0s()),2&o){let s,a,u;const y=e.XpG();e.Y8G("routerLink",e.eq3(3,f,null==(s=y.data().profile)?null:s.did)),e.R7$(),e.SpI("",null==(a=y.data().profile)?null:a.name," "),e.R7$(),e.vxM(null!=(u=y.data().profile)&&u.title?2:-1)}}function d(o,_){if(1&o&&e.EFF(0),2&o){let s;const a=e.XpG(2);e.SpI(" (",null==(s=a.data().profile)?null:s.title,") ")}}function c(o,_){if(1&o&&(e.j41(0,"em")(1,"a",3),e.EFF(2,"No name set "),e.DNE(3,d,1,1),e.k0s()()),2&o){let s,a;const u=e.XpG();e.R7$(),e.Y8G("routerLink",e.eq3(2,f,null==(s=u.data().profile)?null:s.did)),e.R7$(2),e.vxM(null!=(a=u.data().profile)&&a.title?3:-1)}}let m=(()=>{class o{constructor(){this.identity=(0,e.WQX)(T.K),this.profile=(0,e.WQX)(E.p),this.sanitizer=(0,e.WQX)(v.up),this.did=e.hFB.required(),this.data=(0,e.vPA)({})}ngAfterViewInit(){var s=this;return(0,g.A)(function*(){if(s.did()){const a=yield s.profile.loadProfile(s.did());console.log(a),s.data.set(a)}})()}static#e=this.\u0275fac=function(a){return new(a||o)};static#t=this.\u0275cmp=e.VBU({type:o,selectors:[["app-profile-header"]],inputs:{did:[1,"did"]},standalone:!0,features:[e.aNF],decls:10,vars:9,consts:[["mat-card-avatar","","onerror","this.src='/avatar-placeholder.png';this.onerror='';",1,"profile-thumbnail",3,"routerLink","src"],["mat-card-avatar","",1,"profile-thumbnail",3,"routerLink","src"],[1,"profile-header-title"],[3,"routerLink"],[1,"profile-header-subtitle"],[3,"routerLink","matTooltip"]],template:function(a,u){if(1&a&&(e.DNE(0,R,2,6,"img",0)(1,r,1,4,"img",1),e.j41(2,"div")(3,"div",2),e.DNE(4,i,3,5,"a",3)(5,c,4,4,"em"),e.k0s(),e.j41(6,"div",4)(7,"a",5),e.EFF(8),e.nI1(9,"did"),e.k0s()()()),2&a){let y,D,O,A;e.vxM(u.data().avatar?0:1),e.R7$(4),e.vxM(null!=(y=u.data().profile)&&y.name?4:5),e.R7$(3),e.Y8G("routerLink",e.eq3(7,f,null==(D=u.data().profile)?null:D.did))("matTooltip",null==(O=u.data().profile)?null:O.did),e.R7$(),e.JRh(e.bMT(9,5,null==(A=u.data().profile)?null:A.did))}},dependencies:[P.iI,P.Wk,p.uc,p.oV,C.Hu,C.QG,n.d,h.k],styles:[".profile-thumbnail[_ngcontent-%COMP%]{cursor:pointer;border-radius:50%;margin-right:1em}a[_ngcontent-%COMP%]{text-decoration:none}a[_ngcontent-%COMP%]:hover{text-decoration:underline}[_nghost-%COMP%]{display:flex}.profile-header-title[_ngcontent-%COMP%]{font-size:1.4em}.profile-header-subtitle[_ngcontent-%COMP%]{font-size:1em}"]})}return o})()}}]);