"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3446],{63446:(et,j,o)=>{o.r(j),o.d(j,{ChatComponent:()=>tt});var c=o(10467),t=o(93953),u=o(89417),M=o(88834),G=o(65571),P=o(53719),k=o(99213),E=o(99631),I=o(36815),Q=o(3902),y=o(60177),F=o(59115),R=o(55911),O=o(14823),S=o(99327),C=o(18498),b=o(34635),D=o(31439),p=o(62060),x=o(39434),w=o(345);let X=(()=>{class n{constructor(e){this.el=e,this.did2=!1,this.appProfileImage=t.hFB.required(),this.identity=(0,t.WQX)(b.K),this.profile=(0,t.WQX)(x.p),this.sanitizer=(0,t.WQX)(w.up)}ngAfterViewInit(){var e=this;return(0,c.A)(function*(){if(e.appProfileImage()){const i=yield e.profile.loadProfile(e.appProfileImage()),a=i.avatar;console.log(i),e.el.nativeElement.src=a,e.el.nativeElement.onerror="this.src='/avatar-placeholder.png';this.onerror='';"}})()}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(t.aKT))};static#e=this.\u0275dir=t.FsC({type:n,selectors:[["","appProfileImage",""]],inputs:{did2:"did2",appProfileImage:[1,"appProfileImage"]},standalone:!0})}return n})(),Y=(()=>{class n{constructor(e){this.el=e,this.did2=!1,this.appProfileName=t.hFB.required(),this.identity=(0,t.WQX)(b.K),this.profile=(0,t.WQX)(x.p),this.sanitizer=(0,t.WQX)(w.up)}ngAfterViewInit(){var e=this;return(0,c.A)(function*(){if(e.appProfileName()){const i=yield e.profile.loadProfile(e.appProfileName());let a=e.appProfileName();i&&i.profile&&i.profile.name&&(a=i.profile.name),e.el.nativeElement.innerText=a}})()}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(t.aKT))};static#e=this.\u0275dir=t.FsC({type:n,selectors:[["","appProfileName",""]],inputs:{did2:"did2",appProfileName:[1,"appProfileName"]},standalone:!0})}return n})();var N=o(62590),$=o(9183),A=o(22312),T=o(37413),B=o(71997);const z=()=>["/profile",""],J=n=>["/app","chat",n],W=n=>({"message-inbound":n}),V=n=>({"panel-background":n});function _(n,f){if(1&n&&(t.j41(0,"a",7)(1,"div"),t.nrm(2,"img",24),t.k0s(),t.j41(3,"div",25)(4,"div",26),t.nrm(5,"div",27),t.j41(6,"div",28),t.EFF(7),t.nI1(8,"date"),t.k0s()(),t.j41(9,"div",29),t.EFF(10),t.k0s()()()),2&n){const e=f.$implicit;t.Y8G("routerLink",t.eq3(8,J,e.did)),t.R7$(2),t.Y8G("appProfileImage",e.did),t.R7$(3),t.Y8G("appProfileName",e.did),t.R7$(2),t.JRh(t.i5U(8,5,e.timestamp,"HH:mm")),t.R7$(3),t.JRh(e.text)}}function U(n,f){if(1&n&&(t.j41(0,"div"),t.EFF(1),t.k0s()),2&n){const e=t.XpG();t.R7$(),t.JRh(e.selectedProfile().profile.name)}}function L(n,f){if(1&n&&(t.j41(0,"div",9),t.EFF(1),t.k0s()),2&n){const e=t.XpG();t.Y8G("matTooltip",e.selectedProfile().profile.did),t.R7$(),t.JRh(e.selectedProfile().profile.did)}}function H(n,f){if(1&n&&(t.j41(0,"div",16),t.EFF(1),t.k0s()),2&n){const e=f.$implicit;t.Y8G("matTooltip",e.data.timestamp)("ngClass",t.eq3(3,W,"out"==e.direction)),t.R7$(),t.SpI(" ",e.data.text," ")}}function K(n,f){1&n&&t.nrm(0,"mat-spinner")}function Z(n,f){if(1&n&&(t.j41(0,"div")(1,"strong"),t.EFF(2),t.k0s()(),t.j41(3,"div"),t.EFF(4),t.k0s(),t.nrm(5,"br")(6,"mat-divider")(7,"br"),t.j41(8,"div"),t.EFF(9),t.k0s(),t.j41(10,"div",31),t.EFF(11,"Title"),t.k0s(),t.j41(12,"div"),t.EFF(13),t.k0s(),t.j41(14,"div",31),t.EFF(15,"Bio"),t.k0s(),t.j41(16,"div"),t.EFF(17),t.k0s(),t.j41(18,"div",31),t.EFF(19,"Location"),t.k0s(),t.j41(20,"div",9),t.EFF(21),t.k0s(),t.j41(22,"div",31),t.EFF(23,"Identifier"),t.k0s()),2&n){const e=t.XpG(2);t.R7$(2),t.JRh(e.selectedProfile().profile.name),t.R7$(2),t.JRh(e.selectedProfile().profile.status),t.R7$(5),t.JRh(e.selectedProfile().profile.title),t.R7$(4),t.JRh(e.selectedProfile().profile.bio),t.R7$(4),t.JRh(e.selectedProfile().profile.location),t.R7$(3),t.Y8G("matTooltip",e.selectedProfile().profile.did),t.R7$(),t.JRh(e.selectedProfile().profile.did)}}function q(n,f){if(1&n){const e=t.RV6();t.j41(0,"div",23)(1,"mat-toolbar")(2,"span"),t.EFF(3,"User Info"),t.k0s(),t.nrm(4,"span",4),t.j41(5,"button",11),t.bIt("click",function(){t.eBV(e);const a=t.XpG();return t.Njj(a.closeDetails())}),t.j41(6,"mat-icon"),t.EFF(7,"close"),t.k0s()()(),t.j41(8,"div",30),t.DNE(9,Z,24,7),t.k0s()()}if(2&n){const e=t.XpG();t.Y8G("ngClass",t.eq3(2,V,e.detailsBig())),t.R7$(9),t.vxM(e.selectedProfile()?9:-1)}}let tt=(()=>{class n{constructor(){var e=this;this.viewStyle=(0,t.geq)("card"),this.layout=(0,t.WQX)(I.Y),this.details=(0,t.vPA)(!0),this.detailsBig=(0,t.vPA)(!1),this.identity=(0,t.WQX)(b.K),this.app=(0,t.WQX)(D.d),this.breakpointObserver=(0,t.WQX)(S.QP),this.fullsize=!1,this.route=(0,t.WQX)(C.nX),this.profile=(0,t.WQX)(x.p),this.selectedChat=(0,t.vPA)(null),this.selectedProfile=(0,t.vPA)(null),this.loading=(0,t.vPA)(!1),this.messages=(0,t.vPA)([]),this.message="",this.chats=(0,t.vPA)([]),this.threads=(0,t.vPA)([]),this.route.paramMap.subscribe(a=>{this.layout.disableScrolling(),this.selectedChat.set(a.get("id"))}),(0,t.QZP)((0,c.A)(function*(){e.app.initialized()&&(yield e.load())})),(0,t.QZP)((0,c.A)(function*(){if(e.selectedChat()&&e.app.initialized()){if(e.selectedProfile.set(null),e.messages.set([]),":id"===e.selectedChat())return;e.loading.set(!0);const a=yield e.profile.loadProfile(e.selectedChat());e.selectedProfile.set(a),yield e.loadMessages(e.selectedChat()),e.loading.set(!1)}}),{allowSignalWrites:!0}),this.breakpointObserver.observe(["(max-width: 1024px)"]).subscribe(a=>{console.log("MATCHES:",a.matches),a.matches?(this.details.set(!1),this.detailsBig.set(!0)):this.detailsBig.set(!1)})}ngOnInit(){var e=this;return(0,c.A)(function*(){e.layout.disableScrolling(),e.layout.resetActions(),e.layout.marginOff()})()}ngOnDestroy(){this.layout.enableScrolling()}loadMessages(e){var i=this;return(0,c.A)(function*(){i.messages.set([]);const a={recipients:e};var{records:s}=yield i.identity.web5.dwn.records.query({message:{filter:{tags:a,protocol:p.Q.protocol,schema:p.Q.types.message.schema,dataFormat:p.Q.types.message.dataFormats[0]},dateSort:N.U0.CreatedAscending}});if(s)for(const l of s){let d=yield l.data.json(),m={record:l,data:d};l.author==i.identity.did&&(m.direction="out"),i.messages.update(r=>[...r,m])}})()}load(){var e=this;return(0,c.A)(function*(){var{records:i}=yield e.identity.web5.dwn.records.query({message:{filter:{protocol:p.Q.protocol,schema:p.Q.types.message.schema,dataFormat:p.Q.types.message.dataFormats[0]}}});if(e.chats.set([]),e.threads.set([]),i)for(const r of i){let h=yield r.data.json(),v={record:r,data:h};r.author==e.identity.did&&(v.direction="out"),e.chats.update(g=>[...g,v])}const a=e.chats().map(r=>r.data.recipient),s=e.chats().map(r=>r.data.sender),l=yield e.loadFriends(),d=Array.from(new Set([...a,...s,...l])),m=e.chats().sort((r,h)=>r.data.timestamp>h.data.timestamp?-1:1);d.map(function(){var r=(0,c.A)(function*(h){const v=m.find(g=>g.data.recipient==h||g.data.sender==h);h!=e.identity.did&&e.threads.update(g=>[...g,{did:h,text:v?.data.text,timestamp:v?.data.timestamp}])});return function(h){return r.apply(this,arguments)}}())})()}loadFriends(){var e=this;return(0,c.A)(function*(){var{records:i}=yield e.identity.web5.dwn.records.query({message:{filter:{schema:A.eE.friendship,dataFormat:A.eE.format}}});let a=[];if(i)for(const s of i){let l=yield s.data.text(),d=T.l6.parseJwt({vcJwt:l}),m=d.issuer;d.issuer==e.identity.did&&(m=T.l6.parseJwt({vcJwt:d.vcDataModel.credentialSubject.vc}).issuer),a.push(m)}return a})()}toggleDetails(){this.details.set(!this.details())}closeDetails(){this.details.set(!1)}submitMessage(){var e=this;return(0,c.A)(function*(){if(e.message.trim()){let i=e.selectedProfile().did;const s={text:e.message,sender:e.identity.did,recipient:i,timestamp:(new Date).toISOString()},l={recipients:[e.identity.did,i]},{record:d}=yield e.identity.web5.dwn.records.write({data:s,message:{tags:l,protocol:p.Q.protocol,protocolPath:"message",schema:p.Q.types.message.schema,recipient:i}});d?.send(i);let m={record:d,data:s,direction:"out"};e.messages.update(r=>[...r,m]),e.message=""}})()}deleteChat(){var e=this;return(0,c.A)(function*(){for(let i of e.messages())yield i.record.delete();e.messages.set([])})()}newChat(){var e=this;return(0,c.A)(function*(){let i=e.selectedProfile().did;const s={text:"Hello, how are you?",sender:e.identity.did,recipient:i,timestamp:(new Date).toISOString()},l={recipients:[e.identity.did,i]},{record:d}=yield e.identity.web5.dwn.records.write({data:s,message:{tags:l,protocol:p.Q.protocol,protocolPath:"message",schema:p.Q.types.message.schema,recipient:i}});let m={record:d,data:s};return e.messages.update(r=>[...r,m]),d})()}static#t=this.\u0275fac=function(i){return new(i||n)};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["app-chat"]],inputs:{viewStyle:[1,"viewStyle"],fullsize:"fullsize"},outputs:{viewStyle:"viewStyleChange"},standalone:!0,features:[t.aNF],decls:90,vars:17,consts:[["chatMenu","matMenu"],["menu","matMenu"],[1,"chat-container"],[1,"left-panel"],[1,"toolbar-spacer"],["type","search","placeholder","Filter chats",1,"search-input"],[1,"panel-content","panel-content-chats"],["routerLinkActive","router-link-active",1,"chat-link",3,"routerLink"],[1,"middle-panel"],[1,"ellipsis",3,"matTooltip"],["mat-icon-button","",3,"matMenuTriggerFor"],["mat-icon-button","",3,"click"],["mat-menu-item","",3,"routerLink"],["mat-menu-item","",3,"disabled"],["mat-menu-item","",3,"click"],[1,"panel-content","panel-content-messages"],[1,"message",3,"matTooltip","ngClass"],[1,"chat-input"],["mat-icon-button","",1,"chat-action",3,"matMenuTriggerFor"],["subscriptSizing","dynamic",1,"chat-message-input"],["matInput","","placeholder","Message...",3,"ngModelChange","keydown.enter","ngModel"],["matSuffix",""],["mat-icon-button","",1,"chat-action",3,"disabled"],[1,"right-panel",3,"ngClass"],[1,"chat-icon",3,"appProfileImage"],[1,"chat-details"],[1,"chat-info"],[1,"chat-info-name",3,"appProfileName"],[1,"chat-time"],[1,"chat-text"],[1,"panel-content","profile-details"],[1,"dimmed","profile-info-label"]],template:function(i,a){if(1&i){const s=t.RV6();t.j41(0,"div",2)(1,"div",3)(2,"mat-toolbar")(3,"span",4),t.nrm(4,"input",5),t.k0s()(),t.j41(5,"div",6),t.Z7z(6,_,11,10,"a",7,t.fX1),t.k0s()(),t.j41(8,"div",8)(9,"mat-toolbar"),t.DNE(10,U,2,1,"div")(11,L,2,2,"div",9),t.nrm(12,"span",4),t.j41(13,"button",10)(14,"mat-icon"),t.EFF(15,"more_vert"),t.k0s()(),t.j41(16,"button",11),t.bIt("click",function(){return t.eBV(s),t.Njj(a.toggleDetails())}),t.j41(17,"mat-icon"),t.EFF(18,"view_sidebar"),t.k0s()()(),t.j41(19,"mat-menu",null,0)(21,"button",12)(22,"mat-icon"),t.EFF(23,"account_circle"),t.k0s(),t.j41(24,"span"),t.EFF(25,"View profile"),t.k0s()(),t.j41(26,"button",13)(27,"mat-icon"),t.EFF(28,"done"),t.k0s(),t.j41(29,"span"),t.EFF(30,"Mark as unread"),t.k0s()(),t.nrm(31,"mat-divider"),t.j41(32,"button",13)(33,"mat-icon"),t.EFF(34,"block"),t.k0s(),t.j41(35,"span"),t.EFF(36,"Block"),t.k0s()(),t.j41(37,"button",13)(38,"mat-icon"),t.EFF(39,"archive"),t.k0s(),t.j41(40,"span"),t.EFF(41,"Archive chat"),t.k0s()(),t.j41(42,"button",14),t.bIt("click",function(){return t.eBV(s),t.Njj(a.deleteChat())}),t.j41(43,"mat-icon"),t.EFF(44,"delete"),t.k0s(),t.j41(45,"span"),t.EFF(46,"Delete chat"),t.k0s()()(),t.j41(47,"div",15),t.Z7z(48,H,2,5,"div",16,t.fX1),t.DNE(50,K,1,0,"mat-spinner"),t.k0s(),t.j41(51,"div",17)(52,"button",18)(53,"mat-icon"),t.EFF(54,"add_circle"),t.k0s()(),t.j41(55,"mat-menu",null,1)(57,"button",13)(58,"mat-icon"),t.EFF(59,"attach_money"),t.k0s(),t.j41(60,"span"),t.EFF(61,"Send money"),t.k0s()(),t.j41(62,"button",13)(63,"mat-icon"),t.EFF(64,"video_camera_back"),t.k0s(),t.j41(65,"span"),t.EFF(66,"Capture video"),t.k0s()(),t.j41(67,"button",13)(68,"mat-icon"),t.EFF(69,"photo_camera_front"),t.k0s(),t.j41(70,"span"),t.EFF(71,"Capture photo"),t.k0s()(),t.j41(72,"button",13)(73,"mat-icon"),t.EFF(74,"attachment"),t.k0s(),t.j41(75,"span"),t.EFF(76,"Attach a file"),t.k0s()(),t.j41(77,"button",13)(78,"mat-icon"),t.EFF(79,"add_a_photo"),t.k0s(),t.j41(80,"span"),t.EFF(81,"Attach a photo"),t.k0s()()(),t.j41(82,"mat-form-field",19)(83,"input",20),t.mxI("ngModelChange",function(d){return t.eBV(s),t.DH7(a.message,d)||(a.message=d),t.Njj(d)}),t.bIt("keydown.enter",function(){return t.eBV(s),t.Njj(a.submitMessage())}),t.k0s(),t.j41(84,"mat-icon",21),t.EFF(85,"emoji_emotions"),t.k0s()(),t.j41(86,"button",22)(87,"mat-icon"),t.EFF(88,"thumb_up"),t.k0s()()()(),t.DNE(89,q,10,4,"div",23),t.k0s()}if(2&i){const s=t.sdS(20),l=t.sdS(56);t.R7$(6),t.Dyx(a.threads()),t.R7$(4),t.vxM(a.selectedProfile()&&a.selectedProfile().profile.name?10:a.selectedProfile()?11:-1),t.R7$(3),t.Y8G("matMenuTriggerFor",s),t.R7$(8),t.Y8G("routerLink",t.lJ4(16,z)),t.R7$(5),t.Y8G("disabled",!0),t.R7$(6),t.Y8G("disabled",!0),t.R7$(5),t.Y8G("disabled",!0),t.R7$(11),t.Dyx(a.messages()),t.R7$(2),t.vxM(a.loading()?50:-1),t.R7$(2),t.Y8G("matMenuTriggerFor",l),t.R7$(5),t.Y8G("disabled",!0),t.R7$(5),t.Y8G("disabled",!0),t.R7$(5),t.Y8G("disabled",!0),t.R7$(5),t.Y8G("disabled",!0),t.R7$(5),t.Y8G("disabled",!0),t.R7$(6),t.R50("ngModel",a.message),t.R7$(3),t.Y8G("disabled",!0),t.R7$(3),t.vxM(a.details()?89:-1)}},dependencies:[C.iI,C.Wk,C.wQ,y.MD,y.YU,y.vh,O.uc,O.oV,R.s5,R.KQ,u.YN,u.me,u.BC,u.vS,M.Hl,M.iY,k.m_,k.An,E.fS,E.fg,P.rl,P.yw,Q.Fg,B.q,F.Cn,F.kk,F.fb,F.Cp,G.Vg,P.RG,u.X1,X,Y,$.D6,$.LG],styles:[".chat-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;height:calc(100vh - 80px)}.left-panel[_ngcontent-%COMP%], .right-panel[_ngcontent-%COMP%], .chat-content[_ngcontent-%COMP%]{box-sizing:border-box}.panel-content[_ngcontent-%COMP%]{box-sizing:border-box;padding:1em;overflow-x:hidden;overflow-y:auto;height:calc(100% - 64px)}.panel-content-messages[_ngcontent-%COMP%]{height:calc(100% - 128px);display:flex;flex-direction:column}.panel-content-chats[_ngcontent-%COMP%]{height:calc(100% - 128px);padding:0}.chat-action[_ngcontent-%COMP%]{vertical-align:middle!important}.left-panel[_ngcontent-%COMP%]{flex:1;max-width:240px}.middle-panel[_ngcontent-%COMP%]{flex:2}.right-panel[_ngcontent-%COMP%]{flex:none;width:200px}.chat-icon[_ngcontent-%COMP%]{border-radius:50%;max-height:48px;border:2px solid transparent}.chat-link[_ngcontent-%COMP%]{display:flex;align-items:stretch;text-decoration:none;align-items:center;cursor:pointer}.chat-item[_ngcontent-%COMP%]{text-align:right}.chat-details[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:first-child{padding-top:6px;height:24px}.chat-details[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:nth-child(2){height:24px}.chat-info-name[_ngcontent-%COMP%]{flex:1 1 auto}.chat-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%;overflow:hidden;padding-left:.2em}.chat-info[_ngcontent-%COMP%]{display:flex}.chat-text2[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.chat-text[_ngcontent-%COMP%], .chat-info-name[_ngcontent-%COMP%]{display:block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;max-width:100%}.chat-text[_ngcontent-%COMP%]{font-size:.8em}.chat-time[_ngcontent-%COMP%]{padding-right:.2em}.router-link-active[_ngcontent-%COMP%]{background-color:var(--mat-option-selected-state-layer-color)}@media (max-width: 1024px){.right-panel[_ngcontent-%COMP%]{width:100%;position:absolute;inset:0;flex:none;z-index:1000}}@media (max-width: 768px){.left-panel[_ngcontent-%COMP%]{flex:none;width:64px}.left-panel[_ngcontent-%COMP%]   .panel-content[_ngcontent-%COMP%]{padding:0}.chat-details[_ngcontent-%COMP%]{display:none}}.chat-input[_ngcontent-%COMP%]{height:64px;max-height:64px;min-height:64px;display:flex;align-items:center}.chat-message-input[_ngcontent-%COMP%]{flex-grow:2}.profile-details[_ngcontent-%COMP%]{font-size:.9em}.profile-info-label[_ngcontent-%COMP%]{margin-bottom:1em}.message[_ngcontent-%COMP%]{align-self:flex-start;background-color:color-mix(in srgb,var(--mat-option-selected-state-layer-color),transparent 40%);border-radius:1em 1em 1em 0;padding:.4em 1em;margin-bottom:1em}.message-inbound[_ngcontent-%COMP%]{align-self:flex-end;border-radius:1em 1em 0;background-color:color-mix(in srgb,var(--mat-full-pseudo-checkbox-selected-icon-color),transparent 90%)}"]})}return n})()}}]);