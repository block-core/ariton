"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9996],{58249:(b,L,n)=>{n.d(L,{K:()=>W});var v=n(10467),t=n(93953),F=n(34635),A=n(50296),I=n(69371),c=n(71943),h=n(22312),y=n(81317),M=n(68530);let W=(()=>{class R{constructor(){this.requests=(0,t.vPA)([]),this.friends=(0,t.vPA)([]),this.identity=(0,t.WQX)(F.K),this.connection=(0,t.WQX)(y.K),this.app=(0,t.WQX)(A.d)}createRequest(a){var s=this;return(0,v.A)(function*(){const l=yield c.l6.create({type:"FriendshipCredential",issuer:s.identity.did,subject:a,data:null});console.log("VC:",l);const p=yield s.identity.activeAgent().identity.get({didUri:s.identity.did}),_=yield l.sign({did:p.did});return console.log("VC JWT:",_),{record:(yield s.connection.request(a,{app:"friends",title:"I want to be your friend.",vc:_},y.X.Friend)).record}})()}accept(a){var s=this;return(0,v.A)(function*(){const l=a.data.vc;if(!l)throw new Error("The incoming VC is missing.");if(console.log("signedVcJwt:",l),!l)return;try{yield c.l6.verify({vcJwt:l})}catch(x){return void console.error("Error verifying VC:",x)}const p=c.l6.parseJwt({vcJwt:l}),_=p.issuer;if(p.issuer!=a.record.author)return void console.error("VC issuer is different than data record author");console.log("Friend request validated");const C=yield c.l6.create({type:h.eE.friendship,issuer:s.identity.did,subject:_,data:{vc:l}});console.log("TWO WAY VC:",C);const i=yield s.identity.activeAgent().identity.get({didUri:s.identity.did}),u=yield C.sign({did:i.did});console.log("TWO WAY VC JWT:",u);const{record:r}=yield s.identity.web5.dwn.records.create({data:u,message:{schema:h.eE.friendship,dataFormat:h.eE.format,published:!1}});console.log("TWO WAY VC RECORD:",r),r.send(s.identity.did);const d={vc:u,app:"friends"},f={type:y.X.Credential},{status:D,record:T}=yield s.identity.web5.dwn.records.create({data:d,store:!1,message:{tags:f,recipient:_,protocol:M.Q.protocol,protocolPath:"request",schema:M.Q.types.request.schema,dataFormat:M.Q.types.request.dataFormats[0]}});console.log("Request create status:",D);const{status:P}=yield T.send(_);return s.app.openSnackBar(202!==P.code?`Friend request failed.Code: ${P.code}, Details: ${P.detail}.`:"Friend request accepted"),{record:T,data:d,id:T.id}})()}reject(a){var s=this;return(0,v.A)(function*(){console.log("Rejecting request:",a);const l=a.record.recipient==s.identity.did?a.record.author:a.record.recipient;console.log("Target DID:",l),console.log("this.identity.did:",s.identity.did),console.log("entry.record.recipient:",a.record.recipient),console.log("entry.record.author:",a.record.author);const{status:p}=yield a.record.delete(),{status:_}=yield a.record.send(l);console.log("Delete status:",p),console.log("deleteSendStatus:",_),s.requests.update(C=>C.filter(i=>i!==a))})()}processFriends(){var a=this;return(0,v.A)(function*(){var{records:s}=yield a.identity.web5.dwn.records.query({message:{filter:{protocol:h.iU.uri,schema:I.Q.types.credential.schema,dataFormat:I.Q.types.credential.dataFormats[0]}}});console.log("VC Records:",s);for(const l of s){console.log("Record:",l);const p=yield l.data.json();console.log("JSON:",p);try{yield c.l6.verify({vcJwt:p.vc})}catch(u){console.error("Error verifying VC:",u),console.log("THIS REQUEST SHOULD BE DELETED FROM DWN",l.id)}const _=c.l6.parseJwt({vcJwt:p.vc});console.log("PARSED INVCOMING VC:",_),console.log("vc.issuer === this.identity.did:",_.issuer===a.identity.did);const{record:C}=yield a.identity.web5.dwn.records.create({data:p.vc,message:{schema:h.eE.friendship,dataFormat:h.eE.format,published:!1}});console.log("TWO WAY VC RECORD:",C);const{status:i}=yield C.send(a.identity.did);console.log("Record sent:",i,C),yield l?.delete()}})()}loadFriends(){var a=this;return(0,v.A)(function*(){var{records:s}=yield a.identity.web5.dwn.records.query({message:{filter:{schema:h.eE.friendship,dataFormat:h.eE.format}}});if(console.log("Friend VCs:"),console.log(s),a.friends.set([]),s)for(const _ of s){let C=yield _.data.text(),i=c.l6.parseJwt({vcJwt:C}),u=i.issuer;i.issuer==a.identity.did&&(u=c.l6.parseJwt({vcJwt:i.vcDataModel.credentialSubject.vc}).issuer);let r={record:_,data:{did:u}};a.friends.update(d=>[...d,r]),console.log("All friends:",a.friends())}})()}static#t=this.\u0275fac=function(s){return new(s||R)};static#e=this.\u0275prov=t.jDH({token:R,factory:R.\u0275fac,providedIn:"root"})}return R})()},49996:(b,L,n)=>{n.d(L,{$:()=>G});var v=n(10467),t=n(93953),F=n(81317),A=n(50296),I=n(60177),c=n(25596),h=n(88834),y=n(99213),M=n(30046),W=n(98703),R=n(60385),B=n(34635),a=n(58249),s=n(50963);function l(o,g){1&o&&t.EFF(0," people ")}function p(o,g){1&o&&t.EFF(0," connect_without_contact ")}function _(o,g){1&o&&t.EFF(0," Friend Request ")}function C(o,g){1&o&&t.EFF(0," Connect Request ")}function i(o,g){1&o&&t.EFF(0," This user wants to be your friend, do you accept? This will give them access to send you sharing requets, such as shared Tasks, collabrative apps and more. ")}function u(o,g){if(1&o&&(t.EFF(0," This is a data sharing request. Do you want to accept? "),t.j41(1,"p"),t.EFF(2," App: "),t.j41(3,"span",2),t.EFF(4),t.k0s(),t.nrm(5,"br"),t.EFF(6),t.k0s()),2&o){const e=t.XpG(2);t.R7$(4),t.JRh(e.entry.data.app),t.R7$(2),t.SpI("Title: ",e.entry.data.title," ")}}function r(o,g){1&o&&t.EFF(0," Shared Credential. This will be automatically processed. ")}function d(o,g){1&o&&t.nrm(0,"br")}function f(o,g){if(1&o&&t.nrm(0,"app-profile-header",4),2&o){const e=t.XpG(2);t.Y8G("did",e.entry.record.recipient)}}function D(o,g){if(1&o&&t.nrm(0,"app-profile-header",4),2&o){const e=t.XpG(2);t.Y8G("did",e.entry.record.author)}}function T(o,g){}function P(o,g){if(1&o){const e=t.RV6();t.j41(0,"button",5),t.EFF(1,"PENDING"),t.k0s(),t.EFF(2,"\xa0 "),t.j41(3,"button",6),t.bIt("click",function(){t.eBV(e);const E=t.XpG(3);return t.Njj(E.reject(E.entry))}),t.EFF(4,"CANCEL"),t.k0s()}if(2&o){const e=t.XpG(3);t.Y8G("disabled",!0),t.R7$(3),t.Y8G("disabled",e.entry.loading)}}function x(o,g){if(1&o){const e=t.RV6();t.j41(0,"button",7),t.bIt("click",function(){t.eBV(e);const E=t.XpG(3);return t.Njj(E.accept(E.entry))}),t.EFF(1,"ACCEPT"),t.k0s(),t.EFF(2,"\xa0 "),t.j41(3,"button",6),t.bIt("click",function(){t.eBV(e);const E=t.XpG(3);return t.Njj(E.reject(E.entry))}),t.EFF(4,"DELETE"),t.k0s(),t.EFF(5,"\xa0 "),t.j41(6,"button",6),t.bIt("click",function(){t.eBV(e);const E=t.XpG(3);return t.Njj(E.block(E.entry))}),t.EFF(7,"BLOCK"),t.k0s()}if(2&o){const e=t.XpG(3);t.Y8G("disabled",e.entry.loading),t.R7$(3),t.Y8G("disabled",e.entry.loading),t.R7$(3),t.Y8G("disabled",e.entry.loading)}}function U(o,g){if(1&o&&(t.j41(0,"mat-card-actions"),t.DNE(1,P,5,2)(2,x,8,3),t.k0s()),2&o){const e=t.XpG(2);t.R7$(),t.vxM("out"==e.entry.direction?1:2)}}function K(o,g){if(1&o&&(t.j41(0,"mat-card",0)(1,"mat-card-header")(2,"mat-icon",1),t.DNE(3,l,1,0)(4,p,1,0),t.k0s(),t.j41(5,"mat-card-title"),t.DNE(6,_,1,0)(7,C,1,0),t.k0s(),t.j41(8,"mat-card-subtitle"),t.EFF(9,"Type: "),t.j41(10,"span",2),t.EFF(11),t.k0s(),t.EFF(12),t.nI1(13,"ago"),t.k0s()(),t.j41(14,"mat-card-content")(15,"div",3),t.DNE(16,i,1,0)(17,u,7,2,"p")(18,r,1,0)(19,d,1,0,"br"),t.k0s(),t.DNE(20,f,1,1,"app-profile-header",4)(21,D,1,1,"app-profile-header",4),t.k0s(),t.DNE(22,T,0,0)(23,U,3,1,"mat-card-actions"),t.k0s()),2&o){const e=t.XpG();t.R7$(3),t.vxM("friend"==e.entry.record.tags.type?3:4),t.R7$(3),t.vxM("friend"==e.entry.record.tags.type?6:7),t.R7$(5),t.JRh(e.entry.record.tags.type),t.R7$(),t.SpI(" (",t.bMT(13,7,e.entry.record.dateCreated),")"),t.R7$(4),t.vxM("friend"==e.entry.record.tags.type?16:"data"==e.entry.record.tags.type?17:"credential"==e.entry.record.tags.type?18:19),t.R7$(4),t.vxM("out"==e.entry.direction?20:21),t.R7$(2),t.vxM("credential"==e.entry.record.tags.type?22:23)}}let G=(()=>{class o{constructor(){this.entry=void 0,this.connection=(0,t.WQX)(F.K),this.friend=(0,t.WQX)(a.K),this.identity=(0,t.WQX)(B.K),this.app=(0,t.WQX)(A.d)}deleteConnection(e){e.loading=!0,this.connection.deleteConnection(e)}accept(e){var m=this;return(0,v.A)(function*(){e.loading=!0,console.log("Accepting connection request",e),e.data.did=e.record.author;const j=e.record.tags.type;if(j==F.X.Friend){const O=yield m.friend.accept(e);e.data.vc=O?.data.vc,e.data.recordId=O?.id}const X=yield m.connection.create(e,j);if(console.log("Connection Entry that was made: ",X),yield m.connection.deleteRequest(e),j==F.X.Data&&(console.log("ACCEPTING DATA CONNECTION:",e),"tasks"==e.data.app)){console.log("ACEPTING TASKS CONNECTION:",e),console.log("DID DWN to read from:",e.data.did),console.log("RID DWN to read from:",e.data.recordId);const{record:O,status:S}=yield m.identity.web5.dwn.records.read({from:e.data.did,message:{protocolRole:"collaborator",filter:{protocolPath:"list",recordId:e.data.recordId}}});console.log("STATUS FROM READING RECORD EXTERNALLY:",S),console.log("RECORD FROM CONNECTION ACCEPT:",O);const{records:k,status:V}=yield m.identity.web5.dwn.records.query({from:e.data.did,message:{protocolRole:"collaborator",filter:{protocol:s.Q.protocol,protocolPath:"list"}}});console.log("STATUS FROM READING RECORDS EXTERNALLY:",k),console.log("RECORD FROM STATUS RECORDS:",V);let N={};O&&(N={...yield O.data.json(),id:O.dataCid,did:O.author,created:O.dateCreated},console.log("RECORD JSON:",N))}})()}block(e){var m=this;return(0,v.A)(function*(){e.loading=!0,console.log("Blocking user",e);const E=yield m.connection.block(e.record.author);console.log("Block result: ",E)})()}reject(e){e.loading=!0,this.connection.deleteRequest(e)}static#t=this.\u0275fac=function(m){return new(m||o)};static#e=this.\u0275cmp=t.VBU({type:o,selectors:[["app-request"]],inputs:{entry:"entry"},standalone:!0,features:[t.aNF],decls:1,vars:1,consts:[["appearance","outlined",1,"card-notification"],["inline","true","mat-card-avatar","",1,"card-icon"],[1,"capitalize"],[1,"notification-description"],[3,"did"],["mat-flat-button","",3,"disabled"],["mat-button","",3,"click","disabled"],["mat-flat-button","",3,"click","disabled"]],template:function(m,E){1&m&&t.DNE(0,K,24,9,"mat-card",0),2&m&&t.vxM(E.entry?0:-1)},dependencies:[R.w,W.g,I.MD,c.Hu,c.RN,c.YY,c.QG,c.m2,c.MM,c.Lc,c.dh,h.Hl,h.$z,y.m_,y.An,M.iI],styles:[".card-icon[_ngcontent-%COMP%]{font-size:3em}.card-notification[_ngcontent-%COMP%]{margin-bottom:1em}.notifications-title[_ngcontent-%COMP%]{display:flex;width:100%}.notifications-card[_ngcontent-%COMP%]{max-width:600px;width:100%}.card-notification[_ngcontent-%COMP%]   mat-card-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}.notification-description[_ngcontent-%COMP%]{margin-bottom:1em}"]})}return o})()},60385:(b,L,n)=>{n.d(L,{w:()=>C});var v=n(10467),t=n(93953),F=n(34635),A=n(25596),I=n(39434),c=n(345),h=n(78013),y=n(33347),M=n(14823),W=n(30046);const R=i=>["/profile",i];function B(i,u){if(1&i&&(t.nrm(0,"img",0),t.nI1(1,"safeResourceUrl")),2&i){let r;const d=t.XpG();t.Y8G("routerLink",t.eq3(4,R,null==(r=d.data().profile)?null:r.did))("src",t.bMT(1,2,d.data().avatar),t.B4B)}}function a(i,u){if(1&i&&t.nrm(0,"img",1),2&i){let r;const d=t.XpG();t.Y8G("routerLink",t.eq3(2,R,null==(r=d.data().profile)?null:r.did))("src","/avatar-placeholder.png",t.B4B)}}function s(i,u){if(1&i&&t.EFF(0),2&i){let r;const d=t.XpG(2);t.SpI(" (",null==(r=d.data().profile)?null:r.title,") ")}}function l(i,u){if(1&i&&(t.j41(0,"a",3),t.EFF(1),t.DNE(2,s,1,1),t.k0s()),2&i){let r,d,f;const D=t.XpG();t.Y8G("routerLink",t.eq3(3,R,null==(r=D.data().profile)?null:r.did)),t.R7$(),t.SpI("",null==(d=D.data().profile)?null:d.name," "),t.R7$(),t.vxM(null!=(f=D.data().profile)&&f.title?2:-1)}}function p(i,u){if(1&i&&t.EFF(0),2&i){let r;const d=t.XpG(2);t.SpI(" (",null==(r=d.data().profile)?null:r.title,") ")}}function _(i,u){if(1&i&&(t.j41(0,"em")(1,"a",3),t.EFF(2,"No name set "),t.DNE(3,p,1,1),t.k0s()()),2&i){let r,d;const f=t.XpG();t.R7$(),t.Y8G("routerLink",t.eq3(2,R,null==(r=f.data().profile)?null:r.did)),t.R7$(2),t.vxM(null!=(d=f.data().profile)&&d.title?3:-1)}}let C=(()=>{class i{constructor(){this.identity=(0,t.WQX)(F.K),this.profile=(0,t.WQX)(I.p),this.sanitizer=(0,t.WQX)(c.up),this.did=t.hFB.required(),this.data=(0,t.vPA)({})}ngAfterViewInit(){var r=this;return(0,v.A)(function*(){if(r.did()){const d=yield r.profile.loadProfile(r.did());console.log(d),r.data.set(d)}})()}static#t=this.\u0275fac=function(d){return new(d||i)};static#e=this.\u0275cmp=t.VBU({type:i,selectors:[["app-profile-header"]],inputs:{did:[1,"did"]},standalone:!0,features:[t.aNF],decls:10,vars:9,consts:[["mat-card-avatar","","onerror","this.src='/avatar-placeholder.png';this.onerror='';",1,"profile-thumbnail",3,"routerLink","src"],["mat-card-avatar","",1,"profile-thumbnail",3,"routerLink","src"],[1,"profile-header-title"],[3,"routerLink"],[1,"profile-header-subtitle"],[3,"routerLink","matTooltip"]],template:function(d,f){if(1&d&&(t.DNE(0,B,2,6,"img",0)(1,a,1,4,"img",1),t.j41(2,"div")(3,"div",2),t.DNE(4,l,3,5,"a",3)(5,_,4,4,"em"),t.k0s(),t.j41(6,"div",4)(7,"a",5),t.EFF(8),t.nI1(9,"did"),t.k0s()()()),2&d){let D,T,P,x;t.vxM(f.data().avatar?0:1),t.R7$(4),t.vxM(null!=(D=f.data().profile)&&D.name?4:5),t.R7$(3),t.Y8G("routerLink",t.eq3(7,R,null==(T=f.data().profile)?null:T.did))("matTooltip",null==(P=f.data().profile)?null:P.did),t.R7$(),t.JRh(t.bMT(9,5,null==(x=f.data().profile)?null:x.did))}},dependencies:[W.iI,W.Wk,M.uc,M.oV,A.Hu,A.QG,h.d,y.k],styles:[".profile-thumbnail[_ngcontent-%COMP%]{cursor:pointer;border-radius:50%;margin-right:1em}a[_ngcontent-%COMP%]{text-decoration:none}a[_ngcontent-%COMP%]:hover{text-decoration:underline}[_nghost-%COMP%]{display:flex}.profile-header-title[_ngcontent-%COMP%]{font-size:1.4em}.profile-header-subtitle[_ngcontent-%COMP%]{font-size:1em}"]})}return i})()}}]);