"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6489],{58249:(B,D,a)=>{a.d(D,{K:()=>O});var u=a(10467),t=a(54438),k=a(34635),R=a(96084),M=a(69371),g=a(76336),b=a(22312),T=a(21093),j=a(68530);let O=(()=>{class y{constructor(){this.requests=(0,t.vPA)([]),this.friends=(0,t.vPA)([]),this.identity=(0,t.WQX)(k.K),this.connection=(0,t.WQX)(T.K),this.app=(0,t.WQX)(R.d)}createRequest(l){var _=this;return(0,u.A)(function*(){const f=yield g.l6.create({type:"FriendshipCredential",issuer:_.identity.did,subject:l,data:null});console.log("VC:",f);const h=yield _.identity.activeAgent().identity.get({didUri:_.identity.did}),m=yield f.sign({did:h.did});return console.log("VC JWT:",m),{record:(yield _.connection.request(l,{app:"friends",title:"I want to be your friend.",vc:m},T.X.Friend)).record}})()}accept(l){var _=this;return(0,u.A)(function*(){const f=l.data.vc;if(!f)throw new Error("The incoming VC is missing.");if(console.log("signedVcJwt:",f),!f)return;try{yield g.l6.verify({vcJwt:f})}catch(N){return void console.error("Error verifying VC:",N)}const h=g.l6.parseJwt({vcJwt:f}),m=h.issuer;if(h.issuer!=l.record.creator)return void console.error("VC issuer is different than data record author");console.log("Friend request validated");const F=yield g.l6.create({type:b.eE.friendship,issuer:_.identity.did,subject:m,data:{vc:f}});console.log("TWO WAY VC:",F);const d=yield _.identity.activeAgent().identity.get({didUri:_.identity.did}),v=yield F.sign({did:d.did});console.log("TWO WAY VC JWT:",v);const{record:s}=yield _.identity.web5.dwn.records.create({data:v,message:{schema:b.eE.friendship,dataFormat:b.eE.format,published:!1}});console.log("TWO WAY VC RECORD:",s),s.send(_.identity.did);const c={title:l.data.title,vc:v,app:"friends"},E={type:T.X.Credential};console.log("SENDING FRIEND REQUEST TO TARGET:",m);const{status:G,record:X}=yield _.identity.web5.dwn.records.create({data:c,store:!1,message:{tags:E,recipient:m,protocol:j.Q.protocol,protocolPath:"request",schema:j.Q.types.request.schema,dataFormat:j.Q.types.request.dataFormats[0]}});console.log("Request create status:",G);const{status:A}=yield X.send(m);return console.log("SENT TO TARGET!!!",A),_.app.openSnackBar(202!==A.code?`Friend request failed.Code: ${A.code}, Details: ${A.detail}.`:"Friend request accepted"),{record:X,data:c,id:X.id}})()}reject(l){var _=this;return(0,u.A)(function*(){console.log("Rejecting request:",l);const f=l.record.recipient==_.identity.did?l.record.creator:l.record.recipient;console.log("Target DID:",f),console.log("this.identity.did:",_.identity.did),console.log("entry.record.recipient:",l.record.recipient),console.log("entry.record.author:",l.record.author),console.log("entry.record.creator:",l.record.creator);const{status:h}=yield l.record.delete(),{status:m}=yield l.record.send(f);console.log("Delete status:",h),console.log("deleteSendStatus:",m),_.requests.update(F=>F.filter(d=>d!==l))})()}processFriends(){var l=this;return(0,u.A)(function*(){var{records:_}=yield l.identity.web5.dwn.records.query({message:{filter:{protocol:b.iU.uri,schema:M.Q.types.credential.schema,dataFormat:M.Q.types.credential.dataFormats[0]}}});console.log("VC Records:",_);for(const f of _){console.log("Record:",f);const h=yield f.data.json();console.log("JSON:",h);try{yield g.l6.verify({vcJwt:h.vc})}catch(v){console.error("Error verifying VC:",v),console.log("THIS REQUEST SHOULD BE DELETED FROM DWN",f.id)}const m=g.l6.parseJwt({vcJwt:h.vc});console.log("PARSED INVCOMING VC:",m),console.log("vc.issuer === this.identity.did:",m.issuer===l.identity.did);const{record:F}=yield l.identity.web5.dwn.records.create({data:h.vc,message:{schema:b.eE.friendship,dataFormat:b.eE.format,published:!1}});console.log("TWO WAY VC RECORD:",F);const{status:d}=yield F.send(l.identity.did);console.log("Record sent:",d,F),yield f?.delete()}})()}loadFriends(){var l=this;return(0,u.A)(function*(){var{records:_}=yield l.identity.web5.dwn.records.query({message:{filter:{schema:b.eE.friendship,dataFormat:b.eE.format}}});if(console.log("Friend VCs:"),console.log(_),l.friends.set([]),_)for(const m of _){let F=yield m.data.text(),d=g.l6.parseJwt({vcJwt:F}),v=d.issuer;d.issuer==l.identity.did&&(v=g.l6.parseJwt({vcJwt:d.vcDataModel.credentialSubject.vc}).issuer);let s={record:m,data:{did:v}};l.friends.update(c=>[...c,s]),console.log("All friends:",l.friends())}})()}static{this.\u0275fac=function(_){return new(_||y)}}static{this.\u0275prov=t.jDH({token:y,factory:y.\u0275fac,providedIn:"root"})}}return y})()},96489:(B,D,a)=>{a.r(D),a.d(D,{ProfileComponent:()=>Tt});var u=a(10467),t=a(54438),k=a(88834),R=a(71997),M=a(99213),g=a(59115),b=a(30046),T=a(5794),j=a(96850),O=a(34635),y=a(78013),x=a(75351),l=a(51889),_=a(96084),f=a(60177),h=a(9183),m=a(29508),F=a(36815),d=a(58249),v=a(21093),s=a(25596),c=a(89417),E=a(99631),G=a(14823),X=a(53719);let A=(()=>{class n{constructor(o,e){this.dialogRef=o,this.data=e,this.fb=(0,t.WQX)(c.ok),this.form=this.fb.group({body:[null,c.k0.required]})}ngAfterViewInit(){}onColorChange(o){var e=this;return(0,u.A)(function*(){e.data.background=o.target.value})()}static{this.\u0275fac=function(e){return new(e||n)(t.rXU(x.CP),t.rXU(x.Vh))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["app-post-dialog"]],standalone:!0,features:[t.aNF],decls:11,vars:3,consts:[["body",""],["appearance","outline",1,"full-width"],["maxlength","12000","rows","6","matInput","","placeholder","Post",3,"ngModelChange","ngModel"],["align","end"],["mat-button","","mat-dialog-close",""],["mat-flat-button","","type","submit","cdkFocusInitial","",3,"mat-dialog-close"]],template:function(e,i){if(1&e){const p=t.RV6();t.j41(0,"mat-dialog-content")(1,"mat-form-field",1)(2,"textarea",2,0),t.mxI("ngModelChange",function(C){return t.eBV(p),t.DH7(i.data.body,C)||(i.data.body=C),t.Njj(C)}),t.k0s(),t.j41(4,"mat-hint",3),t.EFF(5),t.k0s()()(),t.j41(6,"mat-dialog-actions",3)(7,"button",4),t.EFF(8,"Cancel"),t.k0s(),t.j41(9,"button",5),t.EFF(10,"Post"),t.k0s()()}if(2&e){const p=t.sdS(3);t.R7$(2),t.R50("ngModel",i.data.body),t.R7$(3),t.SpI("",p.value.length," / 12000"),t.R7$(4),t.Y8G("mat-dialog-close",!0)}},dependencies:[f.MD,G.uc,g.Cn,M.m_,k.Hl,k.$z,E.fS,E.fg,X.rl,X.MV,x.hM,x.tx,x.E7,x.Yi,c.YN,c.me,c.BC,c.tU,c.vS],styles:["form[_ngcontent-%COMP%]{display:inline}"]})}}return n})();var N=a(60385),S=a(98703),W=a(77494),L=a(345);const $=n=>["/app","chat",n],U=()=>["edit"],V=(n,r)=>["/profile",n,"posts",r];function Q(n,r){if(1&n&&(t.nrm(0,"img",4),t.nI1(1,"safeResourceUrl")),2&n){const o=t.XpG(2);t.Y8G("src",t.bMT(1,1,o.data().avatar),t.B4B)}}function Y(n,r){1&n&&t.nrm(0,"img",5)}function K(n,r){if(1&n&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&n){const o=t.XpG(3);t.R7$(),t.SpI("(",o.data().profile.title,")")}}function J(n,r){if(1&n){const o=t.RV6();t.j41(0,"button",20),t.bIt("click",function(){t.eBV(o);const i=t.XpG(5);return t.Njj(i.addFriend(i.data().did))}),t.j41(1,"mat-icon"),t.EFF(2,"person_add"),t.k0s()()}}function w(n,r){if(1&n&&(t.j41(0,"button",19)(1,"mat-icon"),t.EFF(2,"chat_bubble"),t.k0s()()),2&n){const o=t.XpG(5);t.Y8G("routerLink",t.eq3(1,$,o.data().did))}}function H(n,r){if(1&n&&t.DNE(0,J,3,0,"button",18)(1,w,3,3,"button",19),2&n){const o=t.XpG(4);t.vxM(o.data().friend?1:0)}}function z(n,r){if(1&n){const o=t.RV6();t.j41(0,"button",23),t.bIt("click",function(){t.eBV(o);const i=t.XpG(5);return t.Njj(i.addFriend(i.data().did))}),t.j41(1,"mat-icon"),t.EFF(2,"person_add"),t.k0s(),t.EFF(3," Add friend "),t.k0s()}}function Z(n,r){if(1&n&&(t.j41(0,"button",22)(1,"mat-icon"),t.EFF(2,"chat_bubble"),t.k0s(),t.EFF(3," Message "),t.k0s()),2&n){const o=t.XpG(5);t.Y8G("routerLink",t.eq3(1,$,o.data().did))}}function q(n,r){if(1&n&&t.DNE(0,z,4,0,"button",21)(1,Z,4,3,"button",22),2&n){const o=t.XpG(4);t.vxM(o.data().friend?1:0)}}function tt(n,r){if(1&n&&t.DNE(0,H,2,1)(1,q,2,1),2&n){const o=t.XpG(3);t.vxM(o.layout.tiny()?0:1)}}function ot(n,r){if(1&n){const o=t.RV6();t.j41(0,"div",6)(1,"h1"),t.EFF(2),t.DNE(3,K,2,1,"span")(4,tt,2,1),t.j41(5,"button",15)(6,"mat-icon"),t.EFF(7,"more_vert"),t.k0s()()(),t.j41(8,"span",16)(9,"button",17),t.bIt("click",function(){t.eBV(o);const i=t.XpG(2);return t.Njj(i.showQR(i.data().did))}),t.j41(10,"mat-icon"),t.EFF(11,"qr_code"),t.k0s()(),t.EFF(12),t.k0s()()}if(2&n){t.XpG();const o=t.sdS(7),e=t.XpG();t.R7$(2),t.SpI(" ",e.data().profile.name," "),t.R7$(),t.vxM(e.data().profile.title?3:-1),t.R7$(),t.vxM(e.data().did!==e.identity.did?4:-1),t.R7$(),t.Y8G("matMenuTriggerFor",o),t.R7$(7),t.SpI("",e.data().did," ")}}function nt(n,r){if(1&n){const o=t.RV6();t.j41(0,"button",20),t.bIt("click",function(){t.eBV(o);const i=t.XpG(5);return t.Njj(i.addFriend(i.data().did))}),t.j41(1,"mat-icon"),t.EFF(2,"person_add"),t.k0s()()}}function it(n,r){if(1&n&&(t.j41(0,"button",19)(1,"mat-icon"),t.EFF(2,"chat_bubble"),t.k0s()()),2&n){const o=t.XpG(5);t.Y8G("routerLink",t.eq3(1,$,o.data().did))}}function et(n,r){if(1&n&&t.DNE(0,nt,3,0,"button",18)(1,it,3,3,"button",19),2&n){const o=t.XpG(4);t.vxM(o.data().friend?1:0)}}function at(n,r){if(1&n){const o=t.RV6();t.j41(0,"button",23),t.bIt("click",function(){t.eBV(o);const i=t.XpG(5);return t.Njj(i.addFriend(i.data().did))}),t.j41(1,"mat-icon"),t.EFF(2,"person_add"),t.k0s(),t.EFF(3," Add friend "),t.k0s()}}function rt(n,r){if(1&n&&(t.j41(0,"button",22)(1,"mat-icon"),t.EFF(2,"chat_bubble"),t.k0s(),t.EFF(3," Message "),t.k0s()),2&n){const o=t.XpG(5);t.Y8G("routerLink",t.eq3(1,$,o.data().did))}}function dt(n,r){if(1&n&&t.DNE(0,at,4,0,"button",21)(1,rt,4,3,"button",22),2&n){const o=t.XpG(4);t.vxM(o.data().friend?1:0)}}function lt(n,r){if(1&n&&t.DNE(0,et,2,1)(1,dt,2,1),2&n){const o=t.XpG(3);t.vxM(o.layout.tiny()?0:1)}}function st(n,r){if(1&n){const o=t.RV6();t.j41(0,"div",6)(1,"h1"),t.DNE(2,lt,2,1),t.j41(3,"button",15)(4,"mat-icon"),t.EFF(5,"more_vert"),t.k0s()()(),t.j41(6,"span",16)(7,"button",17),t.bIt("click",function(){t.eBV(o);const i=t.XpG(2);return t.Njj(i.showQR(i.data().did))}),t.j41(8,"mat-icon"),t.EFF(9,"qr_code"),t.k0s()(),t.EFF(10),t.k0s()()}if(2&n){t.XpG();const o=t.sdS(7),e=t.XpG();t.R7$(2),t.vxM(e.data().did!==e.identity.did?2:-1),t.R7$(),t.Y8G("matMenuTriggerFor",o),t.R7$(7),t.SpI("",e.data().did," ")}}function ct(n,r){if(1&n){const o=t.RV6();t.j41(0,"button",8),t.bIt("click",function(){t.eBV(o);const i=t.XpG(3);return t.Njj(i.addFriend(i.data().did))}),t.j41(1,"mat-icon"),t.EFF(2,"person_add"),t.k0s(),t.j41(3,"span"),t.EFF(4,"Add friend"),t.k0s()()}}function _t(n,r){if(1&n&&(t.j41(0,"button",25)(1,"mat-icon"),t.EFF(2,"chat_bubble"),t.k0s(),t.j41(3,"span"),t.EFF(4,"Message"),t.k0s()()),2&n){const o=t.XpG(3);t.Y8G("routerLink",t.eq3(1,$,o.data().did))}}function pt(n,r){if(1&n&&(t.DNE(0,ct,5,0,"button",24)(1,_t,5,3,"button",25),t.nrm(2,"mat-divider")),2&n){const o=t.XpG(2);t.vxM(o.data().friend?1:0)}}function mt(n,r){1&n&&(t.j41(0,"button",25)(1,"mat-icon"),t.EFF(2,"edit"),t.k0s(),t.j41(3,"span"),t.EFF(4,"Edit Profile"),t.k0s()(),t.nrm(5,"mat-divider")),2&n&&t.Y8G("routerLink",t.lJ4(1,U))}function ft(n,r){if(1&n){const o=t.RV6();t.nrm(0,"mat-divider"),t.j41(1,"button",8),t.bIt("click",function(){t.eBV(o);const i=t.XpG(2);return t.Njj(i.block(i.data().did))}),t.j41(2,"mat-icon"),t.EFF(3,"block"),t.k0s(),t.j41(4,"span"),t.EFF(5,"Block"),t.k0s()()}}function ut(n,r){1&n&&(t.j41(0,"mat-icon",26),t.EFF(1,"notes"),t.k0s(),t.j41(2,"span",27),t.EFF(3,"Posts"),t.k0s())}function Ct(n,r){if(1&n){const o=t.RV6();t.j41(0,"mat-card",11)(1,"mat-card-content")(2,"button",28),t.bIt("click",function(){t.eBV(o);const i=t.XpG(2);return t.Njj(i.newPost())}),t.j41(3,"mat-icon"),t.EFF(4,"chat"),t.k0s(),t.EFF(5," Post "),t.k0s(),t.j41(6,"button",29)(7,"mat-icon"),t.EFF(8,"photo_library"),t.k0s(),t.EFF(9," Media "),t.k0s(),t.j41(10,"button",29)(11,"mat-icon"),t.EFF(12,"attach_file"),t.k0s(),t.EFF(13," File "),t.k0s()()()}2&n&&(t.R7$(6),t.Y8G("disabled",!0),t.R7$(4),t.Y8G("disabled",!0))}function ht(n,r){if(1&n){const o=t.RV6();t.j41(0,"mat-card",13)(1,"mat-card-header")(2,"div",30),t.nrm(3,"app-profile-header",31),t.j41(4,"button",32)(5,"mat-icon"),t.EFF(6,"more_vert"),t.k0s()(),t.j41(7,"mat-menu",null,1)(9,"button",8),t.bIt("click",function(){const i=t.eBV(o).$implicit,p=t.XpG(2);return t.Njj(p.editPost(i))}),t.j41(10,"mat-icon"),t.EFF(11,"edit"),t.k0s(),t.j41(12,"span"),t.EFF(13,"Edit post"),t.k0s()(),t.j41(14,"button",25)(15,"mat-icon"),t.EFF(16,"note"),t.k0s(),t.j41(17,"span"),t.EFF(18,"View post"),t.k0s()(),t.j41(19,"button",8),t.bIt("click",function(){const i=t.eBV(o).$implicit,p=t.XpG(2);return t.Njj(p.copyUrl(i))}),t.j41(20,"mat-icon"),t.EFF(21,"content_copy"),t.k0s(),t.j41(22,"span"),t.EFF(23,"Copy URL"),t.k0s()(),t.nrm(24,"mat-divider"),t.j41(25,"button",8),t.bIt("click",function(){const i=t.eBV(o).$implicit,p=t.XpG(2);return t.Njj(p.deletePost(i))}),t.j41(26,"mat-icon"),t.EFF(27,"delete"),t.k0s(),t.j41(28,"span"),t.EFF(29,"Delete post"),t.k0s()()()()(),t.j41(30,"mat-card-content")(31,"div",33)(32,"a",34),t.EFF(33),t.nI1(34,"ago"),t.k0s()(),t.j41(35,"div",35),t.EFF(36),t.k0s()()()}if(2&n){const o=r.$implicit,e=t.sdS(8);t.R7$(3),t.Y8G("did",o.record.creator),t.R7$(),t.Y8G("matMenuTriggerFor",e),t.R7$(10),t.Y8G("routerLink",t.l_i(8,V,o.record.creator,o.record.id)),t.R7$(18),t.Y8G("routerLink",t.l_i(11,V,o.record.creator,o.record.id)),t.R7$(),t.JRh(t.bMT(34,6,o.record.dateCreated)),t.R7$(3),t.JRh(o.data.body)}}function gt(n,r){1&n&&(t.j41(0,"mat-icon",26),t.EFF(1,"badge"),t.k0s(),t.j41(2,"span",27),t.EFF(3,"About"),t.k0s())}function vt(n,r){if(1&n&&(t.j41(0,"mat-icon"),t.EFF(1,"event"),t.k0s(),t.j41(2,"span"),t.EFF(3),t.k0s()),2&n){const o=t.XpG(3);t.R7$(3),t.JRh(o.data().profile.birthDate)}}function Ft(n,r){if(1&n&&(t.j41(0,"mat-icon"),t.EFF(1,"place"),t.k0s(),t.j41(2,"span"),t.EFF(3),t.k0s()),2&n){const o=t.XpG(3);t.R7$(3),t.JRh(o.data().profile.location)}}function Et(n,r){if(1&n&&(t.j41(0,"mat-icon"),t.EFF(1,"event"),t.k0s(),t.j41(2,"span"),t.EFF(3),t.k0s()),2&n){const o=t.XpG(3);t.R7$(3),t.JRh(o.data().profile.status)}}function Pt(n,r){if(1&n&&(t.j41(0,"mat-icon"),t.EFF(1,"link"),t.k0s(),t.EFF(2,"\xa0"),t.j41(3,"a",38),t.EFF(4),t.k0s(),t.EFF(5,"\xa0 ")),2&n){const o=r.$implicit;t.R7$(3),t.Y8G("href",o,t.B4B),t.R7$(),t.JRh(o)}}function bt(n,r){if(1&n&&t.Z7z(0,Pt,6,2,null,null,t.fX1),2&n){const o=t.XpG(3);t.Dyx(o.data().profile.links)}}function yt(n,r){if(1&n&&(t.j41(0,"div",37),t.EFF(1),t.k0s()),2&n){const o=t.XpG(3);t.R7$(),t.SpI(" ",o.data().profile.bio," ")}}function jt(n,r){if(1&n&&(t.j41(0,"div",14)(1,"div",36),t.DNE(2,vt,4,1)(3,Ft,4,1)(4,Et,4,1)(5,bt,2,0),t.k0s(),t.DNE(6,yt,2,1,"div",37),t.k0s()),2&n){const o=t.XpG(2);t.R7$(2),t.vxM(o.data().profile.birthDate?2:-1),t.R7$(),t.vxM(o.data().profile.location?3:-1),t.R7$(),t.vxM(o.data().profile.status?4:-1),t.R7$(),t.vxM(o.data().profile.links&&o.data().profile.links.length>0?5:-1),t.R7$(),t.vxM(o.data().profile.bio?6:-1)}}function xt(n,r){1&n&&(t.j41(0,"mat-icon",26),t.EFF(1,"diversity_2"),t.k0s(),t.j41(2,"span",27),t.EFF(3,"Communities"),t.k0s())}function kt(n,r){1&n&&(t.j41(0,"mat-icon",26),t.EFF(1,"folder_shared"),t.k0s(),t.j41(2,"span",27),t.EFF(3,"Data"),t.k0s())}function Mt(n,r){if(1&n){const o=t.RV6();t.j41(0,"div",3),t.DNE(1,Q,2,3,"img",4)(2,Y,1,0,"img",5)(3,ot,13,5,"div",6)(4,st,11,3,"div",6),t.nrm(5,"div",7),t.j41(6,"mat-menu",null,0),t.DNE(8,pt,3,1,"mat-divider")(9,mt,6,2),t.j41(10,"button",8),t.bIt("click",function(){t.eBV(o);const i=t.XpG();return t.Njj(i.showQR(i.data().did))}),t.j41(11,"mat-icon"),t.EFF(12,"qr_code"),t.k0s(),t.j41(13,"span"),t.EFF(14,"Show QR"),t.k0s()(),t.j41(15,"button",8),t.bIt("click",function(){t.eBV(o);const i=t.XpG();return t.Njj(i.shareProfile(i.data()))}),t.j41(16,"mat-icon"),t.EFF(17,"send"),t.k0s(),t.j41(18,"span"),t.EFF(19,"Share Profile"),t.k0s()(),t.DNE(20,ft,6,0),t.k0s()(),t.j41(21,"div",9)(22,"mat-tab-group")(23,"mat-tab"),t.DNE(24,ut,4,0,"ng-template",10)(25,Ct,14,2,"mat-card",11),t.j41(26,"div",12),t.Z7z(27,ht,37,14,"mat-card",13,t.fX1),t.k0s()(),t.j41(29,"mat-tab"),t.DNE(30,gt,4,0,"ng-template",10)(31,jt,7,5,"div",14),t.k0s(),t.j41(32,"mat-tab"),t.DNE(33,xt,4,0,"ng-template",10),t.EFF(34," Not implemented yet. "),t.k0s(),t.j41(35,"mat-tab"),t.DNE(36,kt,4,0,"ng-template",10),t.EFF(37," Not implemented yet. "),t.k0s()()()}if(2&n){const o=t.XpG();t.R7$(),t.vxM(o.data().avatar?1:2),t.R7$(2),t.vxM(o.data().profile?3:4),t.R7$(5),t.vxM(o.data().did!==o.identity.did?8:-1),t.R7$(),t.vxM(o.data().did===o.identity.did?9:-1),t.R7$(11),t.vxM(o.identity.did!==o.data().did?20:-1),t.R7$(5),t.vxM(o.data().did==o.identity.did?25:-1),t.R7$(2),t.Dyx(o.posts()),t.R7$(4),t.vxM(o.data().profile?31:-1)}}function Rt(n,r){1&n&&(t.j41(0,"div",2),t.nrm(1,"mat-spinner"),t.k0s())}let Tt=(()=>{class n{ngOnDestroy(){URL.revokeObjectURL(this.avatarSrc)}constructor(o,e){var i=this;this.sanitizer=o,this.route=e,this.posts=(0,t.vPA)([]),this.profileService=(0,t.WQX)(T.p),this.identity=(0,t.WQX)(O.K),this.connection=(0,t.WQX)(v.K),this.app=(0,t.WQX)(_.d),this.layout=(0,t.WQX)(F.Y),this.friend=(0,t.WQX)(d.K),this.dialog=(0,t.WQX)(x.bZ),this.data=(0,t.vPA)(void 0),this.avatarSrc=null,this.layout.marginOff(),(0,t.QZP)((0,u.A)(function*(){i.app.initialized()&&i.route.paramMap.subscribe(function(){var p=(0,u.A)(function*(P){const C=P.get("id");C&&"undefined"!==C&&(i.did=C,console.log("USER ID SET!!",C),yield i.loadUserProfile(C),yield i.loadPosts(C))});return function(P){return p.apply(this,arguments)}}())}))}loadPosts(o){var e=this;return(0,u.A)(function*(){const i={from:o,message:{filter:{author:o,protocol:m.Q.protocol,protocolPath:"post",schema:m.Q.types.post.schema,dataFormat:m.Q.types.post.dataFormats[0]},dateSort:W.U0.CreatedDescending}};console.log("QUERY: ",i);var{records:p}=yield e.identity.web5.dwn.records.query(i);if(e.posts.set([]),p)for(const C of p){let I=yield C.data.json(),Dt={record:C,data:I};e.posts.update(Ot=>[...Ot,Dt])}console.log("All posts:",e.posts())})()}newPost(){this.editPost({data:{title:"",body:"",background:"",collaborators:[],labels:[]}})}editPost(o){var e=this;let i={title:o.data.title,body:o.data.body,background:o.data.background,collaborators:[],labels:[""]};const p=JSON.parse(JSON.stringify(i)),P=this.dialog.open(A,{maxWidth:"80vw",maxHeight:"80vh",data:i});return P.afterClosed().subscribe(function(){var C=(0,u.A)(function*(I){I?(console.log("data result for saving:",i),o.data=i,yield e.savePost(o,i)):i=p});return function(I){return C.apply(this,arguments)}}()),P.afterClosed()}deletePost(o){var e=this;return(0,u.A)(function*(){const{status:i}=yield o.record.delete();i&&e.posts.update(p=>p.filter(P=>P.record!=o.record))})()}savePost(o,e){var i=this;return(0,u.A)(function*(){let p;if(e.labels&&e.labels.length>0&&(p={labels:e.labels}),o.record)yield o.record.update({tags:p,data:e,published:!0});else{const{record:P}=yield i.identity.web5.dwn.records.create({data:e,message:{published:!0,tags:p,protocol:m.Q.protocol,protocolPath:"post",schema:m.Q.types.post.schema,dataFormat:m.Q.types.post.dataFormats[0]}});P&&(o.record=P,i.posts.update(I=>[o,...I]),yield o.record.send(i.identity.did))}})()}ngOnInit(){return(0,u.A)(function*(){})()}loadData(){return(0,u.A)(function*(){})()}addFriend(o){var e=this;return(0,u.A)(function*(){yield e.friend.createRequest(o),e.app.openSnackBar("Friend request sent")})()}block(o){var e=this;return(0,u.A)(function*(){yield e.connection.block(o)})()}loadUserProfile(o){var e=this;return(0,u.A)(function*(){try{const i=yield e.profileService.loadProfile(o);e.data.set(i)}catch(i){console.error(i)}})()}copyUrl(o){var e=this;return(0,u.A)(function*(){const i=`${document.location.origin}/profile/${o.record.creator}/posts/${o.record.id}`;try{yield navigator.clipboard.writeText(i),e.app.openSnackBar("Url copied to clipboard")}catch(p){console.error("Failed to copy: ",p)}})()}showQR(o){this.dialog.open(l.k,{data:{did:o}})}shareProfile(o){var e=this;return(0,u.A)(function*(){const i=o.profile.name,p=document.location.href;try{yield navigator.share({title:i,url:p,text:"Check out this profile on Ariton"}),e.app.openSnackBar("Thanks for sharing!")}catch(C){e.app.openSnackBar(`Couldn't share ${C}`)}})()}static{this.\u0275fac=function(e){return new(e||n)(t.rXU(L.up),t.rXU(b.nX))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["app-profile"]],standalone:!0,features:[t.aNF],decls:2,vars:1,consts:[["menuProfile","matMenu"],["menuActions","matMenu"],[1,"loading-indicator"],[1,"profile-header"],["onerror","this.src='/avatar-placeholder.png';this.onerror='';",1,"profile-header-icon",3,"src"],["src","/avatar-placeholder.png",1,"profile-header-icon"],[1,"profile-header-text"],[1,"spacer"],["mat-menu-item","",3,"click"],[1,"profile-content"],["mat-tab-label",""],[1,"toolbar-actions","margin"],[1,"posts-items","margin"],[1,"margin-bottom"],[1,"about-tab-container"],["mat-icon-button","",3,"matMenuTriggerFor"],[1,"ellipsis"],["matTooltip","Show QR code","mat-icon-button","",1,"copy-button",3,"click"],["mat-icon-button","",1,"icon-button"],["mat-icon-button","",1,"icon-button",3,"routerLink"],["mat-icon-button","",1,"icon-button",3,"click"],["mat-button",""],["mat-button","",3,"routerLink"],["mat-button","",3,"click"],["mat-menu-item",""],["mat-menu-item","",3,"routerLink"],[1,"example-tab-icon"],[1,"hide-small"],["type","button","mat-button","",3,"click"],["type","button","mat-button","",3,"disabled"],[1,"posts-header"],[3,"did"],["mat-icon-button","","matTooltip","Options",3,"matMenuTriggerFor"],[1,"post-info"],[1,"link",3,"routerLink"],[1,"post-body"],[1,"profile-items"],[1,"profile-bio"],["target","_blank",3,"href"]],template:function(e,i){1&e&&t.DNE(0,Mt,38,7)(1,Rt,2,0,"div",2),2&e&&t.vxM(i.data()?0:1)},dependencies:[x.hM,y.d,j.RI,j.ES,j.mq,j.T8,M.m_,M.An,k.Hl,k.$z,k.iY,g.Cn,g.kk,g.fb,g.Cp,b.Wk,R.w,R.q,f.MD,h.D6,h.LG,s.Hu,s.RN,s.m2,s.MM,N.w,S.g],styles:[".profile-header[_ngcontent-%COMP%]{display:flex;gap:1em;align-items:center}.profile-header-icon[_ngcontent-%COMP%]{border-radius:50%;width:128px;margin:1em}.profile-header-menu[_ngcontent-%COMP%]{padding-right:1em}h1[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:300}h1[_ngcontent-%COMP%]{margin:0;padding:0}.example-tab-icon[_ngcontent-%COMP%]{margin-right:8px}.profile-content[_ngcontent-%COMP%]{margin-top:.4em}.about-tab-container[_ngcontent-%COMP%]{padding:1em}.profile-items[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:inline-block;margin-left:.2em;margin-right:1em}.profile-bio[_ngcontent-%COMP%]{margin-top:1em}.profile-header-text[_ngcontent-%COMP%]{width:100%}.post-body[_ngcontent-%COMP%]{white-space:pre-wrap}.post-info[_ngcontent-%COMP%]{margin-bottom:8px;font-size:.9em}.posts-header[_ngcontent-%COMP%]{display:flex;align-items:center;width:100%}.posts-header[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:first-child{flex-grow:1}.posts-header[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:last-child{flex-shrink:0}@media (max-width: 1024px){.profile-header[_ngcontent-%COMP%]{gap:10;flex-direction:column;margin-left:.4em;margin-right:.4em}.profile-header-menu[_ngcontent-%COMP%]{padding-right:.4em}}"]})}}return n})()},60385:(B,D,a)=>{a.d(D,{w:()=>F});var u=a(10467),t=a(54438),k=a(34635),R=a(25596),M=a(5794),g=a(345),b=a(78013),T=a(33347),j=a(14823),O=a(30046);const y=d=>["/profile",d];function x(d,v){if(1&d&&(t.nrm(0,"img",0),t.nI1(1,"safeResourceUrl")),2&d){const s=t.XpG();t.Y8G("routerLink",t.eq3(4,y,s.did()))("src",t.bMT(1,2,s.data().avatar),t.B4B)}}function l(d,v){if(1&d&&t.nrm(0,"img",1),2&d){const s=t.XpG();t.Y8G("routerLink",t.eq3(2,y,s.did()))("src","/avatar-placeholder.png",t.B4B)}}function _(d,v){if(1&d&&t.EFF(0),2&d){let s;const c=t.XpG(2);t.SpI(" (",null==(s=c.data().profile)?null:s.title,") ")}}function f(d,v){if(1&d&&(t.j41(0,"a",3),t.EFF(1),t.DNE(2,_,1,1),t.k0s()),2&d){let s,c;const E=t.XpG();t.Y8G("routerLink",t.eq3(3,y,E.did())),t.R7$(),t.SpI("",null==(s=E.data().profile)?null:s.name," "),t.R7$(),t.vxM(null!=(c=E.data().profile)&&c.title?2:-1)}}function h(d,v){if(1&d&&t.EFF(0),2&d){let s;const c=t.XpG(2);t.SpI(" (",null==(s=c.data().profile)?null:s.title,") ")}}function m(d,v){if(1&d&&(t.j41(0,"em")(1,"a",3),t.EFF(2,"No name set "),t.DNE(3,h,1,1),t.k0s()()),2&d){let s;const c=t.XpG();t.R7$(),t.Y8G("routerLink",t.eq3(2,y,c.did())),t.R7$(2),t.vxM(null!=(s=c.data().profile)&&s.title?3:-1)}}let F=(()=>{class d{constructor(){this.identity=(0,t.WQX)(k.K),this.profile=(0,t.WQX)(M.p),this.sanitizer=(0,t.WQX)(g.up),this.did=t.hFB.required(),this.data=(0,t.vPA)({})}ngAfterViewInit(){var s=this;return(0,u.A)(function*(){if(s.did()){let c=yield s.profile.loadProfile(s.did());s.data.set(c)}})()}static{this.\u0275fac=function(c){return new(c||d)}}static{this.\u0275cmp=t.VBU({type:d,selectors:[["app-profile-header"]],inputs:{did:[1,"did"]},standalone:!0,features:[t.aNF],decls:10,vars:9,consts:[["mat-card-avatar","","onerror","this.src='/avatar-placeholder.png';this.onerror='';",1,"profile-thumbnail",3,"routerLink","src"],["mat-card-avatar","",1,"profile-thumbnail",3,"routerLink","src"],[1,"profile-header-title"],[3,"routerLink"],[1,"profile-header-subtitle"],[3,"routerLink","matTooltip"]],template:function(c,E){if(1&c&&(t.DNE(0,x,2,6,"img",0)(1,l,1,4,"img",1),t.j41(2,"div")(3,"div",2),t.DNE(4,f,3,5,"a",3)(5,m,4,4,"em"),t.k0s(),t.j41(6,"div",4)(7,"a",5),t.EFF(8),t.nI1(9,"did"),t.k0s()()()),2&c){let G;t.vxM(E.data().avatar?0:1),t.R7$(4),t.vxM(null!=(G=E.data().profile)&&G.name?4:5),t.R7$(3),t.Y8G("routerLink",t.eq3(7,y,E.did()))("matTooltip",E.did()),t.R7$(),t.JRh(t.bMT(9,5,E.did()))}},dependencies:[O.iI,O.Wk,j.uc,j.oV,R.Hu,R.QG,b.d,T.k],styles:[".profile-thumbnail[_ngcontent-%COMP%]{cursor:pointer;border-radius:50%;margin-right:1em}a[_ngcontent-%COMP%]{text-decoration:none}a[_ngcontent-%COMP%]:hover{text-decoration:underline}[_nghost-%COMP%]{display:flex}.profile-header-title[_ngcontent-%COMP%]{font-size:1.4em}.profile-header-subtitle[_ngcontent-%COMP%]{font-size:1em}"]})}}return d})()}}]);