"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3825],{93825:(K,C,o)=>{o.r(C),o.d(C,{FriendsComponent:()=>Y});var u=o(10467),e=o(93953),z=o(86600),E=o(18617),D=o(60177);let w=0;const j="mat-badge-content",v=new Set;let x=(()=>{class i{static#e=this.\u0275fac=function(a){return new(a||i)};static#t=this.\u0275cmp=e.VBU({type:i,selectors:[["ng-component"]],standalone:!0,features:[e.aNF],decls:0,vars:0,template:function(a,n){},styles:[".mat-badge{position:relative}.mat-badge.mat-badge{overflow:visible}.mat-badge-content{position:absolute;text-align:center;display:inline-block;transition:transform 200ms ease-in-out;transform:scale(0.6);overflow:hidden;white-space:nowrap;text-overflow:ellipsis;box-sizing:border-box;pointer-events:none;background-color:var(--mat-badge-background-color);color:var(--mat-badge-text-color);font-family:var(--mat-badge-text-font);font-weight:var(--mat-badge-text-weight);border-radius:var(--mat-badge-container-shape)}.cdk-high-contrast-active .mat-badge-content{outline:solid 1px;border-radius:0}.mat-badge-above .mat-badge-content{bottom:100%}.mat-badge-below .mat-badge-content{top:100%}.mat-badge-before .mat-badge-content{right:100%}[dir=rtl] .mat-badge-before .mat-badge-content{right:auto;left:100%}.mat-badge-after .mat-badge-content{left:100%}[dir=rtl] .mat-badge-after .mat-badge-content{left:auto;right:100%}.mat-badge-disabled .mat-badge-content{background-color:var(--mat-badge-disabled-state-background-color);color:var(--mat-badge-disabled-state-text-color)}.mat-badge-hidden .mat-badge-content{display:none}.ng-animate-disabled .mat-badge-content,.mat-badge-content._mat-animation-noopable{transition:none}.mat-badge-content.mat-badge-active{transform:none}.mat-badge-small .mat-badge-content{width:var(--mat-badge-legacy-small-size-container-size, unset);height:var(--mat-badge-legacy-small-size-container-size, unset);min-width:var(--mat-badge-small-size-container-size, unset);min-height:var(--mat-badge-small-size-container-size, unset);line-height:var(--mat-badge-legacy-small-size-container-size, var(--mat-badge-small-size-container-size));padding:var(--mat-badge-small-size-container-padding);font-size:var(--mat-badge-small-size-text-size);margin:var(--mat-badge-small-size-container-offset)}.mat-badge-small.mat-badge-overlap .mat-badge-content{margin:var(--mat-badge-small-size-container-overlap-offset)}.mat-badge-medium .mat-badge-content{width:var(--mat-badge-legacy-container-size, unset);height:var(--mat-badge-legacy-container-size, unset);min-width:var(--mat-badge-container-size, unset);min-height:var(--mat-badge-container-size, unset);line-height:var(--mat-badge-legacy-container-size, var(--mat-badge-container-size));padding:var(--mat-badge-container-padding);font-size:var(--mat-badge-text-size);margin:var(--mat-badge-container-offset)}.mat-badge-medium.mat-badge-overlap .mat-badge-content{margin:var(--mat-badge-container-overlap-offset)}.mat-badge-large .mat-badge-content{width:var(--mat-badge-legacy-large-size-container-size, unset);height:var(--mat-badge-legacy-large-size-container-size, unset);min-width:var(--mat-badge-large-size-container-size, unset);min-height:var(--mat-badge-large-size-container-size, unset);line-height:var(--mat-badge-legacy-large-size-container-size, var(--mat-badge-large-size-container-size));padding:var(--mat-badge-large-size-container-padding);font-size:var(--mat-badge-large-size-text-size);margin:var(--mat-badge-large-size-container-offset)}.mat-badge-large.mat-badge-overlap .mat-badge-content{margin:var(--mat-badge-large-size-container-overlap-offset)}"],encapsulation:2,changeDetection:0})}return i})(),O=(()=>{class i{get color(){return this._color}set color(t){this._setColor(t),this._color=t}get content(){return this._content}set content(t){this._updateRenderedContent(t)}get description(){return this._description}set description(t){this._updateDescription(t)}constructor(t,a,n,s,r){this._ngZone=t,this._elementRef=a,this._ariaDescriber=n,this._renderer=s,this._animationMode=r,this._color="primary",this.overlap=!0,this.position="above after",this.size="medium",this._id=w++,this._isInitialized=!1,this._interactivityChecker=(0,e.WQX)(E.Z7),this._document=(0,e.WQX)(D.qQ);const d=(0,e.WQX)(e.o8S);if(!v.has(d)){v.add(d);const c=(0,e.a0P)(x,{environmentInjector:(0,e.WQX)(e.uvJ)});d.onDestroy(()=>{v.delete(d),0===v.size&&c.destroy()})}}isAbove(){return-1===this.position.indexOf("below")}isAfter(){return-1===this.position.indexOf("before")}getBadgeElement(){return this._badgeElement}ngOnInit(){this._clearExistingBadges(),this.content&&!this._badgeElement&&(this._badgeElement=this._createBadgeElement(),this._updateRenderedContent(this.content)),this._isInitialized=!0}ngOnDestroy(){this._renderer.destroyNode&&(this._renderer.destroyNode(this._badgeElement),this._inlineBadgeDescription?.remove()),this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this.description)}_isHostInteractive(){return this._interactivityChecker.isFocusable(this._elementRef.nativeElement,{ignoreVisibility:!0})}_createBadgeElement(){const t=this._renderer.createElement("span"),a="mat-badge-active";return t.setAttribute("id",`mat-badge-content-${this._id}`),t.setAttribute("aria-hidden","true"),t.classList.add(j),"NoopAnimations"===this._animationMode&&t.classList.add("_mat-animation-noopable"),this._elementRef.nativeElement.appendChild(t),"function"==typeof requestAnimationFrame&&"NoopAnimations"!==this._animationMode?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{t.classList.add(a)})}):t.classList.add(a),t}_updateRenderedContent(t){const a=`${t??""}`.trim();this._isInitialized&&a&&!this._badgeElement&&(this._badgeElement=this._createBadgeElement()),this._badgeElement&&(this._badgeElement.textContent=a),this._content=a}_updateDescription(t){this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this.description),(!t||this._isHostInteractive())&&this._removeInlineDescription(),this._description=t,this._isHostInteractive()?this._ariaDescriber.describe(this._elementRef.nativeElement,t):this._updateInlineDescription()}_updateInlineDescription(){this._inlineBadgeDescription||(this._inlineBadgeDescription=this._document.createElement("span"),this._inlineBadgeDescription.classList.add("cdk-visually-hidden")),this._inlineBadgeDescription.textContent=this.description,this._badgeElement?.appendChild(this._inlineBadgeDescription)}_removeInlineDescription(){this._inlineBadgeDescription?.remove(),this._inlineBadgeDescription=void 0}_setColor(t){const a=this._elementRef.nativeElement.classList;a.remove(`mat-badge-${this._color}`),t&&a.add(`mat-badge-${t}`)}_clearExistingBadges(){const t=this._elementRef.nativeElement.querySelectorAll(`:scope > .${j}`);for(const a of Array.from(t))a!==this._badgeElement&&a.remove()}static#e=this.\u0275fac=function(a){return new(a||i)(e.rXU(e.SKi),e.rXU(e.aKT),e.rXU(E.vr),e.rXU(e.sFG),e.rXU(e.bc$,8))};static#t=this.\u0275dir=e.FsC({type:i,selectors:[["","matBadge",""]],hostAttrs:[1,"mat-badge"],hostVars:20,hostBindings:function(a,n){2&a&&e.AVh("mat-badge-overlap",n.overlap)("mat-badge-above",n.isAbove())("mat-badge-below",!n.isAbove())("mat-badge-before",!n.isAfter())("mat-badge-after",n.isAfter())("mat-badge-small","small"===n.size)("mat-badge-medium","medium"===n.size)("mat-badge-large","large"===n.size)("mat-badge-hidden",n.hidden||!n.content)("mat-badge-disabled",n.disabled)},inputs:{color:[0,"matBadgeColor","color"],overlap:[2,"matBadgeOverlap","overlap",e.L39],disabled:[2,"matBadgeDisabled","disabled",e.L39],position:[0,"matBadgePosition","position"],content:[0,"matBadge","content"],description:[0,"matBadgeDescription","description"],size:[0,"matBadgeSize","size"],hidden:[2,"matBadgeHidden","hidden",e.L39]},standalone:!0,features:[e.GFd]})}return i})(),T=(()=>{class i{static#e=this.\u0275fac=function(a){return new(a||i)};static#t=this.\u0275mod=e.$C({type:i});static#a=this.\u0275inj=e.G2t({imports:[E.Pd,z.yE,z.yE]})}return i})();var B=o(88834),I=o(25596),R=o(99213),N=o(3902),F=o(59115),y=o(96850),S=o(34635),m=o(22312),k=o(27276),V=o(14339),A=o(18498),g=o(37413),h=o(69371),$=o(36815),G=o(71997);const L=i=>["/profile",i],X=i=>["/app","chat",i];function W(i,p){1&i&&(e.j41(0,"mat-icon",6),e.EFF(1,"person"),e.k0s(),e.j41(2,"span",7),e.EFF(3,"Friends"),e.k0s())}function P(i,p){if(1&i&&(e.j41(0,"app-profile-card",3)(1,"button",8),e.EFF(2,"VIEW"),e.k0s(),e.j41(3,"button",9),e.EFF(4,"MESSAGE"),e.k0s()()),2&i){const t=p.$implicit;e.Y8G("did",t.data.did),e.R7$(),e.Y8G("routerLink",e.eq3(3,L,t.data.did)),e.R7$(2),e.Y8G("routerLink",e.eq3(5,X,t.data.did))}}function q(i,p){if(1&i&&(e.j41(0,"mat-icon",6),e.EFF(1,"person_add"),e.k0s(),e.j41(2,"span",10),e.EFF(3,"Requests\xa0"),e.k0s()),2&i){const t=e.XpG();e.R7$(2),e.Y8G("matBadge",t.requests().length)}}function J(i,p){if(1&i){const t=e.RV6();e.j41(0,"app-profile-card",3)(1,"button",11),e.EFF(2,"PENDING"),e.k0s(),e.j41(3,"button",12),e.bIt("click",function(){e.eBV(t);const n=e.XpG().$implicit,s=e.XpG();return e.Njj(s.reject(n))}),e.EFF(4,"CANCEL"),e.k0s()()}if(2&i){const t=e.XpG().$implicit;e.Y8G("did",t.record.recipient),e.R7$(),e.Y8G("disabled",!0)}}function Q(i,p){if(1&i){const t=e.RV6();e.j41(0,"app-profile-card",3)(1,"button",13),e.bIt("click",function(){e.eBV(t);const n=e.XpG().$implicit,s=e.XpG();return e.Njj(s.accept(n))}),e.EFF(2,"CONFIRM"),e.k0s(),e.j41(3,"button",12),e.bIt("click",function(){e.eBV(t);const n=e.XpG().$implicit,s=e.XpG();return e.Njj(s.reject(n))}),e.EFF(4,"DELETE"),e.k0s()()}if(2&i){const t=e.XpG().$implicit;e.Y8G("did",t.record.author)}}function U(i,p){1&i&&e.DNE(0,J,5,2,"app-profile-card",3)(1,Q,5,1,"app-profile-card",3),2&i&&e.vxM("out"==p.$implicit.direction?0:1)}let Y=(()=>{class i{constructor(){var t=this;this.requests=(0,e.vPA)([]),this.friends=(0,e.vPA)([]),this.identity=(0,e.WQX)(S.K),this.layout=(0,e.WQX)($.Y),this.app=(0,e.WQX)(k.d),this.layout.resetActions(),(0,e.QZP)((0,u.A)(function*(){t.app.initialized()&&(yield t.processFriends(),yield t.loadFriends(),yield t.loadRequests())}))}loadRequests(){var t=this;return(0,u.A)(function*(){var{records:a}=yield t.identity.web5.dwn.records.query({message:{filter:{protocol:m.iU.uri,schema:"https://schema.ariton.app/message/schema/request",dataFormat:"application/json"}}});if(console.log("Records from requests:"),console.log(a),a)for(const r of a){let d=yield r.data.json(),c={record:r,data:d};r.author==t.identity.did&&(c.direction="out"),t.requests.update(l=>[...l,c]),console.log("All requests:",t.requests())}})()}accept(t){var a=this;return(0,u.A)(function*(){const n=t.data.vc;if(console.log("signedVcJwt:",n),!n)return;try{yield g.l6.verify({vcJwt:n})}catch(Z){return void console.error("Error verifying VC:",Z)}const s=g.l6.parseJwt({vcJwt:n}),r=s.issuer;if(s.issuer!=t.record.author)return void console.error("VC issuer is different than data record author");console.log("Friend request validated");const d=yield g.l6.create({type:m.eE.friendship,issuer:a.identity.did,subject:r,data:{vc:n}});console.log("TWO WAY VC:",d);const c=yield a.identity.activeAgent().identity.get({didUri:a.identity.did}),l=yield d.sign({did:c.did});console.log("TWO WAY VC JWT:",l);const{record:f}=yield a.identity.web5.dwn.records.create({data:l,message:{schema:m.eE.friendship,dataFormat:m.eE.format,published:!1}});console.log("TWO WAY VC RECORD:",f);const{status:b}=yield f.send(a.identity.did);console.log("Record sent:",b,f);const{status:M,record:H}=yield a.identity.web5.dwn.records.create({data:{vc:l},store:!1,message:{recipient:r,protocol:h.Q.protocol,protocolPath:"credential",schema:h.Q.types.credential.schema,dataFormat:h.Q.types.credential.dataFormats[0]}});console.log("Request create status:",M);const{status:_}=yield H.send(r);202!==_.code?a.app.openSnackBar(`Friend request failed.Code: ${_.code}, Details: ${_.detail}.`):(a.app.openSnackBar("Friend request accepted"),yield a.reject(t))})()}reject(t){var a=this;return(0,u.A)(function*(){console.log("Rejecting request:",t);const n=t.record.recipient==a.identity.did?t.record.author:t.record.recipient;console.log("Target DID:",n),console.log("this.identity.did:",a.identity.did),console.log("entry.record.recipient:",t.record.recipient),console.log("entry.record.author:",t.record.author);const{status:s}=yield t.record.delete(),{status:r}=yield t.record.send(n);console.log("Delete status:",s),console.log("deleteSendStatus:",r),a.requests.update(d=>d.filter(c=>c!==t))})()}processFriends(){var t=this;return(0,u.A)(function*(){var{records:a}=yield t.identity.web5.dwn.records.query({message:{filter:{protocol:m.iU.uri,schema:h.Q.types.credential.schema,dataFormat:h.Q.types.credential.dataFormats[0]}}});console.log("VC Records:",a);for(const n of a){console.log("Record:",n);const s=yield n.data.json();console.log("JSON:",s);try{yield g.l6.verify({vcJwt:s.vc})}catch(l){console.error("Error verifying VC:",l),console.log("THIS REQUEST SHOULD BE DELETED FROM DWN",n.id)}const r=g.l6.parseJwt({vcJwt:s.vc});console.log("PARSED INVCOMING VC:",r),console.log("vc.issuer === this.identity.did:",r.issuer===t.identity.did);const{record:d}=yield t.identity.web5.dwn.records.create({data:s.vc,message:{schema:m.eE.friendship,dataFormat:m.eE.format,published:!1}});console.log("TWO WAY VC RECORD:",d);const{status:c}=yield d.send(t.identity.did);console.log("Record sent:",c,d),yield n?.delete()}})()}loadFriends(){var t=this;return(0,u.A)(function*(){var{records:a}=yield t.identity.web5.dwn.records.query({message:{filter:{schema:m.eE.friendship,dataFormat:m.eE.format}}});if(console.log("Friend VCs:"),console.log(a),t.friends.set([]),a)for(const r of a){let d=yield r.data.text(),c=g.l6.parseJwt({vcJwt:d}),l=c.issuer;c.issuer==t.identity.did&&(l=g.l6.parseJwt({vcJwt:c.vcDataModel.credentialSubject.vc}).issuer);let f={record:r,data:{did:l}};t.friends.update(b=>[...b,f]),console.log("All friends:",t.friends())}})()}ngOnInit(){this.layout.marginOff()}static#e=this.\u0275fac=function(a){return new(a||i)};static#t=this.\u0275cmp=e.VBU({type:i,selectors:[["app-friends"]],standalone:!0,features:[e.aNF],decls:24,vars:0,consts:[["menu","matMenu"],["mat-tab-label",""],[1,"container","responsive-grid"],[3,"did"],["xPosition","before"],["mat-menu-item",""],[1,"tab-icon"],[1,"hide-small"],["mat-flat-button","",3,"routerLink"],["mat-button","",3,"routerLink"],["matBadgeOverlap","false",1,"hide-small",3,"matBadge"],["mat-flat-button","",3,"disabled"],["mat-button","",3,"click"],["mat-flat-button","",3,"click"]],template:function(a,n){1&a&&(e.j41(0,"mat-tab-group")(1,"mat-tab"),e.DNE(2,W,4,0,"ng-template",1),e.j41(3,"div",2),e.Z7z(4,P,5,7,"app-profile-card",3,e.fX1),e.k0s(),e.j41(6,"mat-menu",4,0)(8,"button",5)(9,"mat-icon"),e.EFF(10,"favorite"),e.k0s(),e.j41(11,"span"),e.EFF(12,"Favorite"),e.k0s()(),e.nrm(13,"mat-divider"),e.j41(14,"button",5)(15,"mat-icon"),e.EFF(16,"person_remove"),e.k0s(),e.j41(17,"span"),e.EFF(18,"Unfriend"),e.k0s()()()(),e.j41(19,"mat-tab"),e.DNE(20,q,4,1,"ng-template",1),e.j41(21,"div",2),e.Z7z(22,U,2,1,null,null,e.fX1),e.k0s()()()),2&a&&(e.R7$(4),e.Dyx(n.friends()),e.R7$(18),e.Dyx(n.requests()))},dependencies:[D.MD,N.Fg,G.q,I.Hu,B.Hl,B.$z,y.RI,y.ES,y.mq,y.T8,R.m_,R.An,T,O,F.Cn,F.kk,F.fb,V.$,A.iI,A.Wk],styles:[".toolbox[_ngcontent-%COMP%]{display:flex;gap:1em;align-items:baseline}.toolbox-left[_ngcontent-%COMP%]{flex-grow:2}.toolbox-right[_ngcontent-%COMP%]{flex-grow:1}.search-input[_ngcontent-%COMP%]{width:100%}.container[_ngcontent-%COMP%]{padding:24px}img[_ngcontent-%COMP%]{width:100%;height:200px;object-fit:cover}.responsive-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:24px}mat-card-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:.2em}.mat-badge[_ngcontent-%COMP%]{margin-left:.5em;border-color:2px solid red}"]})}return i})()}}]);