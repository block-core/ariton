"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9996],{58249:(B,x,n)=>{n.d(x,{K:()=>N});var O=n(10467),t=n(93953),F=n(34635),A=n(50296),I=n(69371),_=n(71943),h=n(22312),T=n(81317),y=n(68530);let N=(()=>{class v{constructor(){this.requests=(0,t.vPA)([]),this.friends=(0,t.vPA)([]),this.identity=(0,t.WQX)(F.K),this.connection=(0,t.WQX)(T.K),this.app=(0,t.WQX)(A.d)}createRequest(a){var s=this;return(0,O.A)(function*(){const l=yield _.l6.create({type:"FriendshipCredential",issuer:s.identity.did,subject:a,data:null});console.log("VC:",l);const p=yield s.identity.activeAgent().identity.get({didUri:s.identity.did}),u=yield l.sign({did:p.did});return console.log("VC JWT:",u),{record:(yield s.connection.request(a,{app:"friends",title:"I want to be your friend.",vc:u},T.X.Friend)).record}})()}accept(a){var s=this;return(0,O.A)(function*(){const l=a.data.vc;if(!l)throw new Error("The incoming VC is missing.");if(console.log("signedVcJwt:",l),!l)return;try{yield _.l6.verify({vcJwt:l})}catch(W){return void console.error("Error verifying VC:",W)}const p=_.l6.parseJwt({vcJwt:l}),u=p.issuer;if(p.issuer!=a.record.author)return void console.error("VC issuer is different than data record author");console.log("Friend request validated");const C=yield _.l6.create({type:h.eE.friendship,issuer:s.identity.did,subject:u,data:{vc:l}});console.log("TWO WAY VC:",C);const i=yield s.identity.activeAgent().identity.get({didUri:s.identity.did}),E=yield C.sign({did:i.did});console.log("TWO WAY VC JWT:",E);const{record:r}=yield s.identity.web5.dwn.records.create({data:E,message:{schema:h.eE.friendship,dataFormat:h.eE.format,published:!1}});console.log("TWO WAY VC RECORD:",r),r.send(s.identity.did);const d={vc:E,app:"friends"},f={type:T.X.Credential},{status:R,record:M}=yield s.identity.web5.dwn.records.create({data:d,store:!1,message:{tags:f,recipient:u,protocol:y.Q.protocol,protocolPath:"request",schema:y.Q.types.request.schema,dataFormat:y.Q.types.request.dataFormats[0]}});console.log("Request create status:",R);const{status:P}=yield M.send(u);return s.app.openSnackBar(202!==P.code?`Friend request failed.Code: ${P.code}, Details: ${P.detail}.`:"Friend request accepted"),{record:M,data:d,id:M.id}})()}reject(a){var s=this;return(0,O.A)(function*(){console.log("Rejecting request:",a);const l=a.record.recipient==s.identity.did?a.record.author:a.record.recipient;console.log("Target DID:",l),console.log("this.identity.did:",s.identity.did),console.log("entry.record.recipient:",a.record.recipient),console.log("entry.record.author:",a.record.author);const{status:p}=yield a.record.delete(),{status:u}=yield a.record.send(l);console.log("Delete status:",p),console.log("deleteSendStatus:",u),s.requests.update(C=>C.filter(i=>i!==a))})()}processFriends(){var a=this;return(0,O.A)(function*(){var{records:s}=yield a.identity.web5.dwn.records.query({message:{filter:{protocol:h.iU.uri,schema:I.Q.types.credential.schema,dataFormat:I.Q.types.credential.dataFormats[0]}}});console.log("VC Records:",s);for(const l of s){console.log("Record:",l);const p=yield l.data.json();console.log("JSON:",p);try{yield _.l6.verify({vcJwt:p.vc})}catch(E){console.error("Error verifying VC:",E),console.log("THIS REQUEST SHOULD BE DELETED FROM DWN",l.id)}const u=_.l6.parseJwt({vcJwt:p.vc});console.log("PARSED INVCOMING VC:",u),console.log("vc.issuer === this.identity.did:",u.issuer===a.identity.did);const{record:C}=yield a.identity.web5.dwn.records.create({data:p.vc,message:{schema:h.eE.friendship,dataFormat:h.eE.format,published:!1}});console.log("TWO WAY VC RECORD:",C);const{status:i}=yield C.send(a.identity.did);console.log("Record sent:",i,C),yield l?.delete()}})()}loadFriends(){var a=this;return(0,O.A)(function*(){var{records:s}=yield a.identity.web5.dwn.records.query({message:{filter:{schema:h.eE.friendship,dataFormat:h.eE.format}}});if(console.log("Friend VCs:"),console.log(s),a.friends.set([]),s)for(const u of s){let C=yield u.data.text(),i=_.l6.parseJwt({vcJwt:C}),E=i.issuer;i.issuer==a.identity.did&&(E=_.l6.parseJwt({vcJwt:i.vcDataModel.credentialSubject.vc}).issuer);let r={record:u,data:{did:E}};a.friends.update(d=>[...d,r]),console.log("All friends:",a.friends())}})()}static#t=this.\u0275fac=function(s){return new(s||v)};static#e=this.\u0275prov=t.jDH({token:v,factory:v.\u0275fac,providedIn:"root"})}return v})()},49996:(B,x,n)=>{n.d(x,{$:()=>G});var O=n(10467),t=n(93953),F=n(81317),A=n(50296),I=n(60177),_=n(25596),h=n(88834),T=n(99213),y=n(30046),N=n(98703),v=n(60385),L=n(34635),a=n(58249);function s(o,g){1&o&&t.EFF(0," people ")}function l(o,g){1&o&&t.EFF(0," connect_without_contact ")}function p(o,g){1&o&&t.EFF(0," Friend Request ")}function u(o,g){1&o&&t.EFF(0," Connect Request ")}function C(o,g){1&o&&t.EFF(0," This user wants to be your friend, do you accept? This will give them access to send you sharing requets, such as shared Tasks, collabrative apps and more. ")}function i(o,g){if(1&o&&(t.EFF(0," This is a data sharing request. Do you want to accept? "),t.j41(1,"p"),t.EFF(2," App: "),t.j41(3,"span",2),t.EFF(4),t.k0s(),t.nrm(5,"br"),t.EFF(6),t.k0s()),2&o){const e=t.XpG(2);t.R7$(4),t.JRh(e.entry.data.app),t.R7$(2),t.SpI("Title: ",e.entry.data.title," ")}}function E(o,g){1&o&&t.EFF(0," Shared Credential. This will be automatically processed. ")}function r(o,g){1&o&&t.nrm(0,"br")}function d(o,g){if(1&o&&t.nrm(0,"app-profile-header",4),2&o){const e=t.XpG(2);t.Y8G("did",e.entry.record.recipient)}}function f(o,g){if(1&o&&t.nrm(0,"app-profile-header",4),2&o){const e=t.XpG(2);t.Y8G("did",e.entry.record.author)}}function R(o,g){}function M(o,g){if(1&o){const e=t.RV6();t.j41(0,"button",5),t.EFF(1,"PENDING"),t.k0s(),t.EFF(2,"\xa0 "),t.j41(3,"button",6),t.bIt("click",function(){t.eBV(e);const c=t.XpG(3);return t.Njj(c.reject(c.entry))}),t.EFF(4,"CANCEL"),t.k0s()}if(2&o){const e=t.XpG(3);t.Y8G("disabled",!0),t.R7$(3),t.Y8G("disabled",e.entry.loading)}}function P(o,g){if(1&o){const e=t.RV6();t.j41(0,"button",7),t.bIt("click",function(){t.eBV(e);const c=t.XpG(3);return t.Njj(c.accept(c.entry))}),t.EFF(1,"ACCEPT"),t.k0s(),t.EFF(2,"\xa0 "),t.j41(3,"button",6),t.bIt("click",function(){t.eBV(e);const c=t.XpG(3);return t.Njj(c.reject(c.entry))}),t.EFF(4,"DELETE"),t.k0s(),t.EFF(5,"\xa0 "),t.j41(6,"button",6),t.bIt("click",function(){t.eBV(e);const c=t.XpG(3);return t.Njj(c.block(c.entry))}),t.EFF(7,"BLOCK"),t.k0s()}if(2&o){const e=t.XpG(3);t.Y8G("disabled",e.entry.loading),t.R7$(3),t.Y8G("disabled",e.entry.loading),t.R7$(3),t.Y8G("disabled",e.entry.loading)}}function W(o,g){if(1&o&&(t.j41(0,"mat-card-actions"),t.DNE(1,M,5,2)(2,P,8,3),t.k0s()),2&o){const e=t.XpG(2);t.R7$(),t.vxM("out"==e.entry.direction?1:2)}}function b(o,g){if(1&o&&(t.j41(0,"mat-card",0)(1,"mat-card-header")(2,"mat-icon",1),t.DNE(3,s,1,0)(4,l,1,0),t.k0s(),t.j41(5,"mat-card-title"),t.DNE(6,p,1,0)(7,u,1,0),t.k0s(),t.j41(8,"mat-card-subtitle"),t.EFF(9,"Type: "),t.j41(10,"span",2),t.EFF(11),t.k0s(),t.EFF(12),t.nI1(13,"ago"),t.k0s()(),t.j41(14,"mat-card-content")(15,"div",3),t.DNE(16,C,1,0)(17,i,7,2,"p")(18,E,1,0)(19,r,1,0,"br"),t.k0s(),t.DNE(20,d,1,1,"app-profile-header",4)(21,f,1,1,"app-profile-header",4),t.k0s(),t.DNE(22,R,0,0)(23,W,3,1,"mat-card-actions"),t.k0s()),2&o){const e=t.XpG();t.R7$(3),t.vxM("friend"==e.entry.record.tags.type?3:4),t.R7$(3),t.vxM("friend"==e.entry.record.tags.type?6:7),t.R7$(5),t.JRh(e.entry.record.tags.type),t.R7$(),t.SpI(" (",t.bMT(13,7,e.entry.record.dateCreated),")"),t.R7$(4),t.vxM("friend"==e.entry.record.tags.type?16:"data"==e.entry.record.tags.type?17:"credential"==e.entry.record.tags.type?18:19),t.R7$(4),t.vxM("out"==e.entry.direction?20:21),t.R7$(2),t.vxM("credential"==e.entry.record.tags.type?22:23)}}let G=(()=>{class o{constructor(){this.entry=void 0,this.connection=(0,t.WQX)(F.K),this.friend=(0,t.WQX)(a.K),this.identity=(0,t.WQX)(L.K),this.app=(0,t.WQX)(A.d)}deleteConnection(e){e.loading=!0,this.connection.deleteConnection(e)}accept(e){var m=this;return(0,O.A)(function*(){e.loading=!0,console.log("Accepting connection request",e),e.data.did=e.record.author,console.log("CONNECTION TAGS:",JSON.stringify(e.record.tags)),console.log("CONNECTION DATA:",JSON.stringify(e.data));const c=e.record.tags.type;if(c==F.X.Friend){const D=yield m.friend.accept(e);e.data.vc=D?.data.vc,e.data.recordId=D?.id}const K=yield m.connection.create(e,c);if(console.log("Connection Entry that was made: ",K),console.log("CONNECTION TAGS BEFORE DELETE:",JSON.stringify(e.record.tags)),yield m.connection.deleteRequest(e),console.log("CONNECTION TAGS AFTER DELETE:",JSON.stringify(e.record.tags)),console.log("CONNECTION TYPE:",c),c==F.X.Data&&(console.log("ACCEPTING DATA CONNECTION:",e),"tasks"==e.data.app)){console.log("ACEPTING TASKS CONNECTION:",e),console.log("DID DWN to read from:",e.data.did),console.log("RID DWN to read from:",e.data.recordId);const{record:D,status:U}=yield m.identity.web5.dwn.records.read({from:e.data.did,message:{filter:{recordId:e.data.recordId}}});console.log("STATUS FROM READING RECORD EXTERNALLY:",U),console.log("RECORD FROM CONNECTION ACCEPT:",D);let j={};D&&(j={...yield D.data.json(),id:D.dataCid,did:D.author,created:D.dateCreated},console.log("RECORD JSON:",j))}})()}block(e){var m=this;return(0,O.A)(function*(){e.loading=!0,console.log("Blocking user",e);const c=yield m.connection.block(e.record.author);console.log("Block result: ",c)})()}reject(e){e.loading=!0,this.connection.deleteRequest(e)}static#t=this.\u0275fac=function(m){return new(m||o)};static#e=this.\u0275cmp=t.VBU({type:o,selectors:[["app-request"]],inputs:{entry:"entry"},standalone:!0,features:[t.aNF],decls:1,vars:1,consts:[["appearance","outlined",1,"card-notification"],["inline","true","mat-card-avatar","",1,"card-icon"],[1,"capitalize"],[1,"notification-description"],[3,"did"],["mat-flat-button","",3,"disabled"],["mat-button","",3,"click","disabled"],["mat-flat-button","",3,"click","disabled"]],template:function(m,c){1&m&&t.DNE(0,b,24,9,"mat-card",0),2&m&&t.vxM(c.entry?0:-1)},dependencies:[v.w,N.g,I.MD,_.Hu,_.RN,_.YY,_.QG,_.m2,_.MM,_.Lc,_.dh,h.Hl,h.$z,T.m_,T.An,y.iI],styles:[".card-icon[_ngcontent-%COMP%]{font-size:3em}.card-notification[_ngcontent-%COMP%]{margin-bottom:1em}.notifications-title[_ngcontent-%COMP%]{display:flex;width:100%}.notifications-card[_ngcontent-%COMP%]{max-width:600px;width:100%}.card-notification[_ngcontent-%COMP%]   mat-card-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}.notification-description[_ngcontent-%COMP%]{margin-bottom:1em}"]})}return o})()},60385:(B,x,n)=>{n.d(x,{w:()=>C});var O=n(10467),t=n(93953),F=n(34635),A=n(25596),I=n(39434),_=n(345),h=n(78013),T=n(33347),y=n(14823),N=n(30046);const v=i=>["/profile",i];function L(i,E){if(1&i&&(t.nrm(0,"img",0),t.nI1(1,"safeResourceUrl")),2&i){let r;const d=t.XpG();t.Y8G("routerLink",t.eq3(4,v,null==(r=d.data().profile)?null:r.did))("src",t.bMT(1,2,d.data().avatar),t.B4B)}}function a(i,E){if(1&i&&t.nrm(0,"img",1),2&i){let r;const d=t.XpG();t.Y8G("routerLink",t.eq3(2,v,null==(r=d.data().profile)?null:r.did))("src","/avatar-placeholder.png",t.B4B)}}function s(i,E){if(1&i&&t.EFF(0),2&i){let r;const d=t.XpG(2);t.SpI(" (",null==(r=d.data().profile)?null:r.title,") ")}}function l(i,E){if(1&i&&(t.j41(0,"a",3),t.EFF(1),t.DNE(2,s,1,1),t.k0s()),2&i){let r,d,f;const R=t.XpG();t.Y8G("routerLink",t.eq3(3,v,null==(r=R.data().profile)?null:r.did)),t.R7$(),t.SpI("",null==(d=R.data().profile)?null:d.name," "),t.R7$(),t.vxM(null!=(f=R.data().profile)&&f.title?2:-1)}}function p(i,E){if(1&i&&t.EFF(0),2&i){let r;const d=t.XpG(2);t.SpI(" (",null==(r=d.data().profile)?null:r.title,") ")}}function u(i,E){if(1&i&&(t.j41(0,"em")(1,"a",3),t.EFF(2,"No name set "),t.DNE(3,p,1,1),t.k0s()()),2&i){let r,d;const f=t.XpG();t.R7$(),t.Y8G("routerLink",t.eq3(2,v,null==(r=f.data().profile)?null:r.did)),t.R7$(2),t.vxM(null!=(d=f.data().profile)&&d.title?3:-1)}}let C=(()=>{class i{constructor(){this.identity=(0,t.WQX)(F.K),this.profile=(0,t.WQX)(I.p),this.sanitizer=(0,t.WQX)(_.up),this.did=t.hFB.required(),this.data=(0,t.vPA)({})}ngAfterViewInit(){var r=this;return(0,O.A)(function*(){if(r.did()){const d=yield r.profile.loadProfile(r.did());console.log(d),r.data.set(d)}})()}static#t=this.\u0275fac=function(d){return new(d||i)};static#e=this.\u0275cmp=t.VBU({type:i,selectors:[["app-profile-header"]],inputs:{did:[1,"did"]},standalone:!0,features:[t.aNF],decls:10,vars:9,consts:[["mat-card-avatar","","onerror","this.src='/avatar-placeholder.png';this.onerror='';",1,"profile-thumbnail",3,"routerLink","src"],["mat-card-avatar","",1,"profile-thumbnail",3,"routerLink","src"],[1,"profile-header-title"],[3,"routerLink"],[1,"profile-header-subtitle"],[3,"routerLink","matTooltip"]],template:function(d,f){if(1&d&&(t.DNE(0,L,2,6,"img",0)(1,a,1,4,"img",1),t.j41(2,"div")(3,"div",2),t.DNE(4,l,3,5,"a",3)(5,u,4,4,"em"),t.k0s(),t.j41(6,"div",4)(7,"a",5),t.EFF(8),t.nI1(9,"did"),t.k0s()()()),2&d){let R,M,P,W;t.vxM(f.data().avatar?0:1),t.R7$(4),t.vxM(null!=(R=f.data().profile)&&R.name?4:5),t.R7$(3),t.Y8G("routerLink",t.eq3(7,v,null==(M=f.data().profile)?null:M.did))("matTooltip",null==(P=f.data().profile)?null:P.did),t.R7$(),t.JRh(t.bMT(9,5,null==(W=f.data().profile)?null:W.did))}},dependencies:[N.iI,N.Wk,y.uc,y.oV,A.Hu,A.QG,h.d,T.k],styles:[".profile-thumbnail[_ngcontent-%COMP%]{cursor:pointer;border-radius:50%;margin-right:1em}a[_ngcontent-%COMP%]{text-decoration:none}a[_ngcontent-%COMP%]:hover{text-decoration:underline}[_nghost-%COMP%]{display:flex}.profile-header-title[_ngcontent-%COMP%]{font-size:1.4em}.profile-header-subtitle[_ngcontent-%COMP%]{font-size:1em}"]})}return i})()}}]);