"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1276],{41276:(k,f,e)=>{e.r(f),e.d(f,{NotificationsComponent:()=>r});var l=e(10467),t=e(93953),p=e(88834),m=e(79703),_=e(25596),v=e(38266),h=e(99213),P=e(32231),E=e(54087),g=e(59115),d=e(30046),M=e(87289),F=e(12978),O=e(36899);const b=()=>["/settings","notifications"];function D(s,a){if(1&s&&(t.j41(0,"div",10),t.EFF(1),t.k0s(),t.nrm(2,"app-profile-header",11)),2&s){const i=t.XpG().$implicit;t.R7$(),t.JRh(i.data.description),t.R7$(),t.Y8G("did",i.data.author)}}function T(s,a){if(1&s&&(t.j41(0,"div",10),t.EFF(1),t.k0s(),t.nrm(2,"app-profile-header",11)),2&s){const i=t.XpG().$implicit;t.R7$(),t.JRh(i.data.description),t.R7$(),t.Y8G("did",i.record.author)}}function N(s,a){if(1&s){const i=t.RV6();t.j41(0,"mat-card",5)(1,"mat-card-header")(2,"mat-icon",7),t.EFF(3),t.k0s(),t.j41(4,"mat-card-title"),t.EFF(5),t.k0s(),t.j41(6,"mat-card-subtitle"),t.EFF(7),t.nI1(8,"ago"),t.k0s()(),t.j41(9,"mat-card-content"),t.DNE(10,D,3,2)(11,T,3,2),t.k0s(),t.j41(12,"mat-card-actions")(13,"button",8),t.bIt("click",function(){const o=t.eBV(i).$implicit,c=t.XpG();return t.Njj(c.accept(o))}),t.EFF(14,"ACCEPT"),t.k0s(),t.j41(15,"button",9),t.bIt("click",function(){const o=t.eBV(i).$implicit,c=t.XpG();return t.Njj(c.deleteNotification(o))}),t.EFF(16,"DELETE"),t.k0s(),t.j41(17,"button",9),t.bIt("click",function(){const o=t.eBV(i).$implicit,c=t.XpG();return t.Njj(c.block(o))}),t.EFF(18,"BLOCK"),t.k0s()()()}if(2&s){const i=a.$implicit;t.R7$(3),t.JRh(i.data.icon),t.R7$(2),t.JRh(i.data.title),t.R7$(2),t.Lme("App: ",i.data.app," (",t.bMT(8,8,"2024-08-22 12:00"),")"),t.R7$(3),t.vxM("Friends"===i.data.app?10:"Connect"===i.data.app?11:-1),t.R7$(3),t.Y8G("disabled",i.loading),t.R7$(2),t.Y8G("disabled",i.loading),t.R7$(2),t.Y8G("disabled",i.loading)}}let r=(()=>{class s{constructor(){var i=this;this.layout=(0,t.WQX)(m.Y),this.notification=(0,t.WQX)(v.J),this.connection=(0,t.WQX)(F.K),this.identity=(0,t.WQX)(O.K),this.app=(0,t.WQX)(E.d),this.notifications=(0,t.vPA)([]),this.layout.marginOn(),this.layout.resetActions(),(0,t.QZP)((0,l.A)(function*(){i.app.initialized()&&(yield i.loadNotifications())}))}accept(i){return(0,l.A)(function*(){})()}deleteNotifications(){var i=this;return(0,l.A)(function*(){for(const n of i.notifications())yield n.record.delete();i.notifications.set([])})()}deleteNotification(i){var n=this;return(0,l.A)(function*(){i.loading=!0;const o=i.record.author,c=yield n.connection.loadConnections(o);for(const u of c)yield u.record.delete(),yield u.record.send(n.identity.did);const{status:C}=yield i.record.delete();console.log("Delete status: ",C),n.notifications.update(u=>[...u.filter(R=>R.id!==i.id)])})()}block(i){var n=this;return(0,l.A)(function*(){i.loading=!0,console.log("Blocking user",i);const o=i.record.author,c=yield n.connection.block(o);console.log("Block result: ",c),yield n.deleteNotification(i)})()}generateNotification(){var i=this;return(0,l.A)(function*(){const n=yield i.notification.create({author:"did:dht:bi3bzoke6rq6fbkojpo5ebtg45eqx1owqrb4esex8t9nz14ugnao",title:"Friend Request",description:"This user wants to be your friend, do you accept? This will give them access to send you sharing requets, such as shared Tasks, collabrative apps and more.",app:"Friends",icon:"people",connectRecordId:"123"});i.notifications.update(c=>[...c,n]);const o=yield i.notification.create({author:"did:dht:1ko4cqh7c7i9z56r7qwucgpbra934rngc5eyffg1km5k6rc5991o",title:"Connect Request",description:"This user wants to connect with you, you have to accept an initial connect request to be able to receive other sharing requests, such as shared Tasks, collabrative apps and more. Only accept this request if you know the user. This is to avoid spam messages.",app:"Connect",icon:"connect_without_contact",connectRecordId:"123"});i.notifications.update(c=>[...c,o])})()}loadNotifications(){var i=this;return(0,l.A)(function*(){const n=yield i.notification.load();i.notifications.set(n)})()}enableNotifications(){var i=this;return(0,l.A)(function*(){console.log("Notifications enabled"),i.sendNotification("Hello World")})()}disableNotifications(){return(0,l.A)(function*(){console.log("Notifications disabled")})()}ngOnInit(){var i=this;return(0,l.A)(function*(){console.log("Notifications component loaded"),i.registration=yield navigator.serviceWorker.getRegistration()})()}sendNotification(i){var n=this;return(0,l.A)(function*(){console.log("Sending notification"),"granted"===Notification.permission?(console.log("Notifications enabled!!!!"),n.showNotification(i)):(console.error("Notifications not enabled"),"denied"!==Notification.permission&&"granted"===(yield Notification.requestPermission())&&n.showNotification("Hello World"))})()}showNotification(i){var n=this;return(0,l.A)(function*(){var o="Ariton says hi!";const c={body:i};console.log("Showing notification"),n.registration&&"showNotification"in n.registration?(console.log("Using service worker"),n.registration.showNotification(o,c)):(console.log("Using new notification"),new Notification(o,c))})()}static#t=this.\u0275fac=function(n){return new(n||s)};static#i=this.\u0275cmp=t.VBU({type:s,selectors:[["app-notifications"]],standalone:!0,features:[t.aNF],decls:36,vars:3,consts:[[1,"toolbar-actions","margin-bottom","notifications-card"],["type","button","mat-button","",3,"disabled"],["type","button","mat-button","",3,"click"],["type","button","mat-button","",3,"routerLink"],[1,"notifications-card"],["appearance","outlined",1,"card-notification"],["mat-flat-button","",3,"click"],["inline","true","mat-card-avatar","",1,"card-icon"],["mat-flat-button","",3,"click","disabled"],["mat-button","",3,"click","disabled"],[1,"notification-description"],[3,"did"]],template:function(n,o){1&n&&(t.j41(0,"mat-card",0)(1,"mat-card-content")(2,"h1"),t.EFF(3,"Notifications"),t.k0s(),t.j41(4,"button",1)(5,"mat-icon"),t.EFF(6,"check"),t.k0s(),t.j41(7,"span"),t.EFF(8,"Mark all as read"),t.k0s()(),t.j41(9,"button",2),t.bIt("click",function(){return o.deleteNotifications()}),t.j41(10,"mat-icon"),t.EFF(11,"delete"),t.k0s(),t.j41(12,"span"),t.EFF(13,"Delete all"),t.k0s()(),t.j41(14,"button",3)(15,"mat-icon"),t.EFF(16,"settings"),t.k0s(),t.j41(17,"span"),t.EFF(18,"Notification Settings"),t.k0s()()()(),t.j41(19,"mat-card",4)(20,"mat-card-content"),t.Z7z(21,N,19,10,"mat-card",5,t.fX1),t.k0s()(),t.j41(23,"p"),t.EFF(24,"TODO: This notification should use the modern support for browser vendor based infrastructure for notifications."),t.k0s(),t.j41(25,"button",6),t.bIt("click",function(){return o.generateNotification()}),t.EFF(26,"Create a sample notification"),t.k0s(),t.EFF(27,"\n\xa0\n"),t.j41(28,"button",6),t.bIt("click",function(){return o.enableNotifications()}),t.EFF(29,"Enable Device Notifications"),t.k0s(),t.EFF(30,"\n\xa0\n"),t.j41(31,"button",6),t.bIt("click",function(){return o.disableNotifications()}),t.EFF(32,"Disable Device Notifications"),t.k0s(),t.EFF(33,"\n\xa0\n"),t.j41(34,"button",6),t.bIt("click",function(){return o.sendNotification("Welcome to Ariton!")}),t.EFF(35,"Trigger notification"),t.k0s()),2&n&&(t.R7$(4),t.Y8G("disabled",!0),t.R7$(10),t.Y8G("routerLink",t.lJ4(2,b)),t.R7$(7),t.Dyx(o.notifications()))},dependencies:[M.w,p.Hl,p.$z,_.Hu,_.RN,_.YY,_.QG,_.m2,_.MM,_.Lc,_.dh,h.m_,h.An,g.Cn,d.iI,d.Wk,P.g],styles:[".card-icon[_ngcontent-%COMP%]{font-size:3em}.card-notification[_ngcontent-%COMP%]{margin-bottom:1em}.notifications-title[_ngcontent-%COMP%]{display:flex;width:100%}[_nghost-%COMP%]{display:flex;flex-direction:column;align-items:center}.notifications-card[_ngcontent-%COMP%]{max-width:600px;width:100%}.card-notification[_ngcontent-%COMP%]   mat-card-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}.notification-description[_ngcontent-%COMP%]{margin-bottom:1em}"]})}return s})()},87289:(k,f,e)=>{e.d(f,{w:()=>N});var l=e(10467),t=e(93953),p=e(36899),m=e(25596),_=e(21698),v=e(345),h=e(789),P=e(58075),E=e(14823),g=e(30046);const d=r=>["/profile",r];function M(r,s){if(1&r&&(t.nrm(0,"img",0),t.nI1(1,"safeResourceUrl")),2&r){let a;const i=t.XpG();t.Y8G("routerLink",t.eq3(4,d,null==(a=i.data().profile)?null:a.did))("src",t.bMT(1,2,i.data().avatar),t.B4B)}}function F(r,s){if(1&r&&t.nrm(0,"img",1),2&r){let a;const i=t.XpG();t.Y8G("routerLink",t.eq3(2,d,null==(a=i.data().profile)?null:a.did))("src","/avatar-placeholder.png",t.B4B)}}function O(r,s){if(1&r&&t.EFF(0),2&r){let a;const i=t.XpG(2);t.SpI(" (",null==(a=i.data().profile)?null:a.title,") ")}}function b(r,s){if(1&r&&(t.j41(0,"a",3),t.EFF(1),t.DNE(2,O,1,1),t.k0s()),2&r){let a,i,n;const o=t.XpG();t.Y8G("routerLink",t.eq3(3,d,null==(a=o.data().profile)?null:a.did)),t.R7$(),t.SpI("",null==(i=o.data().profile)?null:i.name," "),t.R7$(),t.vxM(null!=(n=o.data().profile)&&n.title?2:-1)}}function D(r,s){if(1&r&&t.EFF(0),2&r){let a;const i=t.XpG(2);t.SpI(" (",null==(a=i.data().profile)?null:a.title,") ")}}function T(r,s){if(1&r&&(t.j41(0,"em")(1,"a",3),t.EFF(2,"No name set "),t.DNE(3,D,1,1),t.k0s()()),2&r){let a,i;const n=t.XpG();t.R7$(),t.Y8G("routerLink",t.eq3(2,d,null==(a=n.data().profile)?null:a.did)),t.R7$(2),t.vxM(null!=(i=n.data().profile)&&i.title?3:-1)}}let N=(()=>{class r{constructor(){this.identity=(0,t.WQX)(p.K),this.profile=(0,t.WQX)(_.p),this.sanitizer=(0,t.WQX)(v.up),this.did=t.hFB.required(),this.data=(0,t.vPA)({})}ngAfterViewInit(){var a=this;return(0,l.A)(function*(){if(a.did()){const i=yield a.profile.loadProfile(a.did());console.log(i),a.data.set(i)}})()}static#t=this.\u0275fac=function(i){return new(i||r)};static#i=this.\u0275cmp=t.VBU({type:r,selectors:[["app-profile-header"]],inputs:{did:[1,"did"]},standalone:!0,features:[t.aNF],decls:10,vars:9,consts:[["mat-card-avatar","","onerror","this.src='/avatar-placeholder.png';this.onerror='';",1,"profile-thumbnail",3,"routerLink","src"],["mat-card-avatar","",1,"profile-thumbnail",3,"routerLink","src"],[1,"profile-header-title"],[3,"routerLink"],[1,"profile-header-subtitle"],[3,"routerLink","matTooltip"]],template:function(i,n){if(1&i&&(t.DNE(0,M,2,6,"img",0)(1,F,1,4,"img",1),t.j41(2,"div")(3,"div",2),t.DNE(4,b,3,5,"a",3)(5,T,4,4,"em"),t.k0s(),t.j41(6,"div",4)(7,"a",5),t.EFF(8),t.nI1(9,"did"),t.k0s()()()),2&i){let o,c,C,u;t.vxM(n.data().avatar?0:1),t.R7$(4),t.vxM(null!=(o=n.data().profile)&&o.name?4:5),t.R7$(3),t.Y8G("routerLink",t.eq3(7,d,null==(c=n.data().profile)?null:c.did))("matTooltip",null==(C=n.data().profile)?null:C.did),t.R7$(),t.JRh(t.bMT(9,5,null==(u=n.data().profile)?null:u.did))}},dependencies:[g.iI,g.Wk,E.uc,E.oV,m.Hu,m.QG,h.d,P.k],styles:[".profile-thumbnail[_ngcontent-%COMP%]{cursor:pointer;border-radius:50%;margin-right:1em}a[_ngcontent-%COMP%]{text-decoration:none}a[_ngcontent-%COMP%]:hover{text-decoration:underline}[_nghost-%COMP%]{display:flex}.profile-header-title[_ngcontent-%COMP%]{font-size:1.4em}.profile-header-subtitle[_ngcontent-%COMP%]{font-size:1em}"]})}return r})()}}]);