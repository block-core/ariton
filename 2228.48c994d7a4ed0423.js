"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2228],{92228:(A,_,a)=>{a.r(_),a.d(_,{NotificationsComponent:()=>P});var s=a(10467),t=a(93953),f=a(88834),m=a(36815),r=a(25596),h=a(82546),u=a(99213),g=a(98703),b=a(31439),E=a(59115),p=a(30046),F=a(60385),N=a(81317),k=a(34635);const v=()=>["/settings","notifications"];function C(c,d){if(1&c&&(t.j41(0,"div",10),t.EFF(1),t.k0s(),t.nrm(2,"app-profile-header",11)),2&c){const i=t.XpG().$implicit;t.R7$(),t.JRh(i.data.description),t.R7$(),t.Y8G("did",i.data.author)}}function O(c,d){if(1&c&&(t.j41(0,"div",10),t.EFF(1),t.k0s(),t.nrm(2,"app-profile-header",11)),2&c){const i=t.XpG().$implicit;t.R7$(),t.JRh(i.data.description),t.R7$(),t.Y8G("did",i.record.author)}}function M(c,d){if(1&c){const i=t.RV6();t.j41(0,"mat-card",5)(1,"mat-card-header")(2,"mat-icon",7),t.EFF(3),t.k0s(),t.j41(4,"mat-card-title"),t.EFF(5),t.k0s(),t.j41(6,"mat-card-subtitle"),t.EFF(7),t.nI1(8,"ago"),t.k0s()(),t.j41(9,"mat-card-content"),t.DNE(10,C,3,2)(11,O,3,2),t.k0s(),t.j41(12,"mat-card-actions")(13,"button",8),t.bIt("click",function(){const n=t.eBV(i).$implicit,e=t.XpG();return t.Njj(e.accept(n))}),t.EFF(14,"ACCEPT"),t.k0s(),t.j41(15,"button",9),t.bIt("click",function(){const n=t.eBV(i).$implicit,e=t.XpG();return t.Njj(e.deleteNotification(n))}),t.EFF(16,"DELETE"),t.k0s(),t.j41(17,"button",9),t.bIt("click",function(){const n=t.eBV(i).$implicit,e=t.XpG();return t.Njj(e.block(n))}),t.EFF(18,"BLOCK"),t.k0s()()()}if(2&c){const i=d.$implicit;t.R7$(3),t.JRh(i.data.icon),t.R7$(2),t.JRh(i.data.title),t.R7$(2),t.Lme("App: ",i.data.app," (",t.bMT(8,8,"2024-08-22 12:00"),")"),t.R7$(3),t.vxM("Friends"===i.data.app?10:"Connect"===i.data.app?11:-1),t.R7$(3),t.Y8G("disabled",i.loading),t.R7$(2),t.Y8G("disabled",i.loading),t.R7$(2),t.Y8G("disabled",i.loading)}}let P=(()=>{class c{constructor(){var i=this;this.layout=(0,t.WQX)(m.Y),this.notification=(0,t.WQX)(h.J),this.connection=(0,t.WQX)(N.K),this.identity=(0,t.WQX)(k.K),this.app=(0,t.WQX)(b.d),this.notifications=(0,t.vPA)([]),this.layout.marginOn(),this.layout.resetActions(),(0,t.QZP)((0,s.A)(function*(){i.app.initialized()&&(yield i.loadNotifications())}))}accept(i){var o=this;return(0,s.A)(function*(){i.loading=!0,console.log("Accepting connection request"),("Friends"===i.data.app||"Connect"===i.data.app)&&(o.connection.create({did:i.data.author}),o.deleteNotification(i))})()}deleteNotifications(){var i=this;return(0,s.A)(function*(){for(const o of i.notifications())yield o.record.delete();i.notifications.set([])})()}deleteNotification(i){var o=this;return(0,s.A)(function*(){i.loading=!0;const n=i.record.author,e=yield o.connection.loadConnections(n);for(const l of e)yield l.record.delete(),yield l.record.send(o.identity.did);const{status:R}=yield i.record.delete();console.log("Delete status: ",R),o.notifications.update(l=>[...l.filter(T=>T.id!==i.id)])})()}block(i){var o=this;return(0,s.A)(function*(){i.loading=!0,console.log("Blocking user",i);const n=i.record.author,e=yield o.connection.block(n);console.log("Block result: ",e),yield o.deleteNotification(i)})()}generateNotification(){var i=this;return(0,s.A)(function*(){yield i.connection.request("did:dht:bi3bzoke6rq6fbkojpo5ebtg45eqx1owqrb4esex8t9nz14ugnao",{});const o=yield i.notification.create({author:"did:dht:bi3bzoke6rq6fbkojpo5ebtg45eqx1owqrb4esex8t9nz14ugnao",title:"Friend Request",description:"This user wants to be your friend, do you accept? This will give them access to send you sharing requets, such as shared Tasks, collabrative apps and more.",app:"Friends",icon:"people",connectRecordId:"123"});i.notifications.update(e=>[...e,o]);const n=yield i.notification.create({author:"did:dht:1ko4cqh7c7i9z56r7qwucgpbra934rngc5eyffg1km5k6rc5991o",title:"Connect Request",description:"This user wants to connect with you, you have to accept an initial connect request to be able to receive other sharing requests, such as shared Tasks, collabrative apps and more. Only accept this request if you know the user. This is to avoid spam messages.",app:"Connect",icon:"connect_without_contact",connectRecordId:"123"});i.notifications.update(e=>[...e,n])})()}loadNotifications(){var i=this;return(0,s.A)(function*(){const o=yield i.notification.load();i.notifications.set(o)})()}enableNotifications(){var i=this;return(0,s.A)(function*(){console.log("Notifications enabled"),i.sendNotification("Hello World")})()}disableNotifications(){return(0,s.A)(function*(){console.log("Notifications disabled")})()}ngOnInit(){var i=this;return(0,s.A)(function*(){console.log("Notifications component loaded"),i.registration=yield navigator.serviceWorker.getRegistration()})()}sendNotification(i){var o=this;return(0,s.A)(function*(){console.log("Sending notification"),"granted"===Notification.permission?(console.log("Notifications enabled!!!!"),o.showNotification(i)):(console.error("Notifications not enabled"),"denied"!==Notification.permission&&"granted"===(yield Notification.requestPermission())&&o.showNotification("Hello World"))})()}showNotification(i){var o=this;return(0,s.A)(function*(){var n="Ariton says hi!";const e={body:i};console.log("Showing notification"),o.registration&&"showNotification"in o.registration?(console.log("Using service worker"),o.registration.showNotification(n,e)):(console.log("Using new notification"),new Notification(n,e))})()}static#t=this.\u0275fac=function(o){return new(o||c)};static#i=this.\u0275cmp=t.VBU({type:c,selectors:[["app-notifications"]],standalone:!0,features:[t.aNF],decls:37,vars:3,consts:[[1,"toolbar-actions","margin-bottom","notifications-card"],["type","button","mat-button","",3,"disabled"],["type","button","mat-button","",3,"click"],["type","button","mat-button","",3,"routerLink"],[1,"notifications-card"],["appearance","outlined",1,"card-notification"],["mat-flat-button","",3,"click"],["inline","true","mat-card-avatar","",1,"card-icon"],["mat-flat-button","",3,"click","disabled"],["mat-button","",3,"click","disabled"],[1,"notification-description"],[3,"did"]],template:function(o,n){1&o&&(t.j41(0,"mat-card",0)(1,"mat-card-content")(2,"h1"),t.EFF(3,"Notifications"),t.k0s(),t.j41(4,"button",1)(5,"mat-icon"),t.EFF(6,"check"),t.k0s(),t.j41(7,"span"),t.EFF(8,"Mark all as read"),t.k0s()(),t.j41(9,"button",2),t.bIt("click",function(){return n.deleteNotifications()}),t.j41(10,"mat-icon"),t.EFF(11,"delete"),t.k0s(),t.j41(12,"span"),t.EFF(13,"Delete all"),t.k0s()(),t.j41(14,"button",3)(15,"mat-icon"),t.EFF(16,"settings"),t.k0s(),t.j41(17,"span"),t.EFF(18,"Notification Settings"),t.k0s()()()(),t.j41(19,"mat-card",4),t.nrm(20,"mat-card-header"),t.j41(21,"mat-card-content"),t.Z7z(22,M,19,10,"mat-card",5,t.fX1),t.k0s()(),t.j41(24,"p"),t.EFF(25,"TODO: This notification should use the modern support for browser vendor based infrastructure for notifications."),t.k0s(),t.j41(26,"button",6),t.bIt("click",function(){return n.generateNotification()}),t.EFF(27,"Create a sample notification"),t.k0s(),t.EFF(28,"\n\xa0\n"),t.j41(29,"button",6),t.bIt("click",function(){return n.enableNotifications()}),t.EFF(30,"Enable Device Notifications"),t.k0s(),t.EFF(31,"\n\xa0\n"),t.j41(32,"button",6),t.bIt("click",function(){return n.disableNotifications()}),t.EFF(33,"Disable Device Notifications"),t.k0s(),t.EFF(34,"\n\xa0\n"),t.j41(35,"button",6),t.bIt("click",function(){return n.sendNotification("Welcome to Ariton!")}),t.EFF(36,"Trigger notification"),t.k0s()),2&o&&(t.R7$(4),t.Y8G("disabled",!0),t.R7$(10),t.Y8G("routerLink",t.lJ4(2,v)),t.R7$(8),t.Dyx(n.notifications()))},dependencies:[F.w,f.Hl,f.$z,r.Hu,r.RN,r.YY,r.QG,r.m2,r.MM,r.Lc,r.dh,u.m_,u.An,E.Cn,p.iI,p.Wk,g.g],styles:[".card-icon[_ngcontent-%COMP%]{font-size:3em}.card-notification[_ngcontent-%COMP%]{margin-bottom:1em}.notifications-title[_ngcontent-%COMP%]{display:flex;width:100%}[_nghost-%COMP%]{display:flex;flex-direction:column;align-items:center}.notifications-card[_ngcontent-%COMP%]{max-width:600px;width:100%}.card-notification[_ngcontent-%COMP%]   mat-card-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}.notification-description[_ngcontent-%COMP%]{margin-bottom:1em}"]})}return c})()}}]);