"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9996],{58249:(L,B,o)=>{o.d(B,{K:()=>W});var O=o(10467),t=o(93953),F=o(34635),A=o(50296),I=o(69371),_=o(71943),h=o(22312),D=o(81317),T=o(68530);let W=(()=>{class v{constructor(){this.requests=(0,t.vPA)([]),this.friends=(0,t.vPA)([]),this.identity=(0,t.WQX)(F.K),this.connection=(0,t.WQX)(D.K),this.app=(0,t.WQX)(A.d)}createRequest(a){var s=this;return(0,O.A)(function*(){const l=yield _.l6.create({type:"FriendshipCredential",issuer:s.identity.did,subject:a,data:null});console.log("VC:",l);const u=yield s.identity.activeAgent().identity.get({didUri:s.identity.did}),p=yield l.sign({did:u.did});return console.log("VC JWT:",p),{record:(yield s.connection.request(a,{app:"friends",title:"I want to be your friend.",vc:p},D.X.Friend)).record}})()}accept(a){var s=this;return(0,O.A)(function*(){const l=a.data.vc;if(!l)throw new Error("The incoming VC is missing.");if(console.log("signedVcJwt:",l),!l)return;try{yield _.l6.verify({vcJwt:l})}catch(x){return void console.error("Error verifying VC:",x)}const u=_.l6.parseJwt({vcJwt:l}),p=u.issuer;if(u.issuer!=a.record.author)return void console.error("VC issuer is different than data record author");console.log("Friend request validated");const m=yield _.l6.create({type:h.eE.friendship,issuer:s.identity.did,subject:p,data:{vc:l}});console.log("TWO WAY VC:",m);const i=yield s.identity.activeAgent().identity.get({didUri:s.identity.did}),f=yield m.sign({did:i.did});console.log("TWO WAY VC JWT:",f);const{record:r}=yield s.identity.web5.dwn.records.create({data:f,message:{schema:h.eE.friendship,dataFormat:h.eE.format,published:!1}});console.log("TWO WAY VC RECORD:",r),r.send(s.identity.did);const d={vc:f,app:"friends"},C={type:D.X.Credential},{status:y,record:M}=yield s.identity.web5.dwn.records.create({data:d,store:!1,message:{tags:C,recipient:p,protocol:T.Q.protocol,protocolPath:"request",schema:T.Q.types.request.schema,dataFormat:T.Q.types.request.dataFormats[0]}});console.log("Request create status:",y);const{status:P}=yield M.send(p);return s.app.openSnackBar(202!==P.code?`Friend request failed.Code: ${P.code}, Details: ${P.detail}.`:"Friend request accepted"),{record:M,data:d,id:M.id}})()}reject(a){var s=this;return(0,O.A)(function*(){console.log("Rejecting request:",a);const l=a.record.recipient==s.identity.did?a.record.author:a.record.recipient;console.log("Target DID:",l),console.log("this.identity.did:",s.identity.did),console.log("entry.record.recipient:",a.record.recipient),console.log("entry.record.author:",a.record.author);const{status:u}=yield a.record.delete(),{status:p}=yield a.record.send(l);console.log("Delete status:",u),console.log("deleteSendStatus:",p),s.requests.update(m=>m.filter(i=>i!==a))})()}processFriends(){var a=this;return(0,O.A)(function*(){var{records:s}=yield a.identity.web5.dwn.records.query({message:{filter:{protocol:h.iU.uri,schema:I.Q.types.credential.schema,dataFormat:I.Q.types.credential.dataFormats[0]}}});console.log("VC Records:",s);for(const l of s){console.log("Record:",l);const u=yield l.data.json();console.log("JSON:",u);try{yield _.l6.verify({vcJwt:u.vc})}catch(f){console.error("Error verifying VC:",f),console.log("THIS REQUEST SHOULD BE DELETED FROM DWN",l.id)}const p=_.l6.parseJwt({vcJwt:u.vc});console.log("PARSED INVCOMING VC:",p),console.log("vc.issuer === this.identity.did:",p.issuer===a.identity.did);const{record:m}=yield a.identity.web5.dwn.records.create({data:u.vc,message:{schema:h.eE.friendship,dataFormat:h.eE.format,published:!1}});console.log("TWO WAY VC RECORD:",m);const{status:i}=yield m.send(a.identity.did);console.log("Record sent:",i,m),yield l?.delete()}})()}loadFriends(){var a=this;return(0,O.A)(function*(){var{records:s}=yield a.identity.web5.dwn.records.query({message:{filter:{schema:h.eE.friendship,dataFormat:h.eE.format}}});if(console.log("Friend VCs:"),console.log(s),a.friends.set([]),s)for(const p of s){let m=yield p.data.text(),i=_.l6.parseJwt({vcJwt:m}),f=i.issuer;i.issuer==a.identity.did&&(f=_.l6.parseJwt({vcJwt:i.vcDataModel.credentialSubject.vc}).issuer);let r={record:p,data:{did:f}};a.friends.update(d=>[...d,r]),console.log("All friends:",a.friends())}})()}static#t=this.\u0275fac=function(s){return new(s||v)};static#e=this.\u0275prov=t.jDH({token:v,factory:v.\u0275fac,providedIn:"root"})}return v})()},49996:(L,B,o)=>{o.d(B,{$:()=>K});var O=o(10467),t=o(93953),F=o(81317),A=o(50296),I=o(60177),_=o(25596),h=o(88834),D=o(99213),T=o(30046),W=o(98703),v=o(60385),N=o(34635),a=o(58249);function s(n,g){1&n&&t.EFF(0," people ")}function l(n,g){1&n&&t.EFF(0," connect_without_contact ")}function u(n,g){1&n&&t.EFF(0," Friend Request ")}function p(n,g){1&n&&t.EFF(0," Connect Request ")}function m(n,g){1&n&&t.EFF(0," This user wants to be your friend, do you accept? This will give them access to send you sharing requets, such as shared Tasks, collabrative apps and more. ")}function i(n,g){if(1&n&&(t.EFF(0," This is a data sharing request. Do you want to accept? "),t.j41(1,"p"),t.EFF(2," App: "),t.j41(3,"span",2),t.EFF(4),t.k0s(),t.nrm(5,"br"),t.EFF(6),t.k0s()),2&n){const e=t.XpG(2);t.R7$(4),t.JRh(e.entry.data.app),t.R7$(2),t.SpI("Title: ",e.entry.data.title," ")}}function f(n,g){1&n&&t.EFF(0," Shared Credential. This will be automatically processed. ")}function r(n,g){1&n&&t.nrm(0,"br")}function d(n,g){if(1&n&&t.nrm(0,"app-profile-header",4),2&n){const e=t.XpG(2);t.Y8G("did",e.entry.record.recipient)}}function C(n,g){if(1&n&&t.nrm(0,"app-profile-header",4),2&n){const e=t.XpG(2);t.Y8G("did",e.entry.record.author)}}function y(n,g){}function M(n,g){if(1&n){const e=t.RV6();t.j41(0,"button",5),t.EFF(1,"PENDING"),t.k0s(),t.EFF(2,"\xa0 "),t.j41(3,"button",6),t.bIt("click",function(){t.eBV(e);const c=t.XpG(3);return t.Njj(c.reject(c.entry))}),t.EFF(4,"CANCEL"),t.k0s()}if(2&n){const e=t.XpG(3);t.Y8G("disabled",!0),t.R7$(3),t.Y8G("disabled",e.entry.loading)}}function P(n,g){if(1&n){const e=t.RV6();t.j41(0,"button",7),t.bIt("click",function(){t.eBV(e);const c=t.XpG(3);return t.Njj(c.accept(c.entry))}),t.EFF(1,"ACCEPT"),t.k0s(),t.EFF(2,"\xa0 "),t.j41(3,"button",6),t.bIt("click",function(){t.eBV(e);const c=t.XpG(3);return t.Njj(c.reject(c.entry))}),t.EFF(4,"DELETE"),t.k0s(),t.EFF(5,"\xa0 "),t.j41(6,"button",6),t.bIt("click",function(){t.eBV(e);const c=t.XpG(3);return t.Njj(c.block(c.entry))}),t.EFF(7,"BLOCK"),t.k0s()}if(2&n){const e=t.XpG(3);t.Y8G("disabled",e.entry.loading),t.R7$(3),t.Y8G("disabled",e.entry.loading),t.R7$(3),t.Y8G("disabled",e.entry.loading)}}function x(n,g){if(1&n&&(t.j41(0,"mat-card-actions"),t.DNE(1,M,5,2)(2,P,8,3),t.k0s()),2&n){const e=t.XpG(2);t.R7$(),t.vxM("out"==e.entry.direction?1:2)}}function b(n,g){if(1&n&&(t.j41(0,"mat-card",0)(1,"mat-card-header")(2,"mat-icon",1),t.DNE(3,s,1,0)(4,l,1,0),t.k0s(),t.j41(5,"mat-card-title"),t.DNE(6,u,1,0)(7,p,1,0),t.k0s(),t.j41(8,"mat-card-subtitle"),t.EFF(9,"Type: "),t.j41(10,"span",2),t.EFF(11),t.k0s(),t.EFF(12),t.nI1(13,"ago"),t.k0s()(),t.j41(14,"mat-card-content")(15,"div",3),t.DNE(16,m,1,0)(17,i,7,2,"p")(18,f,1,0)(19,r,1,0,"br"),t.k0s(),t.DNE(20,d,1,1,"app-profile-header",4)(21,C,1,1,"app-profile-header",4),t.k0s(),t.DNE(22,y,0,0)(23,x,3,1,"mat-card-actions"),t.k0s()),2&n){const e=t.XpG();t.R7$(3),t.vxM("friend"==e.entry.record.tags.type?3:4),t.R7$(3),t.vxM("friend"==e.entry.record.tags.type?6:7),t.R7$(5),t.JRh(e.entry.record.tags.type),t.R7$(),t.SpI(" (",t.bMT(13,7,e.entry.record.dateCreated),")"),t.R7$(4),t.vxM("friend"==e.entry.record.tags.type?16:"data"==e.entry.record.tags.type?17:"credential"==e.entry.record.tags.type?18:19),t.R7$(4),t.vxM("out"==e.entry.direction?20:21),t.R7$(2),t.vxM("credential"==e.entry.record.tags.type?22:23)}}let K=(()=>{class n{constructor(){this.entry=void 0,this.connection=(0,t.WQX)(F.K),this.friend=(0,t.WQX)(a.K),this.identity=(0,t.WQX)(N.K),this.app=(0,t.WQX)(A.d)}deleteConnection(e){e.loading=!0,this.connection.deleteConnection(e)}accept(e){var E=this;return(0,O.A)(function*(){e.loading=!0,console.log("Accepting connection request",e),e.data.did=e.record.author,console.log("CONNECTION TAGS:",JSON.stringify(e.record.tags)),console.log("CONNECTION DATA:",JSON.stringify(e.data));const c=e.record.tags.type;if(c==F.X.Friend){const R=yield E.friend.accept(e);e.data.vc=R?.data.vc,e.data.recordId=R?.id}if(yield E.connection.create(e,c),yield E.connection.deleteRequest(e),console.log("CONNECTION TYPE:",c),c==F.X.Data&&(console.log("ACCEPTING DATA CONNECTION:",e),"tasks"==e.data.app)){console.log("ACEPTING TASKS CONNECTION:",e);const{record:R}=yield E.identity.web5.dwn.records.read({from:e.data.did,message:{filter:{recordId:e.data.recordId}}});let j={};console.log("RECORD FROM CONNECTION ACCEPT:",R),R&&(j={...yield R.data.json(),id:R.dataCid,did:R.author,created:R.dateCreated},console.log("RECORD JSON:",j))}})()}block(e){var E=this;return(0,O.A)(function*(){e.loading=!0,console.log("Blocking user",e);const c=yield E.connection.block(e.record.author);console.log("Block result: ",c)})()}reject(e){e.loading=!0,this.connection.deleteRequest(e)}static#t=this.\u0275fac=function(E){return new(E||n)};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["app-request"]],inputs:{entry:"entry"},standalone:!0,features:[t.aNF],decls:1,vars:1,consts:[["appearance","outlined",1,"card-notification"],["inline","true","mat-card-avatar","",1,"card-icon"],[1,"capitalize"],[1,"notification-description"],[3,"did"],["mat-flat-button","",3,"disabled"],["mat-button","",3,"click","disabled"],["mat-flat-button","",3,"click","disabled"]],template:function(E,c){1&E&&t.DNE(0,b,24,9,"mat-card",0),2&E&&t.vxM(c.entry?0:-1)},dependencies:[v.w,W.g,I.MD,_.Hu,_.RN,_.YY,_.QG,_.m2,_.MM,_.Lc,_.dh,h.Hl,h.$z,D.m_,D.An,T.iI],styles:[".card-icon[_ngcontent-%COMP%]{font-size:3em}.card-notification[_ngcontent-%COMP%]{margin-bottom:1em}.notifications-title[_ngcontent-%COMP%]{display:flex;width:100%}.notifications-card[_ngcontent-%COMP%]{max-width:600px;width:100%}.card-notification[_ngcontent-%COMP%]   mat-card-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}.notification-description[_ngcontent-%COMP%]{margin-bottom:1em}"]})}return n})()},60385:(L,B,o)=>{o.d(B,{w:()=>m});var O=o(10467),t=o(93953),F=o(34635),A=o(25596),I=o(39434),_=o(345),h=o(78013),D=o(33347),T=o(14823),W=o(30046);const v=i=>["/profile",i];function N(i,f){if(1&i&&(t.nrm(0,"img",0),t.nI1(1,"safeResourceUrl")),2&i){let r;const d=t.XpG();t.Y8G("routerLink",t.eq3(4,v,null==(r=d.data().profile)?null:r.did))("src",t.bMT(1,2,d.data().avatar),t.B4B)}}function a(i,f){if(1&i&&t.nrm(0,"img",1),2&i){let r;const d=t.XpG();t.Y8G("routerLink",t.eq3(2,v,null==(r=d.data().profile)?null:r.did))("src","/avatar-placeholder.png",t.B4B)}}function s(i,f){if(1&i&&t.EFF(0),2&i){let r;const d=t.XpG(2);t.SpI(" (",null==(r=d.data().profile)?null:r.title,") ")}}function l(i,f){if(1&i&&(t.j41(0,"a",3),t.EFF(1),t.DNE(2,s,1,1),t.k0s()),2&i){let r,d,C;const y=t.XpG();t.Y8G("routerLink",t.eq3(3,v,null==(r=y.data().profile)?null:r.did)),t.R7$(),t.SpI("",null==(d=y.data().profile)?null:d.name," "),t.R7$(),t.vxM(null!=(C=y.data().profile)&&C.title?2:-1)}}function u(i,f){if(1&i&&t.EFF(0),2&i){let r;const d=t.XpG(2);t.SpI(" (",null==(r=d.data().profile)?null:r.title,") ")}}function p(i,f){if(1&i&&(t.j41(0,"em")(1,"a",3),t.EFF(2,"No name set "),t.DNE(3,u,1,1),t.k0s()()),2&i){let r,d;const C=t.XpG();t.R7$(),t.Y8G("routerLink",t.eq3(2,v,null==(r=C.data().profile)?null:r.did)),t.R7$(2),t.vxM(null!=(d=C.data().profile)&&d.title?3:-1)}}let m=(()=>{class i{constructor(){this.identity=(0,t.WQX)(F.K),this.profile=(0,t.WQX)(I.p),this.sanitizer=(0,t.WQX)(_.up),this.did=t.hFB.required(),this.data=(0,t.vPA)({})}ngAfterViewInit(){var r=this;return(0,O.A)(function*(){if(r.did()){const d=yield r.profile.loadProfile(r.did());console.log(d),r.data.set(d)}})()}static#t=this.\u0275fac=function(d){return new(d||i)};static#e=this.\u0275cmp=t.VBU({type:i,selectors:[["app-profile-header"]],inputs:{did:[1,"did"]},standalone:!0,features:[t.aNF],decls:10,vars:9,consts:[["mat-card-avatar","","onerror","this.src='/avatar-placeholder.png';this.onerror='';",1,"profile-thumbnail",3,"routerLink","src"],["mat-card-avatar","",1,"profile-thumbnail",3,"routerLink","src"],[1,"profile-header-title"],[3,"routerLink"],[1,"profile-header-subtitle"],[3,"routerLink","matTooltip"]],template:function(d,C){if(1&d&&(t.DNE(0,N,2,6,"img",0)(1,a,1,4,"img",1),t.j41(2,"div")(3,"div",2),t.DNE(4,l,3,5,"a",3)(5,p,4,4,"em"),t.k0s(),t.j41(6,"div",4)(7,"a",5),t.EFF(8),t.nI1(9,"did"),t.k0s()()()),2&d){let y,M,P,x;t.vxM(C.data().avatar?0:1),t.R7$(4),t.vxM(null!=(y=C.data().profile)&&y.name?4:5),t.R7$(3),t.Y8G("routerLink",t.eq3(7,v,null==(M=C.data().profile)?null:M.did))("matTooltip",null==(P=C.data().profile)?null:P.did),t.R7$(),t.JRh(t.bMT(9,5,null==(x=C.data().profile)?null:x.did))}},dependencies:[W.iI,W.Wk,T.uc,T.oV,A.Hu,A.QG,h.d,D.k],styles:[".profile-thumbnail[_ngcontent-%COMP%]{cursor:pointer;border-radius:50%;margin-right:1em}a[_ngcontent-%COMP%]{text-decoration:none}a[_ngcontent-%COMP%]:hover{text-decoration:underline}[_nghost-%COMP%]{display:flex}.profile-header-title[_ngcontent-%COMP%]{font-size:1.4em}.profile-header-subtitle[_ngcontent-%COMP%]{font-size:1em}"]})}return i})()}}]);