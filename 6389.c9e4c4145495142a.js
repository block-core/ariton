"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6389],{86389:(it,b,o)=>{o.r(b),o.d(b,{ChatComponent:()=>et});var c=o(10467),t=o(93953),u=o(89417),j=o(88834),G=o(65571),M=o(53719),k=o(99213),E=o(99631),I=o(79703),Q=o(3902),P=o(60177),C=o(59115),O=o(55911),R=o(14823),D=o(99327),F=o(30046),y=o(36899),S=o(54087),m=o(48116),x=o(21698),w=o(345);let X=(()=>{class i{constructor(e){this.el=e,this.did2=!1,this.appProfileImage=t.hFB.required(),this.identity=(0,t.WQX)(y.K),this.profile=(0,t.WQX)(x.p),this.sanitizer=(0,t.WQX)(w.up)}ngAfterViewInit(){var e=this;return(0,c.A)(function*(){if(e.appProfileImage()){const n=(yield e.profile.loadProfile(e.appProfileImage())).avatar;n?(e.el.nativeElement.src=n,e.el.nativeElement.onerror="this.src='/avatar-placeholder.png';this.onerror='';"):e.el.nativeElement.src="/avatar-placeholder.png"}})()}static#t=this.\u0275fac=function(a){return new(a||i)(t.rXU(t.aKT))};static#e=this.\u0275dir=t.FsC({type:i,selectors:[["","appProfileImage",""]],inputs:{did2:"did2",appProfileImage:[1,"appProfileImage"]},standalone:!0})}return i})(),N=(()=>{class i{constructor(e){this.el=e,this.did2=!1,this.appProfileName=t.hFB.required(),this.identity=(0,t.WQX)(y.K),this.profile=(0,t.WQX)(x.p),this.sanitizer=(0,t.WQX)(w.up)}ngAfterViewInit(){var e=this;return(0,c.A)(function*(){if(e.appProfileName()){const a=yield e.profile.loadProfile(e.appProfileName());let n=e.appProfileName();a&&a.profile&&a.profile.name&&(n=a.profile.name),e.el.nativeElement.innerText=n}})()}static#t=this.\u0275fac=function(a){return new(a||i)(t.rXU(t.aKT))};static#e=this.\u0275dir=t.FsC({type:i,selectors:[["","appProfileName",""]],inputs:{did2:"did2",appProfileName:[1,"appProfileName"]},standalone:!0})}return i})();var Y=o(42745),T=o(9183),$=o(63104),A=o(76336),B=o(71997);const _=i=>["/app","chat",i],z=i=>["/profile",i],J=i=>({"message-inbound":i}),V=i=>({"panel-background":i});function W(i,f){if(1&i&&(t.j41(0,"a",7)(1,"div"),t.nrm(2,"img",23),t.k0s(),t.j41(3,"div",24)(4,"div",25),t.nrm(5,"div",26),t.j41(6,"div",27),t.EFF(7),t.nI1(8,"date"),t.k0s()(),t.j41(9,"div",28),t.EFF(10),t.k0s()()()),2&i){const e=f.$implicit;t.Y8G("routerLink",t.eq3(8,_,e.did)),t.R7$(2),t.Y8G("appProfileImage",e.did),t.R7$(3),t.Y8G("appProfileName",e.did),t.R7$(2),t.JRh(t.i5U(8,5,e.timestamp,"HH:mm")),t.R7$(3),t.JRh(e.text)}}function U(i,f){if(1&i&&(t.j41(0,"div",9),t.EFF(1),t.k0s()),2&i){const e=t.XpG();t.Y8G("matTooltip",e.selectedProfile().profile.did),t.R7$(),t.JRh(e.selectedProfile().profile.name)}}function L(i,f){if(1&i&&(t.j41(0,"div",9),t.EFF(1),t.k0s()),2&i){const e=t.XpG();t.Y8G("matTooltip",e.selectedProfile().profile.did),t.R7$(),t.JRh(e.selectedProfile().profile.did)}}function H(i,f){if(1&i&&(t.j41(0,"button",12)(1,"mat-icon"),t.EFF(2,"account_circle"),t.k0s(),t.j41(3,"span"),t.EFF(4,"View profile"),t.k0s()()),2&i){const e=t.XpG();t.Y8G("routerLink",t.eq3(1,z,e.selectedProfile().profile.did))}}function K(i,f){if(1&i&&(t.j41(0,"div",16),t.EFF(1),t.k0s()),2&i){const e=f.$implicit;t.Y8G("matTooltip",e.data.timestamp)("ngClass",t.eq3(3,J,"out"==e.direction)),t.R7$(),t.SpI(" ",e.data.text," ")}}function Z(i,f){1&i&&t.nrm(0,"mat-spinner")}function q(i,f){if(1&i&&(t.j41(0,"div")(1,"strong"),t.EFF(2),t.k0s()(),t.j41(3,"div"),t.EFF(4),t.k0s(),t.nrm(5,"br")(6,"mat-divider")(7,"br"),t.j41(8,"div"),t.EFF(9),t.k0s(),t.j41(10,"div",30),t.EFF(11,"Title"),t.k0s(),t.j41(12,"div"),t.EFF(13),t.k0s(),t.j41(14,"div",30),t.EFF(15,"Bio"),t.k0s(),t.j41(16,"div"),t.EFF(17),t.k0s(),t.j41(18,"div",30),t.EFF(19,"Location"),t.k0s(),t.j41(20,"div",31),t.EFF(21),t.k0s(),t.j41(22,"div",30),t.EFF(23,"Identifier"),t.k0s()),2&i){const e=t.XpG(2);t.R7$(2),t.JRh(e.selectedProfile().profile.name),t.R7$(2),t.JRh(e.selectedProfile().profile.status),t.R7$(5),t.JRh(e.selectedProfile().profile.title),t.R7$(4),t.JRh(e.selectedProfile().profile.bio),t.R7$(4),t.JRh(e.selectedProfile().profile.location),t.R7$(3),t.Y8G("matTooltip",e.selectedProfile().profile.did),t.R7$(),t.JRh(e.selectedProfile().profile.did)}}function tt(i,f){if(1&i){const e=t.RV6();t.j41(0,"div",22)(1,"mat-toolbar")(2,"span"),t.EFF(3,"User Info"),t.k0s(),t.nrm(4,"span",4),t.j41(5,"button",11),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.closeDetails())}),t.j41(6,"mat-icon"),t.EFF(7,"close"),t.k0s()()(),t.j41(8,"div",29),t.DNE(9,q,24,7),t.k0s()()}if(2&i){const e=t.XpG();t.Y8G("ngClass",t.eq3(2,V,e.detailsBig())),t.R7$(9),t.vxM(e.selectedProfile()?9:-1)}}let et=(()=>{class i{constructor(){var e=this;this.viewStyle=(0,t.geq)("card"),this.layout=(0,t.WQX)(I.Y),this.details=(0,t.vPA)(!0),this.detailsBig=(0,t.vPA)(!1),this.identity=(0,t.WQX)(y.K),this.app=(0,t.WQX)(S.d),this.breakpointObserver=(0,t.WQX)(D.QP),this.fullsize=!1,this.route=(0,t.WQX)(F.nX),this.profile=(0,t.WQX)(x.p),this.selectedChat=(0,t.vPA)(null),this.selectedProfile=(0,t.vPA)(null),this.loading=(0,t.vPA)(!1),this.messages=(0,t.vPA)([]),this.message="",this.chats=(0,t.vPA)([]),this.threads=(0,t.vPA)([]),this.route.paramMap.subscribe(n=>{this.layout.disableScrolling(),this.selectedChat.set(n.get("id"))}),(0,t.QZP)((0,c.A)(function*(){e.app.initialized()&&(yield e.load())})),(0,t.QZP)((0,c.A)(function*(){if(e.selectedChat()&&e.app.initialized()){if(e.selectedProfile.set(null),e.messages.set([]),":id"===e.selectedChat()||"home"===e.selectedChat())return;e.loading.set(!0);const n=yield e.profile.loadProfile(e.selectedChat());e.selectedProfile.set(n),yield e.loadMessages(e.selectedChat()),e.loading.set(!1)}}),{allowSignalWrites:!0}),this.breakpointObserver.observe(["(max-width: 1024px)"]).subscribe(n=>{console.log("MATCHES:",n.matches),n.matches?(this.details.set(!1),this.detailsBig.set(!0)):this.detailsBig.set(!1)})}ngOnInit(){var e=this;return(0,c.A)(function*(){e.layout.disableScrolling(),e.layout.resetActions(),e.layout.marginOff()})()}ngOnDestroy(){this.layout.enableScrolling()}loadMessages(e){var a=this;return(0,c.A)(function*(){a.messages.set([]);const n={recipients:e};var{records:s}=yield a.identity.web5.dwn.records.query({message:{filter:{tags:n,protocol:m.Q.protocol,schema:m.Q.types.message.schema,dataFormat:m.Q.types.message.dataFormats[0]},dateSort:Y.U0.CreatedAscending}});if(s)for(const r of s){let d=yield r.data.json(),p={record:r,data:d};r.creator==a.identity.did&&(p.direction="out"),a.messages.update(l=>[...l,p])}})()}load(){var e=this;return(0,c.A)(function*(){var{records:a}=yield e.identity.web5.dwn.records.query({message:{filter:{protocol:m.Q.protocol,schema:m.Q.types.message.schema,dataFormat:m.Q.types.message.dataFormats[0]}}});if(e.chats.set([]),e.threads.set([]),a)for(const l of a){let h=yield l.data.json(),v={record:l,data:h};l.creator==e.identity.did&&(v.direction="out"),e.chats.update(g=>[...g,v])}const n=e.chats().map(l=>l.data.recipient),s=e.chats().map(l=>l.data.sender),r=yield e.loadFriends(),d=Array.from(new Set([...n,...s,...r])),p=e.chats().sort((l,h)=>l.data.timestamp>h.data.timestamp?-1:1);d.map(function(){var l=(0,c.A)(function*(h){const v=p.find(g=>g.data.recipient==h||g.data.sender==h);h!=e.identity.did&&e.threads.update(g=>[...g,{did:h,text:v?.data.text,timestamp:v?.data.timestamp}])});return function(h){return l.apply(this,arguments)}}())})()}loadFriends(){var e=this;return(0,c.A)(function*(){var{records:a}=yield e.identity.web5.dwn.records.query({message:{filter:{schema:$.eE.friendship,dataFormat:$.eE.format}}});let n=[];if(a)for(const s of a){let r=yield s.data.text(),d=A.l6.parseJwt({vcJwt:r}),p=d.issuer;d.issuer==e.identity.did&&(p=A.l6.parseJwt({vcJwt:d.vcDataModel.credentialSubject.vc}).issuer),n.push(p)}return n})()}toggleDetails(){this.details.set(!this.details())}closeDetails(){this.details.set(!1)}submitMessage(){var e=this;return(0,c.A)(function*(){if(e.message.trim()){let a=e.selectedProfile().did;const s={text:e.message,sender:e.identity.did,recipient:a,timestamp:(new Date).toISOString()},r={recipients:[e.identity.did,a]},{record:d}=yield e.identity.web5.dwn.records.write({data:s,message:{tags:r,protocol:m.Q.protocol,protocolPath:"message",schema:m.Q.types.message.schema,recipient:a}});d?.send(a);let p={record:d,data:s,direction:"out"};e.messages.update(l=>[...l,p]),e.message=""}})()}deleteChat(){var e=this;return(0,c.A)(function*(){for(let a of e.messages())yield a.record.delete();e.messages.set([])})()}newChat(){var e=this;return(0,c.A)(function*(){let a=e.selectedProfile().did;const s={text:"Hello, how are you?",sender:e.identity.did,recipient:a,timestamp:(new Date).toISOString()},r={recipients:[e.identity.did,a]},{record:d}=yield e.identity.web5.dwn.records.write({data:s,message:{tags:r,protocol:m.Q.protocol,protocolPath:"message",schema:m.Q.types.message.schema,recipient:a}});let p={record:d,data:s};return e.messages.update(l=>[...l,p]),d})()}static#t=this.\u0275fac=function(a){return new(a||i)};static#e=this.\u0275cmp=t.VBU({type:i,selectors:[["app-chat"]],inputs:{viewStyle:[1,"viewStyle"],fullsize:"fullsize"},outputs:{viewStyle:"viewStyleChange"},standalone:!0,features:[t.aNF],decls:84,vars:15,consts:[["chatMenu","matMenu"],["menu","matMenu"],[1,"chat-container"],[1,"left-panel"],[1,"toolbar-spacer"],["type","search","placeholder","Filter chats",1,"search-input"],[1,"panel-content","panel-content-chats"],["routerLinkActive","router-link-active",1,"chat-link",3,"routerLink"],[1,"middle-panel"],[1,"name-ellipsis",3,"matTooltip"],["mat-icon-button","",3,"matMenuTriggerFor"],["mat-icon-button","",3,"click"],["mat-menu-item","",3,"routerLink"],["mat-menu-item","",3,"disabled"],["mat-menu-item","",3,"click"],[1,"panel-content","panel-content-messages"],[1,"message",3,"matTooltip","ngClass"],[1,"chat-input"],["mat-icon-button","",1,"chat-action",3,"matMenuTriggerFor"],["subscriptSizing","dynamic",1,"chat-message-input"],["matInput","","placeholder","Message...",3,"ngModelChange","keydown.enter","ngModel"],["mat-icon-button","",1,"chat-action",3,"click"],[1,"right-panel",3,"ngClass"],[1,"chat-icon",3,"appProfileImage"],[1,"chat-details"],[1,"chat-info"],[1,"chat-info-name",3,"appProfileName"],[1,"chat-time"],[1,"chat-text"],[1,"panel-content","profile-details"],[1,"dimmed","profile-info-label"],[1,"ellipsis",3,"matTooltip"]],template:function(a,n){if(1&a){const s=t.RV6();t.j41(0,"div",2)(1,"div",3)(2,"mat-toolbar")(3,"span",4),t.nrm(4,"input",5),t.k0s()(),t.j41(5,"div",6),t.Z7z(6,W,11,10,"a",7,t.fX1),t.k0s()(),t.j41(8,"div",8)(9,"mat-toolbar"),t.DNE(10,U,2,2,"div",9)(11,L,2,2,"div",9),t.nrm(12,"span",4),t.j41(13,"button",10)(14,"mat-icon"),t.EFF(15,"more_vert"),t.k0s()(),t.j41(16,"button",11),t.bIt("click",function(){return t.eBV(s),t.Njj(n.toggleDetails())}),t.j41(17,"mat-icon"),t.EFF(18,"view_sidebar"),t.k0s()()(),t.j41(19,"mat-menu",null,0),t.DNE(21,H,5,3,"button",12),t.j41(22,"button",13)(23,"mat-icon"),t.EFF(24,"done"),t.k0s(),t.j41(25,"span"),t.EFF(26,"Mark as unread"),t.k0s()(),t.nrm(27,"mat-divider"),t.j41(28,"button",13)(29,"mat-icon"),t.EFF(30,"block"),t.k0s(),t.j41(31,"span"),t.EFF(32,"Block"),t.k0s()(),t.j41(33,"button",13)(34,"mat-icon"),t.EFF(35,"archive"),t.k0s(),t.j41(36,"span"),t.EFF(37,"Archive chat"),t.k0s()(),t.j41(38,"button",14),t.bIt("click",function(){return t.eBV(s),t.Njj(n.deleteChat())}),t.j41(39,"mat-icon"),t.EFF(40,"delete"),t.k0s(),t.j41(41,"span"),t.EFF(42,"Delete chat"),t.k0s()()(),t.j41(43,"div",15),t.Z7z(44,K,2,5,"div",16,t.fX1),t.DNE(46,Z,1,0,"mat-spinner"),t.k0s(),t.j41(47,"div",17)(48,"button",18)(49,"mat-icon"),t.EFF(50,"add_circle"),t.k0s()(),t.j41(51,"mat-menu",null,1)(53,"button",13)(54,"mat-icon"),t.EFF(55,"attach_money"),t.k0s(),t.j41(56,"span"),t.EFF(57,"Send money"),t.k0s()(),t.j41(58,"button",13)(59,"mat-icon"),t.EFF(60,"video_camera_back"),t.k0s(),t.j41(61,"span"),t.EFF(62,"Capture video"),t.k0s()(),t.j41(63,"button",13)(64,"mat-icon"),t.EFF(65,"photo_camera_front"),t.k0s(),t.j41(66,"span"),t.EFF(67,"Capture photo"),t.k0s()(),t.j41(68,"button",13)(69,"mat-icon"),t.EFF(70,"attachment"),t.k0s(),t.j41(71,"span"),t.EFF(72,"Attach a file"),t.k0s()(),t.j41(73,"button",13)(74,"mat-icon"),t.EFF(75,"add_a_photo"),t.k0s(),t.j41(76,"span"),t.EFF(77,"Attach a photo"),t.k0s()()(),t.j41(78,"mat-form-field",19)(79,"input",20),t.mxI("ngModelChange",function(d){return t.eBV(s),t.DH7(n.message,d)||(n.message=d),t.Njj(d)}),t.bIt("keydown.enter",function(){return t.eBV(s),t.Njj(n.submitMessage())}),t.k0s()(),t.j41(80,"button",21),t.bIt("click",function(){return t.eBV(s),t.Njj(n.submitMessage())}),t.j41(81,"mat-icon"),t.EFF(82,"send"),t.k0s()()()(),t.DNE(83,tt,10,4,"div",22),t.k0s()}if(2&a){const s=t.sdS(20),r=t.sdS(52);t.R7$(6),t.Dyx(n.threads()),t.R7$(4),t.vxM(n.selectedProfile()&&n.selectedProfile().profile.name?10:n.selectedProfile()?11:-1),t.R7$(3),t.Y8G("matMenuTriggerFor",s),t.R7$(8),t.vxM(n.selectedProfile()?21:-1),t.R7$(),t.Y8G("disabled",!0),t.R7$(6),t.Y8G("disabled",!0),t.R7$(5),t.Y8G("disabled",!0),t.R7$(11),t.Dyx(n.messages()),t.R7$(2),t.vxM(n.loading()?46:-1),t.R7$(2),t.Y8G("matMenuTriggerFor",r),t.R7$(5),t.Y8G("disabled",!0),t.R7$(5),t.Y8G("disabled",!0),t.R7$(5),t.Y8G("disabled",!0),t.R7$(5),t.Y8G("disabled",!0),t.R7$(5),t.Y8G("disabled",!0),t.R7$(6),t.R50("ngModel",n.message),t.R7$(4),t.vxM(n.details()?83:-1)}},dependencies:[F.iI,F.Wk,F.wQ,P.MD,P.YU,P.vh,R.uc,R.oV,O.s5,O.KQ,u.YN,u.me,u.BC,u.vS,j.Hl,j.iY,k.m_,k.An,E.fS,E.fg,M.rl,Q.Fg,B.q,C.Cn,C.kk,C.fb,C.Cp,G.Vg,M.RG,u.X1,X,N,T.D6,T.LG],styles:[".chat-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;height:calc(100vh - 80px)}.left-panel[_ngcontent-%COMP%], .right-panel[_ngcontent-%COMP%], .chat-content[_ngcontent-%COMP%]{box-sizing:border-box}.panel-content[_ngcontent-%COMP%]{box-sizing:border-box;padding:1em;overflow-x:hidden;overflow-y:auto;height:calc(100% - 64px)}.panel-content-messages[_ngcontent-%COMP%]{height:calc(100% - 128px);display:flex;flex-direction:column}.panel-content-chats[_ngcontent-%COMP%]{height:calc(100% - 128px);padding:0}.chat-action[_ngcontent-%COMP%]{vertical-align:middle!important}.left-panel[_ngcontent-%COMP%]{flex:1;max-width:240px}.middle-panel[_ngcontent-%COMP%]{flex:2}.right-panel[_ngcontent-%COMP%]{flex:none;width:200px}.chat-icon[_ngcontent-%COMP%]{border-radius:50%;max-height:48px;border:2px solid transparent}.chat-link[_ngcontent-%COMP%]{display:flex;align-items:stretch;text-decoration:none;align-items:center;cursor:pointer}.chat-item[_ngcontent-%COMP%]{text-align:right}.chat-details[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:first-child{padding-top:6px;height:24px}.chat-details[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:nth-child(2){height:24px}.chat-info-name[_ngcontent-%COMP%]{flex:1 1 auto}.chat-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%;overflow:hidden;padding-left:.2em}.chat-info[_ngcontent-%COMP%]{display:flex}.chat-text2[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.chat-text[_ngcontent-%COMP%], .chat-info-name[_ngcontent-%COMP%]{display:block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;max-width:100%}.chat-text[_ngcontent-%COMP%]{font-size:.8em}.chat-time[_ngcontent-%COMP%]{padding-right:.2em}.router-link-active[_ngcontent-%COMP%]{background-color:var(--mat-option-selected-state-layer-color)}@media (max-width: 1024px){.right-panel[_ngcontent-%COMP%]{width:100%;position:absolute;inset:0;flex:none;z-index:1000}}@media (max-width: 768px){.left-panel[_ngcontent-%COMP%]{flex:none;width:64px}.left-panel[_ngcontent-%COMP%]   .panel-content[_ngcontent-%COMP%]{padding:0}.chat-details[_ngcontent-%COMP%]{display:none}}.chat-input[_ngcontent-%COMP%]{height:64px;max-height:64px;min-height:64px;display:flex;align-items:center}.chat-message-input[_ngcontent-%COMP%]{flex-grow:2}.profile-details[_ngcontent-%COMP%]{font-size:.9em}.profile-info-label[_ngcontent-%COMP%]{margin-bottom:1em}.message[_ngcontent-%COMP%]{align-self:flex-start;background-color:color-mix(in srgb,var(--mat-option-selected-state-layer-color),transparent 40%);border-radius:1em 1em 1em 0;padding:.4em 1em;margin-bottom:1em}.message-inbound[_ngcontent-%COMP%]{align-self:flex-end;border-radius:1em 1em 0;background-color:color-mix(in srgb,var(--mat-full-pseudo-checkbox-selected-icon-color),transparent 90%)}@media (max-width: 400px){.name-ellipsis[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block;width:60px}}"]})}return i})()}}]);