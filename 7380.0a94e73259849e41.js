"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7380],{37380:(I,E,n)=>{n.r(E),n.d(E,{ProfileEditComponent:()=>T});var _=n(10467),t=n(54438),s=n(89417),f=n(88834),m=n(25596),v=n(99213),h=n(99631),g=n(5951),P=n(82798),C=n(37064),M=n(30046),b=n(39434),F=n(55619),k=n(83475),u=n(4053),O=n(36815),d=n(53719);function y(i,c){1&i&&(t.j41(0,"mat-error"),t.EFF(1,"Status is "),t.j41(2,"strong"),t.EFF(3,"required"),t.k0s()())}function D(i,c){1&i&&(t.j41(0,"mat-error"),t.EFF(1,"Bio is "),t.j41(2,"strong"),t.EFF(3,"required"),t.k0s()())}function R(i,c){1&i&&(t.j41(0,"mat-error"),t.EFF(1,"Location is "),t.j41(2,"strong"),t.EFF(3,"required"),t.k0s()())}function j(i,c){if(1&i){const o=t.RV6();t.j41(0,"div",15)(1,"mat-form-field",6),t.nrm(2,"input",19),t.k0s(),t.j41(3,"button",20),t.bIt("click",function(){const r=t.eBV(o).$index,a=t.XpG();return t.Njj(a.removeLink(r))}),t.j41(4,"mat-icon"),t.EFF(5,"clear"),t.k0s()()()}if(2&i){const o=c.$index;t.R7$(2),t.Y8G("formControlName",o)}}let T=(()=>{class i{get links(){return this.form.get("links")}constructor(){var o=this;this.fb=(0,t.WQX)(s.ok),this.identity=(0,t.WQX)(C.K),this.profileService=(0,t.WQX)(b.p),this.router=(0,t.WQX)(M.Ix),this.data=(0,t.vPA)({}),this.layout=(0,t.WQX)(O.Y),this.loading=!1,this.form=this.fb.group({name:[null],title:[null],status:[null],bio:[null],location:[null],avatar:[""],links:this.fb.array([])}),this.navigation=(0,t.WQX)(F.o),this.layout.marginOn(),(0,t.QZP)((0,_.A)(function*(){if(o.identity.initialized()){const e=yield o.profileService.loadProfile(o.identity.did);o.data.set(e),o.updateForm(e.profile),o.form.patchValue({avatar:e.avatar})}}))}back(){this.navigation.back()}updateForm(o){console.log("Patching form with:",o),this.form.patchValue({name:o.name,title:o.title,bio:o.bio,status:o.status,location:o.location}),o.links&&o.links.length>0?o.links.forEach(e=>{this.links.push(this.fb.control(e))}):this.links.push(this.fb.control(""))}addLink(){this.links.push(this.fb.control(""))}upload(o,e){var r=this;return(0,_.A)(function*(){if(o){if(console.log(e),e){console.log("UPDATING IMAGE!!!!");const{status:a,updatedRecord:l}=yield e.update({published:!0,data:o});return console.log("Update profile status:",a,l),l}{const{record:a}=yield r.identity.web5.dwn.records.create({data:o,message:{published:!0,protocol:u.Q.protocol,protocolPath:"avatar",dataFormat:"image/jpeg",tags:{module:"profile"}}});return a}}console.log("No image to upload.")})()}ngOnInit(){}removeLink(o){this.links.removeAt(o)}onSubmit(){var o=this;return(0,_.A)(function*(){o.loading=!0;let e=o.form.value.links;e=e.filter(a=>null!=a&&""!==a);const r={name:o.form.value.name,title:o.form.value.title,bio:o.form.value.bio,status:o.form.value.status,location:o.form.value.location,links:e};if(console.log("FORM DATA:",r),o.data().record){const{status:a,record:l}=yield o.data().record.update({published:!0,data:r});console.log("Update profile status:",a,l);const{status:p}=yield o.data().record.send(o.identity.did);console.log("Send profile status:",p)}else{const{status:a,record:l}=yield o.identity.web5.dwn.records.create({data:r,message:{published:!0,protocol:u.Q.protocol,protocolPath:"profile",schema:u.Q.types.profile.schema,dataFormat:u.Q.types.profile.dataFormats[0]}});console.log("Save profile status:",a,l);const{status:p}=yield l.send(o.identity.did);console.log("Send profile status:",p)}if(o.form.controls.avatar.value){const a=yield o.upload(o.form.controls.avatar.value,o.data().avatarRecord);if(a){const{status:l}=yield a.send();console.log("Send avatar status:",l)}}else o.data().avatarRecord&&(yield o.data().avatarRecord.delete(),yield o.data().avatarRecord.send());o.router.navigate(["/profile",o.identity.did])})()}static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275cmp=t.VBU({type:i,selectors:[["app-edit"]],standalone:!0,features:[t.aNF],decls:46,vars:6,consts:[["name",""],["title",""],["bio",""],["novalidate","",3,"ngSubmit","formGroup"],["formControlName","avatar"],[1,"form-card"],[1,"full-width"],["matInput","","placeholder","Name","maxlength","200","formControlName","name"],["matInput","","placeholder","Title","formControlName","title"],["matInput","","placeholder","Status","formControlName","status"],["maxlength","300","matInput","","placeholder","Bio","formControlName","bio"],["align","end"],["matInput","","placeholder","Location","formControlName","location"],["matSuffix",""],["formArrayName","links"],[1,"link-input"],["mat-stroked-button","","type","button",3,"click"],["mat-button","","type","button",3,"click"],["mat-flat-button","","color","primary","type","submit",3,"disabled"],["matInput","","type","text","placeholder","Enter link (URL)",3,"formControlName"],["mat-icon-button","","type","button",3,"click"]],template:function(e,r){if(1&e){const a=t.RV6();t.j41(0,"form",3),t.bIt("ngSubmit",function(){return t.eBV(a),t.Njj(r.onSubmit())}),t.nrm(1,"app-avatar",4),t.j41(2,"mat-card",5)(3,"mat-card-content")(4,"mat-form-field",6)(5,"mat-label"),t.EFF(6,"Name"),t.k0s(),t.nrm(7,"input",7,0),t.k0s(),t.j41(9,"mat-form-field",6)(10,"mat-label"),t.EFF(11,"Title"),t.k0s(),t.nrm(12,"input",8,1),t.k0s(),t.j41(14,"mat-form-field",6)(15,"mat-label"),t.EFF(16,"Status"),t.k0s(),t.nrm(17,"input",9),t.DNE(18,y,4,0,"mat-error"),t.k0s(),t.j41(19,"mat-form-field",6)(20,"mat-label"),t.EFF(21,"Bio"),t.k0s(),t.nrm(22,"textarea",10,2),t.DNE(24,D,4,0,"mat-error"),t.j41(25,"mat-hint",11),t.EFF(26),t.k0s()(),t.j41(27,"mat-form-field",6)(28,"mat-label"),t.EFF(29,"Location"),t.k0s(),t.nrm(30,"input",12),t.DNE(31,R,4,0,"mat-error"),t.j41(32,"mat-icon",13),t.EFF(33,"place"),t.k0s()(),t.j41(34,"div",14),t.Z7z(35,j,6,1,"div",15,t.fX1),t.k0s(),t.j41(37,"button",16),t.bIt("click",function(){return t.eBV(a),t.Njj(r.addLink())}),t.j41(38,"mat-icon"),t.EFF(39,"add_link"),t.k0s(),t.EFF(40," Add Link"),t.k0s()(),t.j41(41,"mat-card-actions",11)(42,"button",17),t.bIt("click",function(){return t.eBV(a),t.Njj(r.back())}),t.EFF(43,"Cancel"),t.k0s(),t.j41(44,"button",18),t.EFF(45,"Save"),t.k0s()()()()}if(2&e){const a=t.sdS(23);t.Y8G("formGroup",r.form),t.R7$(18),t.vxM(r.form.controls.status.hasError("required")?18:-1),t.R7$(6),t.vxM(r.form.controls.bio.hasError("required")?24:-1),t.R7$(2),t.SpI("",a.value.length," / 300"),t.R7$(5),t.vxM(r.form.controls.location.hasError("required")?31:-1),t.R7$(4),t.Dyx(r.links.controls),t.R7$(9),t.Y8G("disabled",r.form.invalid||r.loading)}},dependencies:[k.f,h.fS,h.fg,d.rl,d.nJ,d.MV,d.TL,d.yw,f.Hl,f.$z,f.iY,P.Ve,v.m_,v.An,g.Wk,m.Hu,m.RN,m.YY,m.m2,s.X1,s.qT,s.me,s.BC,s.cb,s.tU,s.j4,s.JD,s.v8],styles:[".full-width[_ngcontent-%COMP%]{width:100%}.form-card[_ngcontent-%COMP%]{margin-top:1em}.link-input[_ngcontent-%COMP%]{display:flex;align-items:baseline}.link-input[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:.4em}mat-card-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:1em}form[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;flex-direction:column}"]})}}return i})()}}]);