(self.webpackChunkapp=self.webpackChunkapp||[]).push([[42],{14042:(le,A,k)=>{"use strict";k.r(A),k.d(A,{NewComponent:()=>Ut});var L=k(10467),N=k(88834),E=k(34604),ye=function(o,n,t,e){return new(t||(t=Promise))(function(i,d){function s(a){try{c(e.next(a))}catch(u){d(u)}}function l(a){try{c(e.throw(a))}catch(u){d(u)}}function c(a){a.done?i(a.value):function r(i){return i instanceof t?i:new t(function(d){d(i)})}(a.value).then(s,l)}c((e=e.apply(o,n||[])).next())})};class fe{constructor(n){this.agent=n.agent,this.connectedDid=n.connectedDid}create(n){return ye(this,void 0,void 0,function*(){const t=yield this.agent.processDidRequest({messageType:E.B2.Create,messageParams:Object.assign({},n)}),{result:e}=t,r=function(o,n){var t={};for(var e in o)Object.prototype.hasOwnProperty.call(o,e)&&n.indexOf(e)<0&&(t[e]=o[e]);if(null!=o&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(e=Object.getOwnPropertySymbols(o);r<e.length;r++)n.indexOf(e[r])<0&&Object.prototype.propertyIsEnumerable.call(o,e[r])&&(t[e[r]]=o[e[r]])}return t}(t,["result"]);return Object.assign({did:e},r)})}resolve(n,t){return ye(this,void 0,void 0,function*(){const{result:e}=yield this.agent.processDidRequest({messageParams:{didUri:n,options:t},messageType:E.B2.Resolve});return e})}}var K=k(37475);function q(o,n){let t;const e=(0,K.fc)(o);if("text/plain"===n||"String"===e)t=new Blob([o],{type:"text/plain"});else if("application/json"===n||"Object"===e){const r=K.U$.object(o).toUint8Array();t=new Blob([r],{type:"application/json"})}else if("Uint8Array"===e||"ArrayBuffer"===e)t=new Blob([o],{type:"application/octet-stream"});else{if("Blob"!==e)throw new Error("data type not supported.");t=o}return{dataBlob:t,dataFormat:n=n||t.type||"application/octet-stream"}}class h{static check(n,t){let e=h.cache.get(n);return!!e&&e.has(t)}static set(n,t){let e=h.cache.get(n)||new Set;if(h.cache.delete(n),h.cache.set(n,e),this.cache.size>h.sendCacheLimit){const r=h.cache.keys().next().value;h.cache.delete(r)}if(e.delete(t),e.add(t),e.size>h.sendCacheLimit){const r=e.keys().next().value;e.delete(r)}}}h.cache=new Map,h.sendCacheLimit=100;var m=function(o,n,t,e){return new(t||(t=Promise))(function(i,d){function s(a){try{c(e.next(a))}catch(u){d(u)}}function l(a){try{c(e.throw(a))}catch(u){d(u)}}function c(a){a.done?i(a.value):function r(i){return i instanceof t?i:new t(function(d){d(i)})}(a.value).then(s,l)}c((e=e.apply(o,n||[])).next())})},I=function(o,n){var t={};for(var e in o)Object.prototype.hasOwnProperty.call(o,e)&&n.indexOf(e)<0&&(t[e]=o[e]);if(null!=o&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(e=Object.getOwnPropertySymbols(o);r<e.length;r++)n.indexOf(e[r])<0&&Object.prototype.propertyIsEnumerable.call(o,e[r])&&(t[e[r]]=o[e[r]])}return t};let Y=(()=>{class o{get attestation(){return this._attestation}get authorization(){return this._authorization}get author(){return this._author}get contextId(){return this._contextId}get dataFormat(){return this._descriptor.dataFormat}get dateCreated(){return this._descriptor.dateCreated}get encryption(){return this._encryption}get initialWrite(){return this._initialWrite}get id(){return this._recordId}get interface(){return this._descriptor.interface}get method(){return this._descriptor.method}get parentId(){return this._descriptor.parentId}get protocol(){return this._descriptor.protocol}get protocolPath(){return this._descriptor.protocolPath}get protocolRole(){return this._protocolRole}get recipient(){return this._descriptor.recipient}get schema(){return this._descriptor.schema}get dataCid(){return this._descriptor.dataCid}get dataSize(){return this._descriptor.dataSize}get dateModified(){return this._descriptor.messageTimestamp}get datePublished(){return this._descriptor.datePublished}get messageTimestamp(){return this._descriptor.messageTimestamp}get published(){return this._descriptor.published}get tags(){return this._descriptor.tags}get rawMessage(){const t=JSON.parse(JSON.stringify({contextId:this._contextId,recordId:this._recordId,descriptor:this._descriptor,attestation:this._attestation,authorization:this._authorization,encryption:this._encryption}));return(0,K.E8)(t),t}constructor(t,e){this._agent=t,this._author=e.author,this._connectedDid=e.connectedDid,this._remoteOrigin=e.remoteOrigin,this._attestation=e.attestation,this._authorization=e.authorization,this._contextId=e.contextId,this._descriptor=e.descriptor,this._encryption=e.encryption,this._initialWrite=e.initialWrite,this._recordId=e.recordId,this._protocolRole=e.protocolRole,e.encodedData&&(this._encodedData="string"==typeof e.encodedData?new Blob([K.U$.base64Url(e.encodedData).toUint8Array()],{type:this.dataFormat}):e.encodedData),e.data&&(this._readableStream=K.Z6.isReadableStream(e.data)?K.VS.fromWebReadable({readableStream:e.data}):e.data)}get data(){const t=this;return{blob(){return m(this,void 0,void 0,function*(){return new Blob([yield K.VS.consumeToBytes({readable:yield this.stream()})],{type:t.dataFormat})})},bytes(){return m(this,void 0,void 0,function*(){return yield K.VS.consumeToBytes({readable:yield this.stream()})})},json(){return m(this,void 0,void 0,function*(){return yield K.VS.consumeToJson({readable:yield this.stream()})})},text(){return m(this,void 0,void 0,function*(){return yield K.VS.consumeToText({readable:yield this.stream()})})},stream(){return m(this,void 0,void 0,function*(){if(t._encodedData?t._readableStream=K.VS.fromWebReadable({readableStream:t._encodedData.stream()}):K.VS.isReadable({readable:t._readableStream})||(t._readableStream=t._remoteOrigin?yield t.readRecordData({target:t._remoteOrigin,isRemote:!0}):yield t.readRecordData({target:t._connectedDid,isRemote:!1})),!t._readableStream)throw new Error("Record data is not available.");return t._readableStream})},then(r,i){return this.stream().then(r,i)},catch(r){return this.stream().catch(r)}}}store(t=!1){return m(this,void 0,void 0,function*(){return this.processRecord({signAsOwner:t,store:!0})})}import(t=!0){return m(this,void 0,void 0,function*(){return this.processRecord({store:t,signAsOwner:!0})})}send(t){return m(this,void 0,void 0,function*(){const e=this._initialWrite;if(t??(t=this._connectedDid),e&&!o._sendCache.check(this._recordId,t)){const i=Object.assign({},e);(0,K.E8)(i),yield this._agent.sendDwnRequest({messageType:E.nx.RecordsWrite,author:this._connectedDid,target:t,rawMessage:i}),o._sendCache.set(this._recordId,t)}const{reply:r}=yield this._agent.sendDwnRequest({messageType:E.nx.RecordsWrite,author:this._connectedDid,dataStream:yield this.data.blob(),target:t,rawMessage:Object.assign({},this.rawMessage)});return r})}toJSON(){return{attestation:this.attestation,author:this.author,authorization:this.authorization,contextId:this.contextId,dataCid:this.dataCid,dataFormat:this.dataFormat,dataSize:this.dataSize,dateCreated:this.dateCreated,messageTimestamp:this.dateModified,datePublished:this.datePublished,encryption:this.encryption,interface:this.interface,method:this.method,parentId:this.parentId,protocol:this.protocol,protocolPath:this.protocolPath,protocolRole:this.protocolRole,published:this.published,recipient:this.recipient,recordId:this.id,schema:this.schema,tags:this.tags}}toString(){let t="Record: {\n";return t+=`  ID: ${this.id}\n`,t+=this.contextId?`  Context ID: ${this.contextId}\n`:"",t+=this.protocol?`  Protocol: ${this.protocol}\n`:"",t+=this.schema?`  Schema: ${this.schema}\n`:"",t+=`  Data CID: ${this.dataCid}\n`,t+=`  Data Format: ${this.dataFormat}\n`,t+=`  Data Size: ${this.dataSize}\n`,t+=`  Created: ${this.dateCreated}\n`,t+=`  Modified: ${this.dateModified}\n`,t+="}",t}paginationCursor(t){return m(this,void 0,void 0,function*(){return(0,E.X7)(this.rawMessage,t)})}update(t){var{dateModified:e,data:r}=t,i=I(t,["dateModified","data"]);return m(this,void 0,void 0,function*(){const d=this._descriptor,{parentId:s}=d,l=I(d,["parentId"]),c=s?this._contextId.split("/").slice(0,-1).join("/"):void 0;let u,a=Object.assign(Object.assign(Object.assign({},l),i),{parentContextId:c,messageTimestamp:e,recordId:this._recordId});((0,K.RI)(a.tags)||null===a.tags)&&delete a.tags,void 0!==r&&(delete a.dataCid,delete a.dataSize,({dataBlob:u}=q(r,a.dataFormat)));const y=new Set(["data","dataCid","dataSize","datePublished","messageTimestamp","published","tags"]);o.verifyPermittedMutation(Object.keys(i),y),!1===i.published&&void 0!==a.datePublished&&delete a.datePublished;const v=yield this._agent.processDwnRequest({author:this._connectedDid,dataStream:u,messageParams:Object.assign({},a),messageType:E.nx.RecordsWrite,target:this._connectedDid}),{message:_,reply:{status:b}}=v,w=_;return 200<=b.code&&b.code<=299&&(this._initialWrite||(this._initialWrite=Object.assign({},this.rawMessage)),this._authorization=w.authorization,this._protocolRole=i.protocolRole,y.forEach(S=>{this._descriptor[S]=w.descriptor[S]}),void 0!==r&&(this._encodedData=u)),{status:b}})}processRecord({store:t,signAsOwner:e}){return m(this,void 0,void 0,function*(){if(this._initialWrite&&(e&&!this._initialWriteSigned||t&&!this._initialWriteStored)){const c={messageType:E.nx.RecordsWrite,rawMessage:this.initialWrite,author:this._connectedDid,target:this._connectedDid,signAsOwner:e,store:t},a=yield this._agent.processDwnRequest(c),{message:u,reply:{status:y}}=a,v=u;200<=y.code&&y.code<=299&&(t&&(this._initialWriteStored=!0),e&&(this._initialWriteSigned=!0,this.initialWrite.authorization=v.authorization))}const r={messageType:E.nx.RecordsWrite,rawMessage:this.rawMessage,author:this._connectedDid,target:this._connectedDid,dataStream:yield this.data.blob(),signAsOwner:e,store:t},i=yield this._agent.processDwnRequest(r),{message:d,reply:{status:s}}=i;return 200<=s.code&&s.code<=299&&e&&(this._authorization=d.authorization),{status:s}})}readRecordData({target:t,isRemote:e}){return m(this,void 0,void 0,function*(){const r={author:this._connectedDid,messageParams:{filter:{recordId:this.id}},messageType:E.nx.RecordsRead,target:t},i=e?this._agent.sendDwnRequest(r):this._agent.processDwnRequest(r);try{const{reply:{record:d}}=yield i,s=d.data;return K.Z6.isReadableStream(s)?K.VS.fromWebReadable({readableStream:s}):s}catch(d){throw new Error(`Error encountered while attempting to read data: ${d.message}`)}})}static verifyPermittedMutation(t,e){for(const r of t)if(!e.has(r))throw new Error(`${r} is an immutable property. Its value cannot be changed.`)}}return o._sendCache=h,o})();class je{constructor(n,t,e){this._agent=n,this._metadata=e,this._protocolsConfigureMessage=t}get definition(){return this._protocolsConfigureMessage.descriptor.definition}toJSON(){return this._protocolsConfigureMessage}send(n){return function(o,n,t,e){return new(t||(t=Promise))(function(i,d){function s(a){try{c(e.next(a))}catch(u){d(u)}}function l(a){try{c(e.throw(a))}catch(u){d(u)}}function c(a){a.done?i(a.value):function r(i){return i instanceof t?i:new t(function(d){d(i)})}(a.value).then(s,l)}c((e=e.apply(o,n||[])).next())})}(this,void 0,void 0,function*(){const{reply:t}=yield this._agent.sendDwnRequest({author:this._metadata.author,messageCid:this._metadata.messageCid,messageType:E.nx.ProtocolsConfigure,target:n});return{status:t.status}})}}var te=function(o,n,t,e){return new(t||(t=Promise))(function(i,d){function s(a){try{c(e.next(a))}catch(u){d(u)}}function l(a){try{c(e.throw(a))}catch(u){d(u)}}function c(a){a.done?i(a.value):function r(i){return i instanceof t?i:new t(function(d){d(i)})}(a.value).then(s,l)}c((e=e.apply(o,n||[])).next())})};class at{constructor(n){this.agent=n.agent,this.connectedDid=n.connectedDid}get protocols(){return{configure:n=>te(this,void 0,void 0,function*(){const t=yield this.agent.processDwnRequest({author:this.connectedDid,messageParams:n.message,messageType:E.nx.ProtocolsConfigure,target:this.connectedDid}),{message:e,messageCid:r,reply:{status:i}}=t,d={status:i};return i.code<300&&(d.protocol=new je(this.agent,e,{author:this.connectedDid,messageCid:r})),d}),query:n=>te(this,void 0,void 0,function*(){const t={author:this.connectedDid,messageParams:n.message,messageType:E.nx.ProtocolsQuery,target:n.from||this.connectedDid};let e;e=n.from?yield this.agent.sendDwnRequest(t):yield this.agent.processDwnRequest(t);const r=e.reply,{entries:i=[],status:d}=r;return{protocols:i.map(l=>new je(this.agent,l,{author:this.connectedDid})),status:d}})}}get records(){return{create:n=>te(this,void 0,void 0,function*(){return this.records.write(n)}),createFrom:n=>te(this,void 0,void 0,function*(){var t;const e=n.record.toJSON(),{author:r}=e,i=function(o,n){var t={};for(var e in o)Object.prototype.hasOwnProperty.call(o,e)&&n.indexOf(e)<0&&(t[e]=o[e]);if(null!=o&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(e=Object.getOwnPropertySymbols(o);r<e.length;r++)n.indexOf(e[r])<0&&Object.prototype.propertyIsEnumerable.call(o,e[r])&&(t[e[r]]=o[e[r]])}return t}(e,["author"]);return void 0!==n.data&&(delete i.dataCid,delete i.dataSize),!1===(null===(t=n.message)||void 0===t?void 0:t.published)&&void 0!==i.datePublished&&(delete i.datePublished,delete i.published),(!(0,K.RI)(n.message)||n.author&&n.author!==r)&&delete i.recordId,this.records.write({data:n.data,message:Object.assign(Object.assign({},i),n.message)})}),delete:n=>te(this,void 0,void 0,function*(){const t={author:this.connectedDid,messageParams:n.message,messageType:E.nx.RecordsDelete,target:n.from||this.connectedDid};let e;e=n.from?yield this.agent.sendDwnRequest(t):yield this.agent.processDwnRequest(t);const{reply:{status:r}}=e;return{status:r}}),query:n=>te(this,void 0,void 0,function*(){const t={author:this.connectedDid,messageParams:n.message,messageType:E.nx.RecordsQuery,target:n.from||this.connectedDid};let e;e=n.from?yield this.agent.sendDwnRequest(t):yield this.agent.processDwnRequest(t);const r=e.reply,{entries:i,status:d,cursor:s}=r;return{records:i.map(c=>{const a=Object.assign({author:(0,E.dK)(c),connectedDid:this.connectedDid,remoteOrigin:n.from},c);return new Y(this.agent,a)}),status:d,cursor:s}}),read:n=>te(this,void 0,void 0,function*(){const t={author:this.connectedDid,messageParams:n.message,messageType:E.nx.RecordsRead,target:n.from||this.connectedDid};let e;e=n.from?yield this.agent.sendDwnRequest(t):yield this.agent.processDwnRequest(t);const{reply:{record:r,status:i}}=e;let d;if(200<=i.code&&i.code<=299){const s=Object.assign({author:(0,E.dK)(r),connectedDid:this.connectedDid,remoteOrigin:n.from},r);d=new Y(this.agent,s)}return{record:d,status:i}}),write:n=>te(this,void 0,void 0,function*(){var t;const{dataBlob:e,dataFormat:r}=q(n.data,null===(t=n.message)||void 0===t?void 0:t.dataFormat),i=yield this.agent.processDwnRequest({author:this.connectedDid,dataStream:e,messageParams:Object.assign(Object.assign({},n.message),{dataFormat:r}),messageType:E.nx.RecordsWrite,store:n.store,target:this.connectedDid}),{message:d,reply:{status:s}}=i;let l;if(200<=s.code&&s.code<=299){const c=Object.assign({author:this.connectedDid,connectedDid:this.connectedDid,encodedData:e},d);l=new Y(this.agent,c)}return{record:l,status:s}})}}}class ct{constructor(n){this.agent=n.agent,this.connectedDid=n.connectedDid}create(){return o=this,n=void 0,e=function*(){throw new Error("Not implemented.")},new((t=void 0)||(t=Promise))(function(i,d){function s(a){try{c(e.next(a))}catch(u){d(u)}}function l(a){try{c(e.throw(a))}catch(u){d(u)}}function c(a){a.done?i(a.value):function r(i){return i instanceof t?i:new t(function(d){d(i)})}(a.value).then(s,l)}c((e=e.apply(o,n||[])).next())});var o,n,t,e}}var Ke=function(o){return o.authentication="authentication",o.assertionMethod="assertionMethod",o.keyAgreement="keyAgreement",o.capabilityInvocation="capabilityInvocation",o.capabilityDelegation="capabilityDelegation",o}(Ke||{});const ve={"@context":"https://w3id.org/did-resolution/v1",didResolutionMetadata:{},didDocument:null,didDocumentMetadata:{}};class R{constructor({method:n,id:t,path:e,query:r,fragment:i,params:d}){this.uri=`did:${n}:${t}`,this.method=n,this.id=t,this.path=e,this.query=r,this.fragment=i,this.params=d}static parse(n){if(!n)return null;const t=R.DID_URI_PATTERN.exec(n);if(!t||!t.groups)return null;const{method:e,id:r,path:i,query:d,fragment:s}=t.groups,l={uri:`did:${e}:${r}`,method:e,id:r};if(i&&(l.path=i),d&&(l.query=d.slice(1)),s&&(l.fragment=s.slice(1)),d){const c={},a=d.slice(1).split("&");for(const u of a){const[y,v]=u.split("=");c[y]=v}l.params=c}return l}}R.METHOD_PATTERN="([a-z0-9]+)",R.PCT_ENCODED_PATTERN="(?:%[0-9a-fA-F]{2})",R.ID_CHAR_PATTERN=`(?:[a-zA-Z0-9._-]|${R.PCT_ENCODED_PATTERN})`,R.METHOD_ID_PATTERN=`((?:${R.ID_CHAR_PATTERN}*:)*(${R.ID_CHAR_PATTERN}+))`,R.PATH_PATTERN="(/[^#?]*)?",R.QUERY_PATTERN="([?][^#]*)?",R.FRAGMENT_PATTERN="(#.*)?",R.DID_URI_PATTERN=new RegExp(`^did:(?<method>${R.METHOD_PATTERN}):(?<id>${R.METHOD_ID_PATTERN})(?<path>${R.PATH_PATTERN})(?<query>${R.QUERY_PATTERN})(?<fragment>${R.FRAGMENT_PATTERN})$`);class U extends Error{constructor(n,t){super(`${n}: ${t}`),this.code=n,this.name="DidError",Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,U)}}var P=function(o){return o.InvalidDid="invalidDid",o.MethodNotSupported="methodNotSupported",o.InternalError="internalError",o.InvalidDidDocument="invalidDidDocument",o.InvalidDidDocumentLength="invalidDidDocumentLength",o.InvalidDidUrl="invalidDidUrl",o.InvalidPreviousDidProof="invalidPreviousDidProof",o.InvalidPublicKey="invalidPublicKey",o.InvalidPublicKeyLength="invalidPublicKeyLength",o.InvalidPublicKeyType="invalidPublicKeyType",o.InvalidSignature="invalidSignature",o.NotFound="notFound",o.RepresentationNotSupported="representationNotSupported",o.UnsupportedPublicKeyType="unsupportedPublicKeyType",o}(P||{}),O=k(86136);function G(o){if("string"==typeof o&&0!==o.length)return o.split("#").pop()}function Ee(o){return!(!o||"object"!=typeof o||null===o||!("id"in o&&"type"in o&&"controller"in o)||"string"!=typeof o.id||"string"!=typeof o.type||"string"!=typeof o.controller)}var be=function(o,n,t,e){return new(t||(t=Promise))(function(i,d){function s(a){try{c(e.next(a))}catch(u){d(u)}}function l(a){try{c(e.throw(a))}catch(u){d(u)}}function c(a){a.done?i(a.value):function r(i){return i instanceof t?i:new t(function(d){d(i)})}(a.value).then(s,l)}c((e=e.apply(o,n||[])).next())})};class pe{constructor({uri:n,document:t,metadata:e,keyManager:r}){this.uri=n,this.document=t,this.metadata=e,this.keyManager=r}export(){return be(this,void 0,void 0,function*(){if(!(Array.isArray(this.document.verificationMethod)&&this.document.verificationMethod.length>0))throw new Error(`DID document for '${this.uri}' is missing verification methods`);let n={uri:this.uri,document:this.document,metadata:this.metadata};if("exportKey"in this.keyManager&&"function"==typeof this.keyManager.exportKey){const t=[];for(let e of this.document.verificationMethod){if(!e.publicKeyJwk)throw new Error(`Verification method '${e.id}' does not contain a public key in JWK format`);const r=yield this.keyManager.getKeyUri({key:e.publicKeyJwk}),i=yield this.keyManager.exportKey({keyUri:r});t.push(Object.assign({},i))}n.privateKeys=t}return n})}getSigner(n){return be(this,void 0,void 0,function*(){var t;const e=null===(t=this.document.verificationMethod)||void 0===t?void 0:t.find(l=>{var c,a;return G(l.id)===(null!==(c=G(n?.methodId))&&void 0!==c?c:G(null===(a=this.document.assertionMethod)||void 0===a?void 0:a[0]))});if(!e||!e.publicKeyJwk)throw new U(P.InternalError,"A verification method intended for signing could not be determined from the DID Document");const r=yield this.keyManager.getKeyUri({key:e.publicKeyJwk}),i=yield this.keyManager.getPublicKey({keyUri:r}),d=this.keyManager;return{algorithm:O.Wp.getJoseSignatureAlgorithmFromPublicKey(i),keyId:e.id,sign(l){return be(this,arguments,void 0,function*({data:c}){return yield d.sign({data:c,keyUri:r})})},verify(l){return be(this,arguments,void 0,function*({data:c,signature:a}){return yield d.verify({data:c,key:i,signature:a})})}}})}static import(n){return be(this,arguments,void 0,function*({portableDid:t,keyManager:e=new O.eP}){var r;const i=function Me({didDocument:o}){var n,t;if(!o)throw new TypeError("Required parameter missing: 'didDocument'");const e=[];return e.push(...null!==(t=null===(n=o.verificationMethod)||void 0===n?void 0:n.filter(Ee))&&void 0!==t?t:[]),Object.keys(Ke).forEach(r=>{var i,d;e.push(...null!==(d=null===(i=o[r])||void 0===i?void 0:i.filter(Ee))&&void 0!==d?d:[])}),e}({didDocument:t.document});if(0===i.length)throw new U(P.InvalidDidDocument,"At least one verification method is required but 0 were given");for(let s of null!==(r=t.privateKeys)&&void 0!==r?r:[])yield e.importKey({key:s});for(let s of i){if(!s.publicKeyJwk)throw new Error(`Verification method '${s.id}' does not contain a public key in JWK format`);const l=yield e.getKeyUri({key:s.publicKeyJwk});yield e.getPublicKey({keyUri:l})}return new pe({uri:t.uri,document:t.document,metadata:t.metadata,keyManager:e})})}}var Be=k(2198),ke=k(49402),Le=function(o,n,t,e){return new(t||(t=Promise))(function(i,d){function s(a){try{c(e.next(a))}catch(u){d(u)}}function l(a){try{c(e.throw(a))}catch(u){d(u)}}function c(a){a.done?i(a.value):function r(i){return i instanceof t?i:new t(function(d){d(i)})}(a.value).then(s,l)}c((e=e.apply(o,n||[])).next())})};class Fe{static getSigningMethod(n){return Le(this,void 0,void 0,function*(){throw new Error("Not implemented: Classes extending DidMethod must implement getSigningMethod()")})}static resolve(n,t){return Le(this,void 0,void 0,function*(){throw new Error("Not implemented: Classes extending DidMethod must implement resolve()")})}}var C=function(o,n,t,e){return new(t||(t=Promise))(function(i,d){function s(a){try{c(e.next(a))}catch(u){d(u)}}function l(a){try{c(e.throw(a))}catch(u){d(u)}}function c(a){a.done?i(a.value):function r(i){return i instanceof t?i:new t(function(d){d(i)})}(a.value).then(s,l)}c((e=e.apply(o,n||[])).next())})},Ve=function(o,n){var t={};for(var e in o)Object.prototype.hasOwnProperty.call(o,e)&&n.indexOf(e)<0&&(t[e]=o[e]);if(null!=o&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(e=Object.getOwnPropertySymbols(o);r<e.length;r++)n.indexOf(e[r])<0&&Object.prototype.propertyIsEnumerable.call(o,e[r])&&(t[e[r]]=o[e[r]])}return t};const Je="https://diddht.tbddev.org",ie=7200,F=",";var We=function(o){return o[o.Discoverable=0]="Discoverable",o[o.Organization=1]="Organization",o[o.Government=2]="Government",o[o.Corporation=3]="Corporation",o[o.LocalBusiness=4]="LocalBusiness",o[o.SoftwarePackage=5]="SoftwarePackage",o[o.WebApp=6]="WebApp",o[o.FinancialInstitution=7]="FinancialInstitution",o}(We||{}),J=function(o){return o[o.Ed25519=0]="Ed25519",o[o.secp256k1=1]="secp256k1",o[o.secp256r1=2]="secp256r1",o[o.X25519=3]="X25519",o}(J||{}),ze=function(o){return o.authentication="auth",o.assertionMethod="asm",o.capabilityDelegation="del",o.capabilityInvocation="inv",o.keyAgreement="agm",o}(ze||{});const Xe={Ed25519:J.Ed25519,ES256K:J.secp256k1,ES256:J.secp256r1,"P-256":J.secp256r1,secp256k1:J.secp256k1,secp256r1:J.secp256r1,X25519:J.X25519},qe={[J.Ed25519]:"Ed25519",[J.secp256k1]:"ES256K",[J.secp256r1]:"ES256",[J.X25519]:"ECDH-ES+A256KW"};let Te=(()=>{class o extends Fe{static create(){return C(this,arguments,void 0,function*({keyManager:t=new O.eP,options:e={}}={}){var r,i,d,s,l,c,a,u,y,v,_;if(null!==(r=e.verificationMethods)&&void 0!==r&&r.some(p=>!(p.algorithm in Xe)))throw new Error("One or more verification method algorithms are not supported");const b=null===(i=e.verificationMethods)||void 0===i?void 0:i.filter(p=>"id"in p).map(p=>p.id);if(b&&b.length!==new Set(b).size)throw new Error("One or more verification method IDs are not unique");if(null!==(d=e.services)&&void 0!==d&&d.some(p=>!p.id||!p.type||!p.serviceEndpoint))throw new Error("One or more services are missing required properties");const w=yield t.generateKey({algorithm:"Ed25519"}),S=yield t.getPublicKey({keyUri:w}),g=yield x.identityKeyToIdentifier({identityKey:S}),f=Object.assign(Object.assign({id:g},e.alsoKnownAs&&{alsoKnownAs:e.alsoKnownAs}),e.controllers&&{controller:e.controllers}),D=[...null!==(s=e.verificationMethods)&&void 0!==s?s:[]];D?.some(p=>{var T;return"0"===(null===(T=p.id)||void 0===T?void 0:T.split("#").pop())})||D.unshift({algorithm:"Ed25519",id:"0",purposes:["authentication","assertionMethod","capabilityDelegation","capabilityInvocation"]});for(const p of D){const T=p.id&&"0"===p.id.split("#").pop()?w:yield t.generateKey({algorithm:p.algorithm}),z=yield t.getPublicKey({keyUri:T});let H=null!==(c=null!==(l=p.id)&&void 0!==l?l:z.kid)&&void 0!==c?c:yield(0,O.BA)({jwk:z});H=`${g}#${G(H)}`,null!==(a=f.verificationMethod)&&void 0!==a||(f.verificationMethod=[]),f.verificationMethod.push({id:H,type:"JsonWebKey",controller:null!==(u=p.controller)&&void 0!==u?u:g,publicKeyJwk:z});for(const B of null!==(y=p.purposes)&&void 0!==y?y:[])f[B]||(f[B]=[]),f[B].push(H)}null===(v=e.services)||void 0===v||v.forEach(p=>{var T;null!==(T=f.service)&&void 0!==T||(f.service=[]),p.id=`${g}#${p.id.split("#").pop()}`,f.service.push(p)});const M=new pe({uri:g,document:f,metadata:Object.assign({published:!1},e.types&&{types:e.types}),keyManager:t});if(null===(_=e.publish)||void 0===_||_){const p=yield o.publish({did:M,gatewayUri:e.gatewayUri});M.metadata=p.didDocumentMetadata}return M})}static import(t){return C(this,arguments,void 0,function*({portableDid:e,keyManager:r=new O.eP}){var i;const d=R.parse(e.uri);if(d?.method!==o.methodName)throw new U(P.MethodNotSupported,"Method not supported");const s=yield pe.import({portableDid:e,keyManager:r});if(null===(i=s.document.verificationMethod)||void 0===i||!i.some(l=>{var c;return"0"===(null===(c=l.id)||void 0===c?void 0:c.split("#").pop())}))throw new U(P.InvalidDidDocument,"DID document must contain an Identity Key");return s})}static getSigningMethod(t){return C(this,arguments,void 0,function*({didDocument:e,methodId:r="#0"}){var i;const d=R.parse(e.id);if(d&&d.method!==this.methodName)throw new U(P.MethodNotSupported,`Method not supported: ${d.method}`);const s=null===(i=e.verificationMethod)||void 0===i?void 0:i.find(l=>{var c,a;return G(l.id)===(null!==(c=G(r))&&void 0!==c?c:G(null===(a=e.assertionMethod)||void 0===a?void 0:a[0]))});if(!s||!s.publicKeyJwk)throw new U(P.InternalError,"A verification method intended for signing could not be determined from the DID Document");return s})}static publish(t){return C(this,arguments,void 0,function*({did:e,gatewayUri:r=Je}){return yield ee.put({did:e,gatewayUri:r})})}static resolve(t){return C(this,arguments,void 0,function*(e,r={}){var i;const d=null!==(i=r?.gatewayUri)&&void 0!==i?i:Je;try{yield x.identifierToIdentityKey({didUri:e});const{didDocument:s,didDocumentMetadata:l}=yield ee.get({didUri:e,gatewayUri:d});return Object.assign(Object.assign({},ve),{didDocument:s,didDocumentMetadata:l})}catch(s){if(!(s instanceof U))throw new Error(s);return Object.assign(Object.assign({},ve),{didResolutionMetadata:Object.assign({error:s.code},s.message&&{errorMessage:s.message})})}})}}return o.methodName="dht",o})();class ee{static get(n){return C(this,arguments,void 0,function*({didUri:t,gatewayUri:e}){const r=x.identifierToIdentityKeyBytes({didUri:t}),i=yield ee.pkarrGet({gatewayUri:e,publicKeyBytes:r}),d=yield x.parseBep44GetMessage({bep44Message:i}),s=yield ee.fromDnsPacket({didUri:t,dnsPacket:d});return s.didDocumentMetadata.versionId=i.seq.toString(),s})}static put(n){return C(this,arguments,void 0,function*({did:t,gatewayUri:e}){const r=yield ee.toDnsPacket({didDocument:t.document,didMetadata:t.metadata,authoritativeGatewayUris:[e]}),i=yield x.createBep44PutMessage({dnsPacket:r,publicKeyBytes:x.identifierToIdentityKeyBytes({didUri:t.uri}),signer:yield t.getSigner({methodId:"0"})}),d=yield ee.pkarrPut({gatewayUri:e,bep44Message:i});return{didDocument:t.document,didDocumentMetadata:Object.assign(Object.assign({},t.metadata),{published:d,versionId:i.seq.toString()}),didRegistrationMetadata:{}}})}static pkarrGet(n){return C(this,arguments,void 0,function*({gatewayUri:t,publicKeyBytes:e}){const r=K.U$.uint8Array(e).toBase32Z(),i=new URL(r,t).href;let d;try{if(d=yield fetch(i,{method:"GET"}),!d.ok)throw new U(P.NotFound,`Pkarr record not found for: ${r}`)}catch(c){throw c instanceof U?c:new U(P.InternalError,`Failed to fetch Pkarr record: ${c.message}`)}const s=yield d.arrayBuffer();if(!s)throw new U(P.NotFound,`Pkarr record not found for: ${r}`);if(s.byteLength<72)throw new U(P.InvalidDidDocumentLength,`Pkarr response must be at least 72 bytes but got: ${s.byteLength}`);if(s.byteLength>1072)throw new U(P.InvalidDidDocumentLength,`Pkarr response exceeds 1000 byte limit: ${s.byteLength}`);return{k:e,seq:Number(new DataView(s).getBigUint64(64)),sig:new Uint8Array(s,0,64),v:new Uint8Array(s,72)}})}static pkarrPut(n){return C(this,arguments,void 0,function*({gatewayUri:t,bep44Message:e}){const r=K.U$.uint8Array(e.k).toBase32Z(),i=new URL(r,t).href,d=new Uint8Array(e.v.length+72);let s;d.set(e.sig,0),new DataView(d.buffer).setBigUint64(e.sig.length,BigInt(e.seq)),d.set(e.v,e.sig.length+8);try{s=yield fetch(i,{method:"PUT",headers:{"Content-Type":"application/octet-stream"},body:d})}catch(l){throw new U(P.InternalError,`Failed to put Pkarr record for identifier ${r}: ${l.message}`)}return s.ok})}static fromDnsPacket(n){return C(this,arguments,void 0,function*({didUri:t,dnsPacket:e}){var r,i,d;const s={id:t},l={published:!0},c=new Map;for(const a of null!==(r=e?.answers)&&void 0!==r?r:[]){if("TXT"!==a.type)continue;const u=a.name.split(".")[0].substring(1);switch(!0){case u.startsWith("aka"):{const y=x.parseTxtDataToString(a.data);s.alsoKnownAs=y.split(F);break}case u.startsWith("cnt"):{const y=x.parseTxtDataToString(a.data);s.controller=y.includes(F)?y.split(F):y;break}case u.startsWith("k"):{const{id:y,t:v,k:_,c:b,a:w}=x.parseTxtDataToObject(a.data),S=K.U$.base64Url(_).toUint8Array(),g=J[Number(v)];let f=yield x.keyConverter(g).bytesToPublicKey({publicKeyBytes:S});f.alg=w||qe[Number(v)];const D="k0"===u?"0":void 0!==y?y:yield(0,O.BA)({jwk:f});null!==(i=s.verificationMethod)&&void 0!==i||(s.verificationMethod=[]);const M=`${t}#${D}`;s.verificationMethod.push({id:M,type:"JsonWebKey",controller:b??t,publicKeyJwk:f}),c.set(u,M);break}case u.startsWith("s"):{const y=x.parseTxtDataToObject(a.data),{id:v,t:_,se:b}=y,w=Ve(y,["id","t","se"]),S=b.includes(F)?b.split(F):[b],g=Object.fromEntries(Object.entries(w).map(([f,D])=>[f,D.includes(F)?D.split(F):D]));null!==(d=s.service)&&void 0!==d||(s.service=[]),s.service.push(Object.assign(Object.assign({},g),{id:`${t}#${v}`,type:_,serviceEndpoint:S}));break}case u.startsWith("typ"):{const{id:y}=x.parseTxtDataToObject(a.data);l.types=y.split(F).map(v=>Number(v));break}case u.startsWith("did"):{const y=g=>g.split(F).map(f=>c.get(f)).filter(f=>"string"==typeof f),{auth:v,asm:_,del:b,inv:w,agm:S}=x.parseTxtDataToObject(a.data);v&&(s.authentication=y(v)),_&&(s.assertionMethod=y(_)),b&&(s.capabilityDelegation=y(b)),w&&(s.capabilityInvocation=y(w)),S&&(s.keyAgreement=y(S));break}}}return{didDocument:s,didDocumentMetadata:l,didResolutionMetadata:{}}})}static toDnsPacket(n){return C(this,arguments,void 0,function*({didDocument:t,didMetadata:e,authoritativeGatewayUris:r,previousDidProof:i}){var d,s,l,c,a;const u=[],y=[],v=new Map,_=[],b=[];if(void 0!==i){const{signature:g,previousDid:f}=i;yield x.validatePreviousDidProof({newDid:t.id,previousDidProof:i}),u.push({type:"TXT",name:"_prv._did.",ttl:ie,data:`id=${f};s=${g}`})}if(t.alsoKnownAs&&u.push({type:"TXT",name:"_aka._did.",ttl:ie,data:t.alsoKnownAs.join(F)}),t.controller){const g=Array.isArray(t.controller)?t.controller.join(F):t.controller;u.push({type:"TXT",name:"_cnt._did.",ttl:ie,data:g})}for(const[g,f]of null!==(s=null===(d=t.verificationMethod)||void 0===d?void 0:d.entries())&&void 0!==s?s:[]){const D=`k${g}`;b.push(D);let M=f.id.split("#").pop();v.set(M,D);const p=f.publicKeyJwk;if(!p?.crv||!(p.crv in Xe))throw new U(P.InvalidPublicKeyType,`Verification method '${f.id}' contains an unsupported key type: ${null!==(l=p?.crv)&&void 0!==l?l:"undefined"}`);const T=J[p.crv],z=yield x.keyConverter(p.crv).publicKeyToBytes({publicKey:p}),B=[`t=${T}`,`k=${K.U$.uint8Array(z).toBase64Url()}`];"0"!==M&&(yield(0,O.BA)({jwk:p}))!==M&&B.unshift(`id=${M}`),p.alg!==qe[T]&&B.push(`a=${p.alg}`),f.controller!==t.id&&B.push(`c=${f.controller}`),u.push({type:"TXT",name:`_${D}._did.`,ttl:ie,data:B.join(";")})}null===(c=t.service)||void 0===c||c.forEach((g,f)=>{const D=`s${f}`;_.push(D);let{id:M,type:p,serviceEndpoint:T}=g,z=Ve(g,["id","type","serviceEndpoint"]);M=G(M),T=Array.isArray(T)?T.join(","):T;const B=Object.entries(Object.assign({id:M,t:p,se:T},z)).map(([Ce,$e])=>`${Ce}=${$e}`).join(";"),Ne=x.chunkDataIfNeeded(B);u.push({type:"TXT",name:`_${D}._did.`,ttl:ie,data:Ne})});const w=["v=0"];if(b.length&&w.push(`vm=${b.join(F)}`),Object.keys(Ke).forEach(g=>{var f;const D=null===(f=t[g])||void 0===f?void 0:f.map(M=>v.get(M.split("#").pop()));D&&w.push(`${ze[g]}=${D.join(F)}`)}),_.length&&w.push(`svc=${_.join(F)}`),null!==(a=e.types)&&void 0!==a&&a.length){const f=e.types.map(D=>"string"==typeof D?We[D]:D);u.push({type:"TXT",name:"_typ._did.",ttl:ie,data:`id=${f.join(F)}`})}u.push({type:"TXT",name:"_did."+ee.getUniqueDidSuffix(t.id)+".",ttl:ie,data:w.join(";")});for(const g of r||[])y.push({type:"NS",name:"_did."+ee.getUniqueDidSuffix(t.id)+".",ttl:ie,data:g+"."});return{id:0,type:"response",flags:ke.hB,answers:[...u,...y]}})}static getUniqueDidSuffix(n){return n.split(":")[2]}}class x{static createBep44PutMessage(n){return C(this,arguments,void 0,function*({dnsPacket:t,publicKeyBytes:e,signer:r}){const i=Math.ceil(Date.now()/1e3),d=(0,ke.lF)(t),s=Be.A.encode({seq:i,v:d}).subarray(1,-1);if(s.length>1e3)throw new U(P.InvalidDidDocumentLength,`DNS packet exceeds the 1000 byte maximum size: ${s.length} bytes`);return{k:e,seq:i,sig:yield r.sign({data:s}),v:d}})}static identifierToIdentityKey(n){return C(this,arguments,void 0,function*({didUri:t}){let e=x.identifierToIdentityKeyBytes({didUri:t});return yield O.Mc.bytesToPublicKey({publicKeyBytes:e})})}static identifierToIdentityKeyBytes({didUri:n}){const t=R.parse(n);if(!t)throw new U(P.InvalidDid,`Invalid DID URI: ${n}`);if(t.method!==Te.methodName)throw new U(P.MethodNotSupported,`Method not supported: ${t.method}`);let e;try{e=K.U$.base32Z(t.id).toUint8Array()}catch{throw new U(P.InvalidPublicKey,"Failed to decode method-specific identifier")}if(32!==e.length)throw new U(P.InvalidPublicKeyLength,`Invalid public key length: ${e.length}`);return e}static identityKeyToIdentifier(n){return C(this,arguments,void 0,function*({identityKey:t}){const e=yield O.Mc.publicKeyToBytes({publicKey:t}),r=K.U$.uint8Array(e).toBase32Z();return`did:${Te.methodName}:${r}`})}static keyConverter(n){const e={Ed25519:O.Mc,"P-256":{publicKeyToBytes:r=>C(this,[r],void 0,function*({publicKey:i}){const d=yield O.iH.publicKeyToBytes({publicKey:i});return yield O.iH.compressPublicKey({publicKeyBytes:d})}),bytesToPublicKey:O.iH.bytesToPublicKey,privateKeyToBytes:O.iH.privateKeyToBytes,bytesToPrivateKey:O.iH.bytesToPrivateKey},secp256k1:{publicKeyToBytes:r=>C(this,[r],void 0,function*({publicKey:i}){const d=yield O.jg.publicKeyToBytes({publicKey:i});return yield O.jg.compressPublicKey({publicKeyBytes:d})}),bytesToPublicKey:O.jg.bytesToPublicKey,privateKeyToBytes:O.jg.privateKeyToBytes,bytesToPrivateKey:O.jg.bytesToPrivateKey},X25519:O.Nx}[n];if(!e)throw new U(P.InvalidPublicKeyType,`Unsupported curve: ${n}`);return e}static parseBep44GetMessage(n){return C(this,arguments,void 0,function*({bep44Message:t}){const e=yield O.Mc.bytesToPublicKey({publicKeyBytes:t.k}),r=Be.A.encode({seq:t.seq,v:t.v}).subarray(1,-1);if(!(yield O.Mc.verify({key:e,signature:t.sig,data:r})))throw new U(P.InvalidSignature,"Invalid signature for DHT BEP44 message");return(0,ke.D4)(t.v)})}static parseTxtDataToObject(n){return this.parseTxtDataToString(n).split(";").reduce((t,e)=>{const[r,i]=e.split("=");return t[r]=i,t},{})}static parseTxtDataToString(n){if("string"==typeof n)return n;if(n instanceof Uint8Array)return K.U$.uint8Array(n).toString();if(Array.isArray(n))return n.map(t=>this.parseTxtDataToString(t)).join("");throw new U(P.InternalError,"Pkarr returned DNS TXT record with invalid data type")}static validatePreviousDidProof(n){return C(this,arguments,void 0,function*({newDid:t,previousDidProof:e}){const r=yield x.identifierToIdentityKey({didUri:e.previousDid}),i=x.identifierToIdentityKeyBytes({didUri:t}),d=K.U$.base64Url(e.signature).toUint8Array();if(!(yield O.Mc.verify({key:r,data:i,signature:d})))throw new U(P.InvalidPreviousDidProof,"The previous DID proof is invalid.")})}static chunkDataIfNeeded(n){if(n.length<=255)return n;const t=[];for(let e=0;e<n.length;e+=255)t.push(n.slice(e,e+255));return t}}k(52039);var De=function(o,n,t,e){return new(t||(t=Promise))(function(i,d){function s(a){try{c(e.next(a))}catch(u){d(u)}}function l(a){try{c(e.throw(a))}catch(u){d(u)}}function c(a){a.done?i(a.value):function r(i){return i instanceof t?i:new t(function(d){d(i)})}(a.value).then(s,l)}c((e=e.apply(o,n||[])).next())})};let pt=(()=>{class o extends Fe{static create(){return De(this,arguments,void 0,function*({keyManager:t=new O.eP,options:e={}}={}){var r,i,d,s;if(e.algorithm&&e.verificationMethods)throw new Error("The 'algorithm' and 'verificationMethods' options are mutually exclusive");if(e.verificationMethods&&1!==e.verificationMethods.length)throw new Error("The 'verificationMethods' option must contain exactly one entry");const l=null!==(s=null!==(r=e.algorithm)&&void 0!==r?r:null===(d=null===(i=e.verificationMethods)||void 0===i?void 0:i[0])||void 0===d?void 0:d.algorithm)&&void 0!==s?s:"Ed25519",c=yield t.generateKey({algorithm:l}),a=yield t.getPublicKey({keyUri:c}),u=K.U$.object(a).toBase64Url(),y=`did:${o.methodName}:${u}`,_=(yield o.resolve(y)).didDocument;return new pe({uri:y,document:_,metadata:{},keyManager:t})})}static getSigningMethod(t){return De(this,arguments,void 0,function*({didDocument:e}){var r;const i=R.parse(e.id);if(i&&i.method!==this.methodName)throw new U(P.MethodNotSupported,`Method not supported: ${i.method}`);const[d]=null!==(r=e.verificationMethod)&&void 0!==r?r:[];if(!d||!d.publicKeyJwk)throw new U(P.InternalError,"A verification method intended for signing could not be determined from the DID Document");return d})}static import(t){return De(this,arguments,void 0,function*({portableDid:e,keyManager:r=new O.eP}){const i=R.parse(e.uri);if(i?.method!==o.methodName)throw new U(P.MethodNotSupported,"Method not supported");const d=yield pe.import({portableDid:e,keyManager:r});if(1!==d.document.verificationMethod.length)throw new U(P.InvalidDidDocument,"DID document must contain exactly one verification method");return d})}static resolve(t,e){return De(this,void 0,void 0,function*(){const r=R.parse(t);let i;try{i=K.U$.base64Url(r.id).toObject()}catch{}if(!r||!i)return Object.assign(Object.assign({},ve),{didResolutionMetadata:{error:"invalidDid"}});if(r.method!==o.methodName)return Object.assign(Object.assign({},ve),{didResolutionMetadata:{error:"methodNotSupported"}});const d={"@context":["https://www.w3.org/ns/did/v1"],id:r.uri},s=`${d.id}#0`;switch(d.verificationMethod=[{id:s,type:"JsonWebKey",controller:d.id,publicKeyJwk:i}],d.authentication=[s],d.assertionMethod=[s],d.capabilityInvocation=[s],d.capabilityDelegation=[s],d.keyAgreement=[s],i.use){case"sig":delete d.keyAgreement;break;case"enc":delete d.authentication,delete d.assertionMethod,delete d.capabilityInvocation,delete d.capabilityDelegation}return Object.assign(Object.assign({},ve),{didDocument:d})})}}return o.methodName="jwk",o})();var ht=k(97829),ft=k(67449);class vt{constructor({db:n,location:t="DATA/DID_RESOLVERCACHE",ttl:e="15m"}={}){this.cache=n??new ft.Level(t),this.ttl=ht(e)}get(n){return function(o,n,t,e){return new(t||(t=Promise))(function(i,d){function s(a){try{c(e.next(a))}catch(u){d(u)}}function l(a){try{c(e.throw(a))}catch(u){d(u)}}function c(a){a.done?i(a.value):function r(i){return i instanceof t?i:new t(function(d){d(i)})}(a.value).then(s,l)}c((e=e.apply(o,n||[])).next())})}(this,void 0,void 0,function*(){try{const t=yield this.cache.get(n),e=JSON.parse(t);return Date.now()>=e.ttlMillis?void this.cache.nextTick(()=>this.cache.del(n)):e.value}catch(t){if(t.notFound)return;throw t}})}set(n,t){const e={ttlMillis:Date.now()+this.ttl,value:t},r=JSON.stringify(e);return this.cache.put(n,r)}delete(n){return this.cache.del(n)}clear(){return this.cache.clear()}close(){return this.cache.close()}}var Z=function(o,n,t,e){return new(t||(t=Promise))(function(i,d){function s(a){try{c(e.next(a))}catch(u){d(u)}}function l(a){try{c(e.throw(a))}catch(u){d(u)}}function c(a){a.done?i(a.value):function r(i){return i instanceof t?i:new t(function(d){d(i)})}(a.value).then(s,l)}c((e=e.apply(o,n||[])).next())})};class Ue{constructor(n){this._agentDid=n.agentDid,this.crypto=n.cryptoApi,this.did=n.didApi,this.dwn=n.dwnApi,this.identity=n.identityApi,this.keyManager=n.keyManager,this.rpc=n.rpcClient,this.sync=n.syncApi,this.vault=n.agentVault,this.did.agent=this,this.dwn.agent=this,this.identity.agent=this,this.keyManager.agent=this,this.sync.agent=this}get agentDid(){if(void 0===this._agentDid)throw new Error('Web5UserAgent: The "agentDid" property is not set. Ensure the agent is properly initialized and a DID is assigned.');return this._agentDid}set agentDid(n){this._agentDid=n}static create({dataPath:n="DATA/AGENT",agentDid:t,agentVault:e,cryptoApi:r,didApi:i,dwnApi:d,identityApi:s,keyManager:l,rpcClient:c,syncApi:a}={}){return Z(this,void 0,void 0,function*(){return e??(e=new E.TX({keyDerivationWorkFactor:21e4,store:new K.cG({location:`${n}/VAULT_STORE`})})),r??(r=new E.DP),i??(i=new E.Bq({didMethods:[Te,pt],resolverCache:new vt({location:`${n}/DID_RESOLVERCACHE`}),store:new E.QZ})),d??(d=new E.rr({dwn:yield E.rr.createDwn({dataPath:n,didResolver:i})})),s??(s=new E.yc({store:new E.dk})),l??(l=new E.eP({keyStore:new E.cW})),c??(c=new E.oN),a??(a=new E.rM({syncEngine:new E.qB({dataPath:n})})),new Ue({agentDid:t,agentVault:e,cryptoApi:r,didApi:i,dwnApi:d,keyManager:l,identityApi:s,rpcClient:c,syncApi:a})})}firstLaunch(){return Z(this,void 0,void 0,function*(){return!1===(yield this.vault.isInitialized())})}initialize({password:n,recoveryPhrase:t}){return Z(this,void 0,void 0,function*(){return t=yield this.vault.initialize({password:n,recoveryPhrase:t})})}processDidRequest(n){return Z(this,void 0,void 0,function*(){return this.did.processRequest(n)})}processDwnRequest(n){return Z(this,void 0,void 0,function*(){return this.dwn.processRequest(n)})}processVcRequest(n){return Z(this,void 0,void 0,function*(){throw new Error("Not implemented")})}sendDidRequest(n){return Z(this,void 0,void 0,function*(){throw new Error("Not implemented")})}sendDwnRequest(n){return Z(this,void 0,void 0,function*(){return this.dwn.sendRequest(n)})}sendVcRequest(n){return Z(this,void 0,void 0,function*(){throw new Error("Not implemented")})}start({password:n}){return Z(this,void 0,void 0,function*(){this.vault.isLocked()&&(yield this.vault.unlock({password:n})),this.agentDid=yield this.vault.getDid()})}}class ${constructor({method:n,id:t,path:e,query:r,fragment:i,params:d}){this.uri=`did:${n}:${t}`,this.method=n,this.id=t,this.path=e,this.query=r,this.fragment=i,this.params=d}static parse(n){if(!n)return null;const t=$.DID_URI_PATTERN.exec(n);if(!t||!t.groups)return null;const{method:e,id:r,path:i,query:d,fragment:s}=t.groups,l={uri:`did:${e}:${r}`,method:e,id:r};if(i&&(l.path=i),d&&(l.query=d.slice(1)),s&&(l.fragment=s.slice(1)),d){const c={},a=d.slice(1).split("&");for(const u of a){const[y,v]=u.split("=");c[y]=v}l.params=c}return l}}$.METHOD_PATTERN="([a-z0-9]+)",$.PCT_ENCODED_PATTERN="(?:%[0-9a-fA-F]{2})",$.ID_CHAR_PATTERN=`(?:[a-zA-Z0-9._-]|${$.PCT_ENCODED_PATTERN})`,$.METHOD_ID_PATTERN=`((?:${$.ID_CHAR_PATTERN}*:)*(${$.ID_CHAR_PATTERN}+))`,$.PATH_PATTERN="(/[^#?]*)?",$.QUERY_PATTERN="([?][^#]*)?",$.FRAGMENT_PATTERN="(#.*)?",$.DID_URI_PATTERN=new RegExp(`^did:(?<method>${$.METHOD_PATTERN}):(?<id>${$.METHOD_ID_PATTERN})(?<path>${$.PATH_PATTERN})(?<query>${$.QUERY_PATTERN})(?<fragment>${$.FRAGMENT_PATTERN})$`),Error,k(44514),k(1424);function kt(o,n){return o=Math.ceil(o),n=Math.floor(n),Math.floor(Math.random()*(n-o))+o}class Ae{constructor({agent:n,connectedDid:t}){this.agent=n,this.connectedDid=t,this.did=new fe({agent:n,connectedDid:t}),this.dwn=new at({agent:n,connectedDid:t}),this.vc=new ct({agent:n,connectedDid:t})}static connect({agent:n,agentVault:t,connectedDid:e,password:r,recoveryPhrase:i,sync:d,techPreview:s}={}){var l;return function(o,n,t,e){return new(t||(t=Promise))(function(i,d){function s(a){try{c(e.next(a))}catch(u){d(u)}}function l(a){try{c(e.throw(a))}catch(u){d(u)}}function c(a){a.done?i(a.value):function r(i){return i instanceof t?i:new t(function(d){d(i)})}(a.value).then(s,l)}c((e=e.apply(o,n||[])).next())})}(this,void 0,void 0,function*(){if(void 0===n){const a=yield Ue.create({agentVault:t});n=a,void 0===r&&(r="insecure-static-phrase",console.warn("%cSECURITY WARNING:%c You have not set a password, which defaults to a static, guessable value. This significantly compromises the security of your data. Please configure a secure, unique password.","font-weight: bold; color: red;","font-weight: normal; color: inherit;")),(yield a.firstLaunch())&&(i=yield a.initialize({password:r,recoveryPhrase:i})),yield a.start({password:r});{let y;const v=yield a.identity.list(),_=v.length;if(0===_){const b=null!==(l=s?.dwnEndpoints)&&void 0!==l?l:yield function Et(){return function(o,n,t,e){return new(t||(t=Promise))(function(i,d){function s(a){try{c(e.next(a))}catch(u){d(u)}}function l(a){try{c(e.throw(a))}catch(u){d(u)}}function c(a){a.done?i(a.value):function r(i){return i instanceof t?i:new t(function(d){d(i)})}(a.value).then(s,l)}c((e=e.apply(o,n||[])).next())})}(this,void 0,void 0,function*(){let o;try{if(o=yield fetch("https://dwn.tbddev.org/.well-known/did.json"),!o.ok)throw new Error(`HTTP Error: ${o.status} ${o.statusText}`)}catch(r){return console.warn("failed to get tech preview dwn endpoints:",r.message),[]}const n=yield o.json(),[t]=function gt({didDocument:o,id:n,type:t}){var e,r;return null!==(r=null===(e=o?.service)||void 0===e?void 0:e.filter(i=>!(n&&i.id!==n||t&&i.type!==t)))&&void 0!==r?r:[]}({didDocument:n,id:"#dwn",type:"DecentralizedWebNode"}),e=new Set;if("serviceEndpoint"in t&&!Array.isArray(t.serviceEndpoint)&&"string"!=typeof t.serviceEndpoint&&Array.isArray(t.serviceEndpoint.nodes)){const r=t.serviceEndpoint.nodes,i=Math.min(r.length,2);for(let d=0;d<r.length&&e.size<i;d+=1){const l=r[kt(0,r.length)];try{(yield fetch(`${l}/health`)).ok&&e.add(l)}catch{}}}return Array.from(e)})}();y=yield a.identity.create({didMethod:"dht",metadata:{name:"Default"},didOptions:{services:[{id:"dwn",type:"DecentralizedWebNode",serviceEndpoint:b,enc:"#enc",sig:"#sig"}],verificationMethods:[{algorithm:"Ed25519",id:"sig",purposes:["assertionMethod","authentication"]},{algorithm:"secp256k1",id:"enc",purposes:["keyAgreement"]}]}}),yield a.identity.manage({portableIdentity:yield y.export()})}else{if(1!==_)throw new Error(`connect() failed due to unexpected state: Expected 1 but found ${_} stored identities.`);y=v[0]}e=y.did.uri}"off"!==d&&(yield a.sync.registerIdentity({did:e}),d??(d="2m"),a.sync.startSync({interval:d}).catch(y=>{console.error(`Sync failed: ${y}`)}))}return{web5:new Ae({agent:n,connectedDid:e}),did:e,recoveryPhrase:i}})}}var Q=k(93953),It=k(27413);let Ut=(()=>{class o{constructor(t){this.identityService=t}ngOnInit(){}createAccount(){var t=this;return(0,L.A)(function*(){const e="insecure-static-phrase",r="rubber fresh pluck lion upper length scene spawn fruit place spin glare";console.log("Creating agents...");const{web5:s,did:l}=yield Ae.connect({sync:"5s",recoveryPhrase:r});console.log(l),console.log(s);const c=yield s.agent.agentDid.export();console.log(c);const a=s.agent,u=yield a.identity.list();console.log(u);const y=u[0];console.log(y.metadata),y.metadata.name="John Doe";const v=yield y.export();console.log("DIDS:"),console.log(v);const _=yield a.agentDid.export();console.log(_),console.log(JSON.stringify(v.portableDid)),console.log(JSON.stringify(_)),yield t.identityService.initialize(e,r,"DATA/AGENT1"),yield t.identityService.initialize(e,"pistol base actress injury barely ivory poet happy raise tell idea summer","DATA/AGENT2"),console.log("Agents created."),console.log(t.identityService.agents()),console.log(yield t.identityService.agents()[0].identity.list()),console.log(yield t.identityService.agents()[1].identity.list())})()}static#e=this.\u0275fac=function(e){return new(e||o)(Q.rXU(It.K))};static#t=this.\u0275cmp=Q.VBU({type:o,selectors:[["app-new"]],standalone:!0,features:[Q.aNF],decls:5,vars:0,consts:[["mat-flat-button","",3,"click"]],template:function(e,r){1&e&&(Q.j41(0,"h1"),Q.EFF(1,"Create new account"),Q.k0s(),Q.j41(2,"p")(3,"button",0),Q.bIt("click",function(){return r.createAccount()}),Q.EFF(4,"Create account"),Q.k0s()())},dependencies:[N.Hl,N.$z]})}return o})()},1424:(le,A,k)=>{k(23963)},44514:le=>{var A=1e3,k=60*A,L=60*k,N=24*L,E=7*N;function q(h,m,I,Y){var me=m>=1.5*I;return Math.round(h/I)+" "+Y+(me?"s":"")}le.exports=function(h,m){m=m||{};var I=typeof h;if("string"===I&&h.length>0)return function he(h){if(!((h=String(h)).length>100)){var m=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(h);if(m){var I=parseFloat(m[1]);switch((m[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*I;case"weeks":case"week":case"w":return I*E;case"days":case"day":case"d":return I*N;case"hours":case"hour":case"hrs":case"hr":case"h":return I*L;case"minutes":case"minute":case"mins":case"min":case"m":return I*k;case"seconds":case"second":case"secs":case"sec":case"s":return I*A;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return I;default:return}}}}(h);if("number"===I&&isFinite(h))return m.long?function K(h){var m=Math.abs(h);return m>=N?q(h,m,N,"day"):m>=L?q(h,m,L,"hour"):m>=k?q(h,m,k,"minute"):m>=A?q(h,m,A,"second"):h+" ms"}(h):function fe(h){var m=Math.abs(h);return m>=N?Math.round(h/N)+"d":m>=L?Math.round(h/L)+"h":m>=k?Math.round(h/k)+"m":m>=A?Math.round(h/A)+"s":h+"ms"}(h);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(h))}},67449:(le,A,k)=>{A.Level=k(23963).BrowserLevel},97829:le=>{var A=1e3,k=60*A,L=60*k,N=24*L,E=7*N;function q(h,m,I,Y){var me=m>=1.5*I;return Math.round(h/I)+" "+Y+(me?"s":"")}le.exports=function(h,m){m=m||{};var I=typeof h;if("string"===I&&h.length>0)return function he(h){if(!((h=String(h)).length>100)){var m=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(h);if(m){var I=parseFloat(m[1]);switch((m[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*I;case"weeks":case"week":case"w":return I*E;case"days":case"day":case"d":return I*N;case"hours":case"hour":case"hrs":case"hr":case"h":return I*L;case"minutes":case"minute":case"mins":case"min":case"m":return I*k;case"seconds":case"second":case"secs":case"sec":case"s":return I*A;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return I;default:return}}}}(h);if("number"===I&&isFinite(h))return m.long?function K(h){var m=Math.abs(h);return m>=N?q(h,m,N,"day"):m>=L?q(h,m,L,"hour"):m>=k?q(h,m,k,"minute"):m>=A?q(h,m,A,"second"):h+" ms"}(h):function fe(h){var m=Math.abs(h);return m>=N?Math.round(h/N)+"d":m>=L?Math.round(h/L)+"h":m>=k?Math.round(h/k)+"m":m>=A?Math.round(h/A)+"s":h+"ms"}(h);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(h))}}}]);