"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3446],{63446:(at,x,o)=>{o.r(x),o.d(x,{ChatComponent:()=>it});var c=o(10467),t=o(54438),g=o(89417),j=o(88834),G=o(65571),M=o(53719),k=o(99213),E=o(99631),I=o(36815),Q=o(3902),P=o(60177),C=o(59115),R=o(55911),O=o(14823),D=o(99327),F=o(30046),y=o(37064),N=o(52778),h=o(62060),b=o(39434),w=o(345);let X=(()=>{class n{constructor(e){this.el=e,this.did2=!1,this.appProfileImage=t.hFB.required(),this.identity=(0,t.WQX)(y.K),this.profile=(0,t.WQX)(b.p),this.sanitizer=(0,t.WQX)(w.up)}ngAfterViewInit(){var e=this;return(0,c.A)(function*(){if(e.appProfileImage()){const i=(yield e.profile.loadProfile(e.appProfileImage())).avatar;i?(e.el.nativeElement.src=i,e.el.nativeElement.onerror="this.src='/avatar-placeholder.png';this.onerror='';"):e.el.nativeElement.src="/avatar-placeholder.png"}})()}static{this.\u0275fac=function(a){return new(a||n)(t.rXU(t.aKT))}}static{this.\u0275dir=t.FsC({type:n,selectors:[["","appProfileImage",""]],inputs:{did2:"did2",appProfileImage:[1,"appProfileImage"]},standalone:!0})}}return n})(),Y=(()=>{class n{constructor(e){this.el=e,this.did2=!1,this.appProfileName=t.hFB.required(),this.identity=(0,t.WQX)(y.K),this.profile=(0,t.WQX)(b.p),this.sanitizer=(0,t.WQX)(w.up)}ngAfterViewInit(){var e=this;return(0,c.A)(function*(){if(e.appProfileName()){const a=yield e.profile.loadProfile(e.appProfileName());let i=e.appProfileName();a&&a.profile&&a.profile.name&&(i=a.profile.name),e.el.nativeElement.innerText=i}})()}static{this.\u0275fac=function(a){return new(a||n)(t.rXU(t.aKT))}}static{this.\u0275dir=t.FsC({type:n,selectors:[["","appProfileName",""]],inputs:{did2:"did2",appProfileName:[1,"appProfileName"]},standalone:!0})}}return n})();var S=o(42745),T=o(9183),$=o(22312),A=o(76336),_=o(71997);const B=n=>["/app","chat",n],z=n=>["/profile",n],V=n=>({"message-inbound":n}),J=n=>({"panel-background":n});function W(n,p){if(1&n&&(t.j41(0,"a",7)(1,"div"),t.nrm(2,"img",25),t.k0s(),t.j41(3,"div",26)(4,"div",27),t.nrm(5,"div",28),t.j41(6,"div",29),t.EFF(7),t.nI1(8,"date"),t.k0s()(),t.j41(9,"div",30),t.EFF(10),t.k0s()()()),2&n){const e=p.$implicit;t.Y8G("routerLink",t.eq3(8,B,e.did)),t.R7$(2),t.Y8G("appProfileImage",e.did),t.R7$(3),t.Y8G("appProfileName",e.did),t.R7$(2),t.JRh(t.i5U(8,5,e.timestamp,"HH:mm")),t.R7$(3),t.JRh(e.text)}}function U(n,p){if(1&n&&(t.j41(0,"div",9),t.EFF(1),t.k0s()),2&n){const e=t.XpG();t.Y8G("matTooltip",e.selectedProfile().profile.did),t.R7$(),t.JRh(e.selectedProfile().profile.name)}}function L(n,p){if(1&n&&(t.j41(0,"div",9),t.EFF(1),t.k0s()),2&n){const e=t.XpG();t.Y8G("matTooltip",e.selectedProfile().profile.did),t.R7$(),t.JRh(e.selectedProfile().profile.did)}}function K(n,p){1&n&&t.nrm(0,"mat-spinner",12)}function H(n,p){1&n&&(t.j41(0,"mat-icon"),t.EFF(1,"refresh"),t.k0s())}function Z(n,p){if(1&n&&(t.j41(0,"button",14)(1,"mat-icon"),t.EFF(2,"account_circle"),t.k0s(),t.j41(3,"span"),t.EFF(4,"View profile"),t.k0s()()),2&n){const e=t.XpG();t.Y8G("routerLink",t.eq3(1,z,e.selectedChat()))}}function q(n,p){if(1&n&&(t.j41(0,"div",18),t.EFF(1),t.k0s()),2&n){const e=p.$implicit;t.Y8G("matTooltip",e.data.timestamp)("ngClass",t.eq3(3,V,"out"==e.direction)),t.R7$(),t.SpI(" ",e.data.text," ")}}function tt(n,p){1&n&&t.nrm(0,"mat-spinner")}function et(n,p){if(1&n&&(t.j41(0,"div")(1,"strong"),t.EFF(2),t.k0s()(),t.j41(3,"div"),t.EFF(4),t.k0s(),t.nrm(5,"br")(6,"mat-divider")(7,"br"),t.j41(8,"div"),t.EFF(9),t.k0s(),t.j41(10,"div",32),t.EFF(11,"Title"),t.k0s(),t.j41(12,"div"),t.EFF(13),t.k0s(),t.j41(14,"div",32),t.EFF(15,"Bio"),t.k0s(),t.j41(16,"div"),t.EFF(17),t.k0s(),t.j41(18,"div",32),t.EFF(19,"Location"),t.k0s(),t.j41(20,"div",33),t.EFF(21),t.k0s(),t.j41(22,"div",32),t.EFF(23,"Identifier"),t.k0s()),2&n){const e=t.XpG(2);t.R7$(2),t.JRh(e.selectedProfile().profile.name),t.R7$(2),t.JRh(e.selectedProfile().profile.status),t.R7$(5),t.JRh(e.selectedProfile().profile.title),t.R7$(4),t.JRh(e.selectedProfile().profile.bio),t.R7$(4),t.JRh(e.selectedProfile().profile.location),t.R7$(3),t.Y8G("matTooltip",e.selectedProfile().profile.did),t.R7$(),t.JRh(e.selectedProfile().profile.did)}}function nt(n,p){if(1&n){const e=t.RV6();t.j41(0,"div",24)(1,"mat-toolbar")(2,"span"),t.EFF(3,"User Info"),t.k0s(),t.nrm(4,"span",4),t.j41(5,"button",13),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.closeDetails())}),t.j41(6,"mat-icon"),t.EFF(7,"close"),t.k0s()()(),t.j41(8,"div",31),t.DNE(9,et,24,7),t.k0s()()}if(2&n){const e=t.XpG();t.Y8G("ngClass",t.eq3(2,J,e.detailsBig())),t.R7$(9),t.vxM(e.selectedProfile()?9:-1)}}let it=(()=>{class n{constructor(){var e=this;this.viewStyle=(0,t.geq)("card"),this.layout=(0,t.WQX)(I.Y),this.details=(0,t.vPA)(!0),this.detailsBig=(0,t.vPA)(!1),this.identity=(0,t.WQX)(y.K),this.app=(0,t.WQX)(N.d),this.breakpointObserver=(0,t.WQX)(D.QP),this.fullsize=!1,this.route=(0,t.WQX)(F.nX),this.profile=(0,t.WQX)(b.p),this.selectedChat=(0,t.vPA)(null),this.selectedProfile=(0,t.vPA)(null),this.loading=(0,t.vPA)(!1),this.messages=(0,t.vPA)([]),this.message="",this.chats=(0,t.vPA)([]),this.threads=(0,t.vPA)([]),this.route.paramMap.subscribe(i=>{this.layout.disableScrolling(),this.selectedChat.set(i.get("id"))}),(0,t.QZP)((0,c.A)(function*(){e.app.initialized()&&(yield e.load())})),(0,t.QZP)((0,c.A)(function*(){if(e.selectedChat()&&e.app.initialized()){if(e.selectedProfile.set(null),e.messages.set([]),":id"===e.selectedChat()||"home"===e.selectedChat())return;e.loading.set(!0);const i=yield e.profile.loadProfile(e.selectedChat());e.selectedProfile.set(i),yield e.loadMessages(e.selectedChat()),e.loading.set(!1)}}),{allowSignalWrites:!0}),this.breakpointObserver.observe(["(max-width: 1024px)"]).subscribe(i=>{i.matches?(this.details.set(!1),this.detailsBig.set(!0)):this.detailsBig.set(!1)})}ngOnInit(){var e=this;return(0,c.A)(function*(){e.layout.disableScrolling(),e.layout.resetActions(),e.layout.marginOff()})()}ngOnDestroy(){this.layout.enableScrolling()}reloadMessages(){var e=this;return(0,c.A)(function*(){yield e.loadMessages(e.selectedChat())})()}loadMessages(e){var a=this;return(0,c.A)(function*(){a.messages.set([]);const i={recipients:e};var{records:s}=yield a.identity.web5.dwn.records.query({from:a.identity.did,message:{filter:{tags:i,protocol:h.Q.protocol,schema:h.Q.types.message.schema,dataFormat:h.Q.types.message.dataFormats[0]},dateSort:S.U0.CreatedAscending}});if(s)for(const l of s){let d=yield l.data.json(),m={record:l,data:d};l.creator==a.identity.did&&(m.direction="out"),a.messages.update(r=>[...r,m])}})()}load(){var e=this;return(0,c.A)(function*(){var{records:a}=yield e.identity.web5.dwn.records.query({from:e.identity.did,message:{filter:{protocol:h.Q.protocol,schema:h.Q.types.message.schema,dataFormat:h.Q.types.message.dataFormats[0]}}});if(e.chats.set([]),e.threads.set([]),a)for(const r of a){let f=yield r.data.json(),v={record:r,data:f};r.creator==e.identity.did&&(v.direction="out"),e.chats.update(u=>[...u,v])}const i=e.chats().map(r=>r.data.recipient),s=e.chats().map(r=>r.data.sender),l=yield e.loadFriends(),d=Array.from(new Set([...i,...s,...l])),m=e.chats().sort((r,f)=>r.data.timestamp>f.data.timestamp?-1:1);d.map(function(){var r=(0,c.A)(function*(f){const v=m.find(u=>u.data.recipient==f||u.data.sender==f);f!=e.identity.did&&e.threads.update(u=>[...u,{did:f,text:v?.data.text,timestamp:v?.data.timestamp}])});return function(f){return r.apply(this,arguments)}}())})()}loadFriends(){var e=this;return(0,c.A)(function*(){var{records:a}=yield e.identity.web5.dwn.records.query({message:{filter:{schema:$.eE.friendship,dataFormat:$.eE.format}}});let i=[];if(a)for(const s of a){let l=yield s.data.text(),d=A.l6.parseJwt({vcJwt:l}),m=d.issuer;d.issuer==e.identity.did&&(m=A.l6.parseJwt({vcJwt:d.vcDataModel.credentialSubject.vc}).issuer),i.push(m)}return i})()}toggleDetails(){this.details.set(!this.details())}closeDetails(){this.details.set(!1)}submitMessage(){var e=this;return(0,c.A)(function*(){if(e.message.trim()){let a=e.selectedProfile().did;const s={text:e.message,sender:e.identity.did,recipient:a,timestamp:(new Date).toISOString()},l={recipients:[e.identity.did,a]},{record:d}=yield e.identity.web5.dwn.records.write({data:s,message:{tags:l,protocol:h.Q.protocol,protocolPath:"message",schema:h.Q.types.message.schema,recipient:a}});yield d?.send(a),yield d?.send();let m={record:d,data:s,direction:"out"};e.messages.update(r=>[...r,m]),e.message=""}})()}deleteChat(){var e=this;return(0,c.A)(function*(){for(let a of e.messages())yield a.record.delete();e.messages.set([])})()}newChat(){var e=this;return(0,c.A)(function*(){let a=e.selectedProfile().did;const s={text:"Hello, how are you?",sender:e.identity.did,recipient:a,timestamp:(new Date).toISOString()},l={recipients:[e.identity.did,a]},{record:d}=yield e.identity.web5.dwn.records.write({data:s,message:{tags:l,protocol:h.Q.protocol,protocolPath:"message",schema:h.Q.types.message.schema,recipient:a}});let m={record:d,data:s};return e.messages.update(r=>[...r,m]),d})()}static{this.\u0275fac=function(a){return new(a||n)}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["app-chat"]],inputs:{viewStyle:[1,"viewStyle"],fullsize:"fullsize"},outputs:{viewStyle:"viewStyleChange"},standalone:!0,features:[t.aNF],decls:87,vars:17,consts:[["chatMenu","matMenu"],["menu","matMenu"],[1,"chat-container"],[1,"left-panel"],[1,"toolbar-spacer"],["type","search","placeholder","Filter chats",1,"search-input"],[1,"panel-content","panel-content-chats"],["routerLinkActive","router-link-active",1,"chat-link",3,"routerLink"],[1,"middle-panel"],[1,"name-ellipsis",3,"matTooltip"],["mat-icon-button","",3,"matMenuTriggerFor"],["mat-icon-button","",3,"click","disabled"],["diameter","24"],["mat-icon-button","",3,"click"],["mat-menu-item","",3,"routerLink"],["mat-menu-item","",3,"disabled"],["mat-menu-item","",3,"click"],[1,"panel-content","panel-content-messages"],[1,"message",3,"matTooltip","ngClass"],[1,"chat-input"],["mat-icon-button","",1,"chat-action",3,"matMenuTriggerFor"],["subscriptSizing","dynamic",1,"chat-message-input"],["matInput","","placeholder","Message...",3,"ngModelChange","keydown.enter","ngModel"],["mat-icon-button","",1,"chat-action",3,"click"],[1,"right-panel",3,"ngClass"],[1,"chat-icon",3,"appProfileImage"],[1,"chat-details"],[1,"chat-info"],[1,"chat-info-name",3,"appProfileName"],[1,"chat-time"],[1,"chat-text"],[1,"panel-content","profile-details"],[1,"dimmed","profile-info-label"],[1,"ellipsis",3,"matTooltip"]],template:function(a,i){if(1&a){const s=t.RV6();t.j41(0,"div",2)(1,"div",3)(2,"mat-toolbar")(3,"span",4),t.nrm(4,"input",5),t.k0s()(),t.j41(5,"div",6),t.Z7z(6,W,11,10,"a",7,t.fX1),t.k0s()(),t.j41(8,"div",8)(9,"mat-toolbar"),t.DNE(10,U,2,2,"div",9)(11,L,2,2,"div",9),t.nrm(12,"span",4),t.j41(13,"button",10)(14,"mat-icon"),t.EFF(15,"more_vert"),t.k0s()(),t.j41(16,"button",11),t.bIt("click",function(){return t.eBV(s),t.Njj(i.reloadMessages())}),t.DNE(17,K,1,0,"mat-spinner",12)(18,H,2,0,"mat-icon"),t.k0s(),t.j41(19,"button",13),t.bIt("click",function(){return t.eBV(s),t.Njj(i.toggleDetails())}),t.j41(20,"mat-icon"),t.EFF(21,"view_sidebar"),t.k0s()()(),t.j41(22,"mat-menu",null,0),t.DNE(24,Z,5,3,"button",14),t.j41(25,"button",15)(26,"mat-icon"),t.EFF(27,"done"),t.k0s(),t.j41(28,"span"),t.EFF(29,"Mark as unread"),t.k0s()(),t.nrm(30,"mat-divider"),t.j41(31,"button",15)(32,"mat-icon"),t.EFF(33,"block"),t.k0s(),t.j41(34,"span"),t.EFF(35,"Block"),t.k0s()(),t.j41(36,"button",15)(37,"mat-icon"),t.EFF(38,"archive"),t.k0s(),t.j41(39,"span"),t.EFF(40,"Archive chat"),t.k0s()(),t.j41(41,"button",16),t.bIt("click",function(){return t.eBV(s),t.Njj(i.deleteChat())}),t.j41(42,"mat-icon"),t.EFF(43,"delete"),t.k0s(),t.j41(44,"span"),t.EFF(45,"Delete chat"),t.k0s()()(),t.j41(46,"div",17),t.Z7z(47,q,2,5,"div",18,t.fX1),t.DNE(49,tt,1,0,"mat-spinner"),t.k0s(),t.j41(50,"div",19)(51,"button",20)(52,"mat-icon"),t.EFF(53,"add_circle"),t.k0s()(),t.j41(54,"mat-menu",null,1)(56,"button",15)(57,"mat-icon"),t.EFF(58,"attach_money"),t.k0s(),t.j41(59,"span"),t.EFF(60,"Send money"),t.k0s()(),t.j41(61,"button",15)(62,"mat-icon"),t.EFF(63,"video_camera_back"),t.k0s(),t.j41(64,"span"),t.EFF(65,"Capture video"),t.k0s()(),t.j41(66,"button",15)(67,"mat-icon"),t.EFF(68,"photo_camera_front"),t.k0s(),t.j41(69,"span"),t.EFF(70,"Capture photo"),t.k0s()(),t.j41(71,"button",15)(72,"mat-icon"),t.EFF(73,"attachment"),t.k0s(),t.j41(74,"span"),t.EFF(75,"Attach a file"),t.k0s()(),t.j41(76,"button",15)(77,"mat-icon"),t.EFF(78,"add_a_photo"),t.k0s(),t.j41(79,"span"),t.EFF(80,"Attach a photo"),t.k0s()()(),t.j41(81,"mat-form-field",21)(82,"input",22),t.mxI("ngModelChange",function(d){return t.eBV(s),t.DH7(i.message,d)||(i.message=d),t.Njj(d)}),t.bIt("keydown.enter",function(){return t.eBV(s),t.Njj(i.submitMessage())}),t.k0s()(),t.j41(83,"button",23),t.bIt("click",function(){return t.eBV(s),t.Njj(i.submitMessage())}),t.j41(84,"mat-icon"),t.EFF(85,"send"),t.k0s()()()(),t.DNE(86,nt,10,4,"div",24),t.k0s()}if(2&a){const s=t.sdS(23),l=t.sdS(55);t.R7$(6),t.Dyx(i.threads()),t.R7$(4),t.vxM(i.selectedProfile()&&i.selectedProfile().profile.name?10:i.selectedProfile()?11:-1),t.R7$(3),t.Y8G("matMenuTriggerFor",s),t.R7$(3),t.Y8G("disabled",i.loading()),t.R7$(),t.vxM(i.loading()?17:18),t.R7$(7),t.vxM(i.selectedProfile()?24:-1),t.R7$(),t.Y8G("disabled",!0),t.R7$(6),t.Y8G("disabled",!0),t.R7$(5),t.Y8G("disabled",!0),t.R7$(11),t.Dyx(i.messages()),t.R7$(2),t.vxM(i.loading()?49:-1),t.R7$(2),t.Y8G("matMenuTriggerFor",l),t.R7$(5),t.Y8G("disabled",!0),t.R7$(5),t.Y8G("disabled",!0),t.R7$(5),t.Y8G("disabled",!0),t.R7$(5),t.Y8G("disabled",!0),t.R7$(5),t.Y8G("disabled",!0),t.R7$(6),t.R50("ngModel",i.message),t.R7$(4),t.vxM(i.details()?86:-1)}},dependencies:[F.iI,F.Wk,F.wQ,P.MD,P.YU,P.vh,O.uc,O.oV,R.s5,R.KQ,g.YN,g.me,g.BC,g.vS,j.Hl,j.iY,k.m_,k.An,E.fS,E.fg,M.rl,Q.Fg,_.q,C.Cn,C.kk,C.fb,C.Cp,G.Vg,M.RG,g.X1,X,Y,T.D6,T.LG],styles:[".chat-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;height:calc(100vh - 80px)}.left-panel[_ngcontent-%COMP%], .right-panel[_ngcontent-%COMP%], .chat-content[_ngcontent-%COMP%]{box-sizing:border-box}.panel-content[_ngcontent-%COMP%]{box-sizing:border-box;padding:1em;overflow-x:hidden;overflow-y:auto;height:calc(100% - 64px)}.panel-content-messages[_ngcontent-%COMP%]{height:calc(100% - 128px);display:flex;flex-direction:column}.panel-content-chats[_ngcontent-%COMP%]{height:calc(100% - 128px);padding:0}.chat-action[_ngcontent-%COMP%]{vertical-align:middle!important}.left-panel[_ngcontent-%COMP%]{flex:1;max-width:240px}.middle-panel[_ngcontent-%COMP%]{flex:2}.right-panel[_ngcontent-%COMP%]{flex:none;width:200px}.chat-icon[_ngcontent-%COMP%]{border-radius:50%;max-height:48px;border:2px solid transparent}.chat-link[_ngcontent-%COMP%]{display:flex;align-items:stretch;text-decoration:none;align-items:center;cursor:pointer;border-radius:0 0 20px}.chat-item[_ngcontent-%COMP%]{text-align:right}.chat-details[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:first-child{padding-top:6px;height:24px}.chat-details[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:nth-child(2){height:24px}.chat-info-name[_ngcontent-%COMP%]{flex:1 1 auto}.chat-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%;overflow:hidden;padding-left:.2em}.chat-info[_ngcontent-%COMP%]{display:flex}.chat-text2[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.chat-text[_ngcontent-%COMP%], .chat-info-name[_ngcontent-%COMP%]{display:block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;max-width:100%}.chat-text[_ngcontent-%COMP%]{font-size:.8em}.chat-time[_ngcontent-%COMP%]{padding-right:.2em}.router-link-active[_ngcontent-%COMP%]{background-color:var(--mat-option-selected-state-layer-color)}@media (max-width: 1024px){.right-panel[_ngcontent-%COMP%]{width:100%;position:absolute;inset:0;flex:none;z-index:1000}}@media (max-width: 768px){.left-panel[_ngcontent-%COMP%]{flex:none;width:64px}.left-panel[_ngcontent-%COMP%]   .panel-content[_ngcontent-%COMP%]{padding:0}.chat-details[_ngcontent-%COMP%]{display:none}}.chat-input[_ngcontent-%COMP%]{height:64px;max-height:64px;min-height:64px;display:flex;align-items:center}.chat-message-input[_ngcontent-%COMP%]{flex-grow:2}.profile-details[_ngcontent-%COMP%]{font-size:.9em}.profile-info-label[_ngcontent-%COMP%]{margin-bottom:1em}.message[_ngcontent-%COMP%]{align-self:flex-start;background-color:color-mix(in srgb,var(--mat-option-selected-state-layer-color),transparent 40%);border-radius:1em 1em 1em 0;padding:.4em 1em;margin-bottom:1em}.message-inbound[_ngcontent-%COMP%]{align-self:flex-end;border-radius:1em 1em 0;background-color:color-mix(in srgb,var(--mat-full-pseudo-checkbox-selected-icon-color),transparent 90%)}@media (max-width: 400px){.name-ellipsis[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block;width:60px}}"]})}}return n})()}}]);