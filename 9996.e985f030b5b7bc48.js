"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9996],{58249:(L,x,o)=>{o.d(x,{K:()=>I});var y=o(10467),t=o(93953),T=o(34635),F=o(50296),A=o(69371),c=o(71943),v=o(22312),M=o(81317),D=o(68530);let I=(()=>{class g{constructor(){this.requests=(0,t.vPA)([]),this.friends=(0,t.vPA)([]),this.identity=(0,t.WQX)(T.K),this.connection=(0,t.WQX)(M.K),this.app=(0,t.WQX)(F.d)}createRequest(r){var s=this;return(0,y.A)(function*(){const l=yield c.l6.create({type:"FriendshipCredential",issuer:s.identity.did,subject:r,data:null});console.log("VC:",l);const p=yield s.identity.activeAgent().identity.get({didUri:s.identity.did}),_=yield l.sign({did:p.did});return console.log("VC JWT:",_),{record:(yield s.connection.request(r,{app:"friends",title:"I want to be your friend.",vc:_},M.X.Friend)).record}})()}accept(r){var s=this;return(0,y.A)(function*(){const l=r.data.vc;if(!l)throw new Error("The incoming VC is missing.");if(console.log("signedVcJwt:",l),!l)return;try{yield c.l6.verify({vcJwt:l})}catch(W){return void console.error("Error verifying VC:",W)}const p=c.l6.parseJwt({vcJwt:l}),_=p.issuer;if(p.issuer!=r.record.author)return void console.error("VC issuer is different than data record author");console.log("Friend request validated");const E=yield c.l6.create({type:v.eE.friendship,issuer:s.identity.did,subject:_,data:{vc:l}});console.log("TWO WAY VC:",E);const i=yield s.identity.activeAgent().identity.get({didUri:s.identity.did}),f=yield E.sign({did:i.did});console.log("TWO WAY VC JWT:",f);const{record:a}=yield s.identity.web5.dwn.records.create({data:f,message:{schema:v.eE.friendship,dataFormat:v.eE.format,published:!1}});console.log("TWO WAY VC RECORD:",a),a.send(s.identity.did);const d={vc:f,app:"friends"},m={type:M.X.Credential},{status:R,record:P}=yield s.identity.web5.dwn.records.create({data:d,store:!1,message:{tags:m,recipient:_,protocol:D.Q.protocol,protocolPath:"request",schema:D.Q.types.request.schema,dataFormat:D.Q.types.request.dataFormats[0]}});console.log("Request create status:",R);const{status:O}=yield P.send(_);return s.app.openSnackBar(202!==O.code?`Friend request failed.Code: ${O.code}, Details: ${O.detail}.`:"Friend request accepted"),{record:P,data:d,id:P.id}})()}reject(r){var s=this;return(0,y.A)(function*(){console.log("Rejecting request:",r);const l=r.record.recipient==s.identity.did?r.record.author:r.record.recipient;console.log("Target DID:",l),console.log("this.identity.did:",s.identity.did),console.log("entry.record.recipient:",r.record.recipient),console.log("entry.record.author:",r.record.author);const{status:p}=yield r.record.delete(),{status:_}=yield r.record.send(l);console.log("Delete status:",p),console.log("deleteSendStatus:",_),s.requests.update(E=>E.filter(i=>i!==r))})()}processFriends(){var r=this;return(0,y.A)(function*(){var{records:s}=yield r.identity.web5.dwn.records.query({message:{filter:{protocol:v.iU.uri,schema:A.Q.types.credential.schema,dataFormat:A.Q.types.credential.dataFormats[0]}}});console.log("VC Records:",s);for(const l of s){console.log("Record:",l);const p=yield l.data.json();console.log("JSON:",p);try{yield c.l6.verify({vcJwt:p.vc})}catch(f){console.error("Error verifying VC:",f),console.log("THIS REQUEST SHOULD BE DELETED FROM DWN",l.id)}const _=c.l6.parseJwt({vcJwt:p.vc});console.log("PARSED INVCOMING VC:",_),console.log("vc.issuer === this.identity.did:",_.issuer===r.identity.did);const{record:E}=yield r.identity.web5.dwn.records.create({data:p.vc,message:{schema:v.eE.friendship,dataFormat:v.eE.format,published:!1}});console.log("TWO WAY VC RECORD:",E);const{status:i}=yield E.send(r.identity.did);console.log("Record sent:",i,E),yield l?.delete()}})()}loadFriends(){var r=this;return(0,y.A)(function*(){var{records:s}=yield r.identity.web5.dwn.records.query({message:{filter:{schema:v.eE.friendship,dataFormat:v.eE.format}}});if(console.log("Friend VCs:"),console.log(s),r.friends.set([]),s)for(const _ of s){let E=yield _.data.text(),i=c.l6.parseJwt({vcJwt:E}),f=i.issuer;i.issuer==r.identity.did&&(f=c.l6.parseJwt({vcJwt:i.vcDataModel.credentialSubject.vc}).issuer);let a={record:_,data:{did:f}};r.friends.update(d=>[...d,a]),console.log("All friends:",r.friends())}})()}static#t=this.\u0275fac=function(s){return new(s||g)};static#e=this.\u0275prov=t.jDH({token:g,factory:g.\u0275fac,providedIn:"root"})}return g})()},49996:(L,x,o)=>{o.d(x,{$:()=>K});var y=o(10467),t=o(93953),T=o(81317),F=o(50296),A=o(60177),c=o(25596),v=o(88834),M=o(99213),D=o(30046),I=o(98703),g=o(60385),B=o(34635),r=o(58249);function s(n,C){1&n&&t.EFF(0," people ")}function l(n,C){1&n&&t.EFF(0," connect_without_contact ")}function p(n,C){1&n&&t.EFF(0," Friend Request ")}function _(n,C){1&n&&t.EFF(0," Connect Request ")}function E(n,C){1&n&&t.EFF(0," This user wants to be your friend, do you accept? This will give them access to send you sharing requets, such as shared Tasks, collabrative apps and more. ")}function i(n,C){if(1&n&&(t.EFF(0," This is a data sharing request. Do you want to accept? "),t.j41(1,"p"),t.EFF(2," App: "),t.j41(3,"span",2),t.EFF(4),t.k0s(),t.nrm(5,"br"),t.EFF(6),t.k0s()),2&n){const e=t.XpG(2);t.R7$(4),t.JRh(e.entry.data.app),t.R7$(2),t.SpI("Title: ",e.entry.data.title," ")}}function f(n,C){1&n&&t.EFF(0," Shared Credential. This will be automatically processed. ")}function a(n,C){1&n&&t.nrm(0,"br")}function d(n,C){if(1&n&&t.nrm(0,"app-profile-header",4),2&n){const e=t.XpG(2);t.Y8G("did",e.entry.record.recipient)}}function m(n,C){if(1&n&&t.nrm(0,"app-profile-header",4),2&n){const e=t.XpG(2);t.Y8G("did",e.entry.record.author)}}function R(n,C){}function P(n,C){if(1&n){const e=t.RV6();t.j41(0,"button",5),t.EFF(1,"PENDING"),t.k0s(),t.EFF(2,"\xa0 "),t.j41(3,"button",6),t.bIt("click",function(){t.eBV(e);const u=t.XpG(3);return t.Njj(u.reject(u.entry))}),t.EFF(4,"CANCEL"),t.k0s()}if(2&n){const e=t.XpG(3);t.Y8G("disabled",!0),t.R7$(3),t.Y8G("disabled",e.entry.loading)}}function O(n,C){if(1&n){const e=t.RV6();t.j41(0,"button",7),t.bIt("click",function(){t.eBV(e);const u=t.XpG(3);return t.Njj(u.accept(u.entry))}),t.EFF(1,"ACCEPT"),t.k0s(),t.EFF(2,"\xa0 "),t.j41(3,"button",6),t.bIt("click",function(){t.eBV(e);const u=t.XpG(3);return t.Njj(u.reject(u.entry))}),t.EFF(4,"DELETE"),t.k0s(),t.EFF(5,"\xa0 "),t.j41(6,"button",6),t.bIt("click",function(){t.eBV(e);const u=t.XpG(3);return t.Njj(u.block(u.entry))}),t.EFF(7,"BLOCK"),t.k0s()}if(2&n){const e=t.XpG(3);t.Y8G("disabled",e.entry.loading),t.R7$(3),t.Y8G("disabled",e.entry.loading),t.R7$(3),t.Y8G("disabled",e.entry.loading)}}function W(n,C){if(1&n&&(t.j41(0,"mat-card-actions"),t.DNE(1,P,5,2)(2,O,8,3),t.k0s()),2&n){const e=t.XpG(2);t.R7$(),t.vxM("out"==e.entry.direction?1:2)}}function b(n,C){if(1&n&&(t.j41(0,"mat-card",0)(1,"mat-card-header")(2,"mat-icon",1),t.DNE(3,s,1,0)(4,l,1,0),t.k0s(),t.j41(5,"mat-card-title"),t.DNE(6,p,1,0)(7,_,1,0),t.k0s(),t.j41(8,"mat-card-subtitle"),t.EFF(9,"Type: "),t.j41(10,"span",2),t.EFF(11),t.k0s(),t.EFF(12),t.nI1(13,"ago"),t.k0s()(),t.j41(14,"mat-card-content")(15,"div",3),t.DNE(16,E,1,0)(17,i,7,2,"p")(18,f,1,0)(19,a,1,0,"br"),t.k0s(),t.DNE(20,d,1,1,"app-profile-header",4)(21,m,1,1,"app-profile-header",4),t.k0s(),t.DNE(22,R,0,0)(23,W,3,1,"mat-card-actions"),t.k0s()),2&n){const e=t.XpG();t.R7$(3),t.vxM("friend"==e.entry.record.tags.type?3:4),t.R7$(3),t.vxM("friend"==e.entry.record.tags.type?6:7),t.R7$(5),t.JRh(e.entry.record.tags.type),t.R7$(),t.SpI(" (",t.bMT(13,7,e.entry.record.dateCreated),")"),t.R7$(4),t.vxM("friend"==e.entry.record.tags.type?16:"data"==e.entry.record.tags.type?17:"credential"==e.entry.record.tags.type?18:19),t.R7$(4),t.vxM("out"==e.entry.direction?20:21),t.R7$(2),t.vxM("credential"==e.entry.record.tags.type?22:23)}}let K=(()=>{class n{constructor(){this.entry=void 0,this.connection=(0,t.WQX)(T.K),this.friend=(0,t.WQX)(r.K),this.identity=(0,t.WQX)(B.K),this.app=(0,t.WQX)(F.d)}deleteConnection(e){e.loading=!0,this.connection.deleteConnection(e)}accept(e){var h=this;return(0,y.A)(function*(){e.loading=!0,console.log("Accepting connection request",e),e.data.did=e.record.author;const u=e.record.tags.type;if(u==T.X.Friend){const j=yield h.friend.accept(e);e.data.vc=j?.data.vc,e.data.recordId=j?.id}yield h.connection.create(e,u),yield h.connection.deleteRequest(e)})()}block(e){var h=this;return(0,y.A)(function*(){e.loading=!0,console.log("Blocking user",e);const u=yield h.connection.block(e.record.author);console.log("Block result: ",u)})()}reject(e){e.loading=!0,this.connection.deleteRequest(e)}static#t=this.\u0275fac=function(h){return new(h||n)};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["app-request"]],inputs:{entry:"entry"},standalone:!0,features:[t.aNF],decls:1,vars:1,consts:[["appearance","outlined",1,"card-notification"],["inline","true","mat-card-avatar","",1,"card-icon"],[1,"capitalize"],[1,"notification-description"],[3,"did"],["mat-flat-button","",3,"disabled"],["mat-button","",3,"click","disabled"],["mat-flat-button","",3,"click","disabled"]],template:function(h,u){1&h&&t.DNE(0,b,24,9,"mat-card",0),2&h&&t.vxM(u.entry?0:-1)},dependencies:[g.w,I.g,A.MD,c.Hu,c.RN,c.YY,c.QG,c.m2,c.MM,c.Lc,c.dh,v.Hl,v.$z,M.m_,M.An,D.iI],styles:[".card-icon[_ngcontent-%COMP%]{font-size:3em}.card-notification[_ngcontent-%COMP%]{margin-bottom:1em}.notifications-title[_ngcontent-%COMP%]{display:flex;width:100%}.notifications-card[_ngcontent-%COMP%]{max-width:600px;width:100%}.card-notification[_ngcontent-%COMP%]   mat-card-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}.notification-description[_ngcontent-%COMP%]{margin-bottom:1em}"]})}return n})()},60385:(L,x,o)=>{o.d(x,{w:()=>E});var y=o(10467),t=o(93953),T=o(34635),F=o(25596),A=o(39434),c=o(345),v=o(78013),M=o(33347),D=o(14823),I=o(30046);const g=i=>["/profile",i];function B(i,f){if(1&i&&(t.nrm(0,"img",0),t.nI1(1,"safeResourceUrl")),2&i){let a;const d=t.XpG();t.Y8G("routerLink",t.eq3(4,g,null==(a=d.data().profile)?null:a.did))("src",t.bMT(1,2,d.data().avatar),t.B4B)}}function r(i,f){if(1&i&&t.nrm(0,"img",1),2&i){let a;const d=t.XpG();t.Y8G("routerLink",t.eq3(2,g,null==(a=d.data().profile)?null:a.did))("src","/avatar-placeholder.png",t.B4B)}}function s(i,f){if(1&i&&t.EFF(0),2&i){let a;const d=t.XpG(2);t.SpI(" (",null==(a=d.data().profile)?null:a.title,") ")}}function l(i,f){if(1&i&&(t.j41(0,"a",3),t.EFF(1),t.DNE(2,s,1,1),t.k0s()),2&i){let a,d,m;const R=t.XpG();t.Y8G("routerLink",t.eq3(3,g,null==(a=R.data().profile)?null:a.did)),t.R7$(),t.SpI("",null==(d=R.data().profile)?null:d.name," "),t.R7$(),t.vxM(null!=(m=R.data().profile)&&m.title?2:-1)}}function p(i,f){if(1&i&&t.EFF(0),2&i){let a;const d=t.XpG(2);t.SpI(" (",null==(a=d.data().profile)?null:a.title,") ")}}function _(i,f){if(1&i&&(t.j41(0,"em")(1,"a",3),t.EFF(2,"No name set "),t.DNE(3,p,1,1),t.k0s()()),2&i){let a,d;const m=t.XpG();t.R7$(),t.Y8G("routerLink",t.eq3(2,g,null==(a=m.data().profile)?null:a.did)),t.R7$(2),t.vxM(null!=(d=m.data().profile)&&d.title?3:-1)}}let E=(()=>{class i{constructor(){this.identity=(0,t.WQX)(T.K),this.profile=(0,t.WQX)(A.p),this.sanitizer=(0,t.WQX)(c.up),this.did=t.hFB.required(),this.data=(0,t.vPA)({})}ngAfterViewInit(){var a=this;return(0,y.A)(function*(){if(a.did()){const d=yield a.profile.loadProfile(a.did());console.log(d),a.data.set(d)}})()}static#t=this.\u0275fac=function(d){return new(d||i)};static#e=this.\u0275cmp=t.VBU({type:i,selectors:[["app-profile-header"]],inputs:{did:[1,"did"]},standalone:!0,features:[t.aNF],decls:10,vars:9,consts:[["mat-card-avatar","","onerror","this.src='/avatar-placeholder.png';this.onerror='';",1,"profile-thumbnail",3,"routerLink","src"],["mat-card-avatar","",1,"profile-thumbnail",3,"routerLink","src"],[1,"profile-header-title"],[3,"routerLink"],[1,"profile-header-subtitle"],[3,"routerLink","matTooltip"]],template:function(d,m){if(1&d&&(t.DNE(0,B,2,6,"img",0)(1,r,1,4,"img",1),t.j41(2,"div")(3,"div",2),t.DNE(4,l,3,5,"a",3)(5,_,4,4,"em"),t.k0s(),t.j41(6,"div",4)(7,"a",5),t.EFF(8),t.nI1(9,"did"),t.k0s()()()),2&d){let R,P,O,W;t.vxM(m.data().avatar?0:1),t.R7$(4),t.vxM(null!=(R=m.data().profile)&&R.name?4:5),t.R7$(3),t.Y8G("routerLink",t.eq3(7,g,null==(P=m.data().profile)?null:P.did))("matTooltip",null==(O=m.data().profile)?null:O.did),t.R7$(),t.JRh(t.bMT(9,5,null==(W=m.data().profile)?null:W.did))}},dependencies:[I.iI,I.Wk,D.uc,D.oV,F.Hu,F.QG,v.d,M.k],styles:[".profile-thumbnail[_ngcontent-%COMP%]{cursor:pointer;border-radius:50%;margin-right:1em}a[_ngcontent-%COMP%]{text-decoration:none}a[_ngcontent-%COMP%]:hover{text-decoration:underline}[_nghost-%COMP%]{display:flex}.profile-header-title[_ngcontent-%COMP%]{font-size:1.4em}.profile-header-subtitle[_ngcontent-%COMP%]{font-size:1em}"]})}return i})()}}]);