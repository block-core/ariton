"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1733],{31733:(Q,T,r)=>{r.r(T),r.d(T,{TasksComponent:()=>V});var d=r(10467),p=r(81391),t=r(93953),j=r(36815),c=r(52002),P=r(31439),O=r(34635),R=r(62590),f=r(60177),k=r(88834),E=r(18498),v=r(96850),F=r(99213),D=r(82765),m=r(89417),C=r(59115),M=r(71997),b=r(53719),y=r(99631),I=r(9183);const L=a=>({strikeout:a});function A(a,l){if(1&a){const o=t.RV6();t.j41(0,"mat-form-field",13)(1,"input",14),t.mxI("ngModelChange",function(n){t.eBV(o);const i=t.XpG().$implicit;return t.DH7(i.data.title,n)||(i.data.title=n),t.Njj(n)}),t.bIt("keydown.enter",function(){t.eBV(o);const n=t.XpG().$implicit,i=t.XpG();return t.Njj(i.saveList(n))}),t.k0s()(),t.j41(2,"button",15),t.bIt("click",function(){t.eBV(o);const n=t.XpG().$implicit,i=t.XpG();return t.Njj(i.saveList(n))}),t.j41(3,"mat-icon"),t.EFF(4,"save"),t.k0s()()}if(2&a){const o=t.XpG().$implicit;t.R7$(),t.R50("ngModel",o.data.title)}}function G(a,l){if(1&a){const o=t.RV6();t.EFF(0),t.j41(1,"button",15),t.bIt("click",function(){t.eBV(o);const n=t.XpG().$implicit,i=t.XpG();return t.Njj(i.editList(n))}),t.j41(2,"mat-icon"),t.EFF(3,"edit"),t.k0s()()}if(2&a){const o=t.XpG().$implicit;t.SpI(" ",o.data.title," ")}}function B(a,l){1&a&&t.nrm(0,"mat-spinner",9)}function X(a,l){if(1&a){const o=t.RV6();t.j41(0,"mat-form-field",13)(1,"input",14),t.mxI("ngModelChange",function(n){t.eBV(o);const i=t.XpG().$implicit;return t.DH7(i.data.description,n)||(i.data.description=n),t.Njj(n)}),t.bIt("keydown.enter",function(){t.eBV(o);const n=t.XpG().$implicit,i=t.XpG(2);return t.Njj(i.saveTodo(n))}),t.k0s()(),t.j41(2,"button",15),t.bIt("click",function(){t.eBV(o);const n=t.XpG().$implicit,i=t.XpG(2);return t.Njj(i.saveTodo(n))}),t.j41(3,"mat-icon"),t.EFF(4,"save"),t.k0s()()}if(2&a){const o=t.XpG().$implicit;t.R7$(),t.R50("ngModel",o.data.description)}}function W(a,l){if(1&a&&(t.j41(0,"span",17),t.EFF(1),t.k0s()),2&a){const o=t.XpG().$implicit;t.Y8G("ngClass",t.eq3(2,L,o.data.completed)),t.R7$(),t.JRh(o.data.description)}}function $(a,l){1&a&&t.nrm(0,"mat-spinner",9)}function N(a,l){if(1&a){const o=t.RV6();t.j41(0,"mat-checkbox",20),t.mxI("ngModelChange",function(n){t.eBV(o);const i=t.XpG().$implicit;return t.DH7(i.data.completed,n)||(i.data.completed=n),t.Njj(n)}),t.k0s()}if(2&a){const o=t.XpG().$implicit;t.R50("ngModel",o.data.completed)}}function U(a,l){if(1&a){const o=t.RV6();t.j41(0,"div",16),t.DNE(1,X,5,1)(2,W,2,4,"span",17),t.nrm(3,"div",18),t.DNE(4,$,1,0,"mat-spinner",9)(5,N,1,1,"mat-checkbox",19),t.j41(6,"button",8)(7,"mat-icon"),t.EFF(8,"more_vert"),t.k0s()()(),t.j41(9,"mat-menu",null,1)(11,"button",11),t.bIt("click",function(){const n=t.eBV(o).$implicit,i=t.XpG(2);return t.Njj(i.editTodo(n))}),t.j41(12,"mat-icon"),t.EFF(13,"edit"),t.k0s(),t.j41(14,"span"),t.EFF(15,"Edit"),t.k0s()(),t.nrm(16,"mat-divider"),t.j41(17,"button",11),t.bIt("click",function(){const n=t.eBV(o).$implicit,i=t.XpG().$implicit,s=t.XpG();return t.Njj(s.deleteTodo(n.record,i))}),t.j41(18,"mat-icon"),t.EFF(19,"delete"),t.k0s(),t.j41(20,"span"),t.EFF(21,"Delete"),t.k0s()()()}if(2&a){const o=l.$implicit,e=t.sdS(10);t.Y8G("cdkDragData",o),t.R7$(),t.vxM(o.editing?1:2),t.R7$(3),t.vxM(o.loading?4:5),t.R7$(2),t.Y8G("matMenuTriggerFor",e)}}function K(a,l){if(1&a){const o=t.RV6();t.j41(0,"div",4)(1,"h2",5),t.DNE(2,A,5,1)(3,G,4,1,"button",6),t.j41(4,"button",7),t.bIt("click",function(){const n=t.eBV(o).$implicit,i=t.XpG();return t.Njj(i.addTodo(n))}),t.j41(5,"mat-icon"),t.EFF(6,"add_box"),t.k0s()(),t.j41(7,"button",8)(8,"mat-icon"),t.EFF(9,"more_vert"),t.k0s()(),t.DNE(10,B,1,0,"mat-spinner",9),t.j41(11,"mat-menu",null,0)(13,"button",10)(14,"mat-icon"),t.EFF(15,"person_add_alt"),t.k0s(),t.j41(16,"span"),t.EFF(17,"Collaborator"),t.k0s()(),t.nrm(18,"mat-divider"),t.j41(19,"button",11),t.bIt("click",function(){const n=t.eBV(o).$implicit,i=t.XpG();return t.Njj(i.deleteList(n))}),t.j41(20,"mat-icon"),t.EFF(21,"delete"),t.k0s(),t.j41(22,"span"),t.EFF(23,"Delete"),t.k0s()()()(),t.j41(24,"div",12),t.bIt("cdkDropListDropped",function(n){t.eBV(o);const i=t.XpG();return t.Njj(i.drop(n))}),t.Z7z(25,U,22,4,null,null,t.fX1),t.k0s()()}if(2&a){const o=l.$implicit,e=t.sdS(12);t.R7$(2),t.vxM(o.editing?2:3),t.R7$(5),t.Y8G("matMenuTriggerFor",e),t.R7$(3),t.vxM(o.loading?10:-1),t.R7$(3),t.Y8G("disabled",!0),t.R7$(11),t.Y8G("cdkDropListData",o),t.R7$(),t.Dyx(o.todos)}}let V=(()=>{class a{constructor(){var o=this;this.todo=["Get to work","Pick up groceries","Go home","Fall asleep"],this.done=["Get up","Brush teeth","Take a shower","Check e-mail","Walk dog"],this.layout=(0,t.WQX)(j.Y),this.list=[],this.app=(0,t.WQX)(P.d),this.identity=(0,t.WQX)(O.K),this.route=(0,t.WQX)(E.nX),this.selectedList=(0,t.vPA)(null),this.selectedRecord=(0,t.vPA)(null),this.changeRef=(0,t.WQX)(t.gRc),this.layout.marginOn(),this.layout.resetActions(),(0,t.QZP)((0,d.A)(function*(){o.app.initialized()&&(yield o.load())}),{allowSignalWrites:!0}),this.route.paramMap.subscribe(e=>{const n=e.get("id");this.selectedList.set(n&&":id"!=n?e.get("id"):null)})}getList(o){var e=this;return(0,d.A)(function*(){console.log("GET TODO FOR LIST:",o);const{records:n}=yield e.identity.web5.dwn.records.query({message:{filter:{parentId:o}}});let i=[];for(let s of n){const _=yield e.getTodoEntryFromRecord(s);i.push(_)}return i=i.sort((s,_)=>s.data.index-_.data.index),i})()}getTodoEntryFromRecord(o){return(0,d.A)(function*(){const e=yield o.data.json();return{record:o,data:e,id:o.id}})()}load(){var o=this;return(0,d.A)(function*(){o.list=[];const{records:e}=yield o.identity.web5.dwn.records.query({message:{filter:{protocol:c.Q.protocol,schema:c.Q.types.list.schema},dateSort:R.U0.CreatedAscending}});console.log("Saved records",e);for(let n of e){const i=yield n.data.json();let s={record:n,data:i,id:n.id};s.todos=yield o.getList(s.id),o.list.push(s)}})()}editList(o){o.editing=!0}saveList(o){return(0,d.A)(function*(){o.editing=!1;const{status:e}=yield o.record.update({data:o.data});console.log("Update status:",e)})()}editTodo(o){o.editing=!0}saveTodo(o){return(0,d.A)(function*(){o.editing=!1;const{status:e}=yield o.record.update({data:o.data});console.log("Update status:",e)})()}deleteList(o){var e=this;return(0,d.A)(function*(){yield o.record.delete({prune:!0}),e.list=e.list.filter(n=>n.id!==o.id)})()}deleteTodo(o,e){return(0,d.A)(function*(){yield o.delete(),e.todos=e.todos.filter(n=>n.id!==o.id)})()}initializeIndices(o){o.forEach((e,n)=>{e.index=n+1})}calculateNewIndex(o,e){return(o+e)/2}addTodo(o){var e=this;return(0,d.A)(function*(){o.todos||(o.todos=[]);const n={completed:!1,description:"New todo...",author:e.identity.did,parentId:o.id,index:o.todos.length+1},{record:i}=yield e.identity.web5.dwn.records.create({data:n,message:{protocol:c.Q.protocol,protocolPath:"list/todo",schema:c.Q.types.todo.schema,dataFormat:c.Q.types.todo.dataFormats[0],parentContextId:n.parentId}}),u=(yield i.data.json(),yield e.getTodoEntryFromRecord(i));o.todos.push(u),console.log(o),e.changeRef.markForCheck()})()}newList(){var o=this;return(0,d.A)(function*(){const e="did:dht:bi3bzoke6rq6fbkojpo5ebtg45eqx1owqrb4esex8t9nz14ugnao",n={type:"list",title:"New list",description:"What to do?",author:o.identity.did,recipient:e},{record:i}=yield o.identity.web5.dwn.records.create({data:n,message:{protocol:c.Q.protocol,protocolPath:"list",schema:c.Q.types.list.schema,dataFormat:c.Q.types.list.dataFormats[0],recipient:e}}),s=yield i.data.json();o.list.push({record:i,data:s,id:i.id});const{status:u}=yield i.send(e);console.log("Send status:",u)})()}drop(o){var e=this;return(0,d.A)(function*(){console.log("DROP:",o);const n=o.item.data;n.loading=!0;const i=o.container.data,s=i.todos,u=o.previousContainer.data.todos;if(o.previousContainer===o.container){(0,p.HD)(s,o.previousIndex,o.currentIndex);const g=o.currentIndex>0?s[o.currentIndex-1].data.index:0,h=o.currentIndex<s.length-1?s[o.currentIndex+1].data.index:s.length+1;n.data.index=e.calculateNewIndex(g,h),console.log(g,h,n.data.index);const{status:x}=yield n.record.update({data:n.data});console.log("Status:",x),n.loading=!1}else{(0,p.eg)(u,s,o.previousIndex,o.currentIndex),n.data.parentId=i.id;const g=o.currentIndex>0?s[o.currentIndex-1].data.index:0,h=o.currentIndex<s.length-1?s[o.currentIndex+1].data.index:s.length+1;n.data.index=e.calculateNewIndex(g,h),console.log(g,h,n.data.index);const{record:x,status:w}=yield e.identity.web5.dwn.records.create({data:n.data,message:{protocol:c.Q.protocol,protocolPath:"list/todo",schema:c.Q.types.todo.schema,dataFormat:c.Q.types.todo.dataFormats[0],parentContextId:n.data.parentId}});console.log("Create status:",w),yield n.record.delete(),n.record=x,n.id=x?.id,n.loading=!1}})()}static#t=this.\u0275fac=function(e){return new(e||a)};static#o=this.\u0275cmp=t.VBU({type:a,selectors:[["app-todo"]],standalone:!0,features:[t.aNF],decls:11,vars:0,consts:[["menuListActions","matMenu"],["menuActions","matMenu"],["mat-flat-button","",3,"click"],["cdkDropListGroup",""],[1,"container"],[1,"list-header"],["mat-icon-button",""],["mat-icon-button","","matTooltip","Add new todo",3,"click"],["mat-icon-button","",3,"matMenuTriggerFor"],["diameter","20"],["mat-menu-item","",3,"disabled"],["mat-menu-item","",3,"click"],["cdkDropList","",1,"list",3,"cdkDropListDropped","cdkDropListData"],["subscriptSizing","dynamic"],["matInput","",3,"ngModelChange","keydown.enter","ngModel"],["mat-icon-button","",3,"click"],["cdkDrag","",1,"list-item",3,"cdkDragData"],[3,"ngClass"],[1,"spacer"],["color","primary",3,"ngModel"],["color","primary",3,"ngModelChange","ngModel"]],template:function(e,n){1&e&&(t.j41(0,"div")(1,"button",2),t.bIt("click",function(){return n.newList()}),t.j41(2,"mat-icon"),t.EFF(3,"add"),t.k0s(),t.EFF(4," New list"),t.k0s(),t.nrm(5,"br"),t.j41(6,"div",3),t.Z7z(7,K,27,5,"div",4,t.fX1),t.k0s(),t.nrm(9,"br")(10,"br"),t.k0s()),2&e&&(t.R7$(7),t.Dyx(n.list))},dependencies:[b.RG,b.rl,m.X1,m.me,m.BC,y.fS,y.fg,m.YN,m.vS,D.g7,D.So,p.T1,p.O7,p.RK,f.MD,f.YU,k.Hl,k.$z,k.iY,E.iI,v.RI,F.m_,F.An,C.Cn,C.kk,C.fb,C.Cp,M.w,M.q,I.D6,I.LG],styles:[".container[_ngcontent-%COMP%]{width:400px;max-width:100%;margin-right:1em;display:inline-block;vertical-align:top}.list[_ngcontent-%COMP%]{border:solid 1px #ccc;min-height:60px;border-radius:4px;display:block;overflow:hidden}.list-item[_ngcontent-%COMP%]{padding:20px 10px;border-bottom:solid 1px #ccc;box-sizing:border-box;cursor:move;background-color:#00000080;font-size:14px;display:flex;align-items:center}.list-header[_ngcontent-%COMP%]{display:flex;align-items:center}.strikeout[_ngcontent-%COMP%]{text-decoration:line-through}.list-item[_ngcontent-%COMP%]:last-child{border:none}.cdk-drag-preview[_ngcontent-%COMP%]{border-radius:4px;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .cdk-drag[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .3s cubic-bezier(0,0,.2,1)}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.todo-list[_ngcontent-%COMP%]{margin-bottom:1em;border:1px solid silver;padding:1em;box-sizing:border-box;cursor:pointer}.todo-list[_ngcontent-%COMP%]:hover{border:1px solid gray}"]})}return a})()}}]);