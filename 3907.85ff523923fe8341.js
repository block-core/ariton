"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3907],{93907:(q,v,s)=>{s.r(v),s.d(v,{TasksComponent:()=>Z});var d=s(10467),C=s(81391),t=s(93953),X=s(36815),p=s(52002),M=s(31439),R=s(34635),$=s(62590),y=s(60177),f=s(88834),T=s(18498),E=s(96850),k=s(99213),I=s(82765),l=s(89417),b=s(59115),D=s(71997),j=s(53719),x=s(99631),G=s(9183),N=s(25596),_=s(75351),L=s(14823);function A(a,c){if(1&a){const o=t.RV6();t.j41(0,"div",3)(1,"mat-form-field",8),t.nrm(2,"input",9),t.k0s(),t.j41(3,"button",10),t.bIt("click",function(){const n=t.eBV(o).$index,i=t.XpG();return t.Njj(i.removeLink(n))}),t.j41(4,"mat-icon"),t.EFF(5,"clear"),t.k0s()()()}if(2&a){const o=c.$index;t.R7$(2),t.Y8G("formControlName",o)}}let P=(()=>{class a{constructor(o,e){this.dialogRef=o,this.data=e,this.fb=(0,t.WQX)(l.ok),this.form=this.fb.group({collaborators:this.fb.array([])}),e.collaborators.map(n=>{this.form.controls.collaborators.push(this.fb.control(n))})}ngAfterViewInit(){}get collaborators(){return this.form.get("collaborators")}addLink(){this.collaborators.push(this.fb.control(""))}removeLink(o){this.collaborators.removeAt(o)}onSubmit(){var o=this;return(0,d.A)(function*(){const e=o.form.value.collaborators.filter(n=>n);o.data.collaborators=e})()}static#t=this.\u0275fac=function(e){return new(e||a)(t.rXU(_.CP),t.rXU(_.Vh))};static#o=this.\u0275cmp=t.VBU({type:a,selectors:[["app-collaborator-dialog"]],standalone:!0,features:[t.aNF],decls:16,vars:3,consts:[["novalidate","",3,"ngSubmit","formGroup"],["mat-dialog-title",""],["formArrayName","collaborators"],[1,"link-input"],["mat-stroked-button","","type","button",3,"click"],["align","end"],["mat-button","","mat-dialog-close",""],["mat-flat-button","","type","submit","cdkFocusInitial","",3,"mat-dialog-close"],[1,"full-width"],["matInput","","type","text","placeholder","Enter DID",3,"formControlName"],["mat-icon-button","","type","button",3,"click"]],template:function(e,n){1&e&&(t.j41(0,"form",0),t.bIt("ngSubmit",function(){return n.onSubmit()}),t.j41(1,"h2",1),t.EFF(2),t.k0s(),t.j41(3,"mat-dialog-content")(4,"div",2),t.Z7z(5,A,6,1,"div",3,t.fX1),t.k0s(),t.j41(7,"button",4),t.bIt("click",function(){return n.addLink()}),t.j41(8,"mat-icon"),t.EFF(9,"person_add_alt"),t.k0s(),t.EFF(10," Add Collaborator "),t.k0s()(),t.j41(11,"mat-dialog-actions",5)(12,"button",6),t.EFF(13,"Cancel"),t.k0s(),t.j41(14,"button",7),t.EFF(15,"Save"),t.k0s()()()),2&e&&(t.Y8G("formGroup",n.form),t.R7$(2),t.SpI(" ",n.data.title," "),t.R7$(3),t.Dyx(n.collaborators.controls),t.R7$(9),t.Y8G("mat-dialog-close",!0))},dependencies:[y.MD,L.uc,b.Cn,k.m_,k.An,f.Hl,f.$z,f.iY,x.fS,x.fg,j.rl,_.hM,_.tx,_.BI,_.E7,_.Yi,l.YN,l.qT,l.me,l.BC,l.cb,N.Hu,l.X1,l.j4,l.JD,l.v8],styles:[".full-width[_ngcontent-%COMP%]{width:100%}.link-input[_ngcontent-%COMP%]{display:flex;align-items:baseline}.link-input[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:.4em}mat-card-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:1em}"]})}return a})();const V=a=>["/app","tasks",a],O=a=>({strikeout:a});function S(a,c){if(1&a){const o=t.RV6();t.j41(0,"mat-form-field",11)(1,"input",12),t.mxI("ngModelChange",function(n){t.eBV(o);const i=t.XpG(2).$implicit;return t.DH7(i.data.title,n)||(i.data.title=n),t.Njj(n)}),t.bIt("keydown.enter",function(){t.eBV(o);const n=t.XpG(2).$implicit,i=t.XpG();return t.Njj(i.saveList(n))}),t.k0s()(),t.j41(2,"button",13),t.bIt("click",function(){t.eBV(o);const n=t.XpG(2).$implicit,i=t.XpG();return t.Njj(i.saveList(n))}),t.j41(3,"mat-icon"),t.EFF(4,"save"),t.k0s()()}if(2&a){const o=t.XpG(2).$implicit;t.R7$(),t.R50("ngModel",o.data.title)}}function B(a,c){if(1&a){const o=t.RV6();t.j41(0,"a",14),t.EFF(1),t.k0s(),t.j41(2,"button",13),t.bIt("click",function(){t.eBV(o);const n=t.XpG(2).$implicit,i=t.XpG();return t.Njj(i.editList(n))}),t.j41(3,"mat-icon"),t.EFF(4,"edit"),t.k0s()()}if(2&a){const o=t.XpG(2).$implicit;t.Y8G("routerLink",t.eq3(2,V,o.id)),t.R7$(),t.JRh(o.data.title)}}function Q(a,c){1&a&&t.nrm(0,"mat-spinner",8)}function w(a,c){if(1&a){const o=t.RV6();t.j41(0,"mat-form-field",11)(1,"input",12),t.mxI("ngModelChange",function(n){t.eBV(o);const i=t.XpG().$implicit;return t.DH7(i.data.description,n)||(i.data.description=n),t.Njj(n)}),t.bIt("keydown.enter",function(){t.eBV(o);const n=t.XpG().$implicit,i=t.XpG(2).$implicit,r=t.XpG();return t.Njj(r.saveTodo(n,i))}),t.k0s()(),t.j41(2,"button",13),t.bIt("click",function(){t.eBV(o);const n=t.XpG().$implicit,i=t.XpG(2).$implicit,r=t.XpG();return t.Njj(r.saveTodo(n,i))}),t.j41(3,"mat-icon"),t.EFF(4,"save"),t.k0s()()}if(2&a){const o=t.XpG().$implicit;t.R7$(),t.R50("ngModel",o.data.description)}}function Y(a,c){if(1&a&&(t.j41(0,"span",16),t.EFF(1),t.k0s()),2&a){const o=t.XpG().$implicit;t.Y8G("ngClass",t.eq3(2,O,o.data.completed)),t.R7$(),t.JRh(o.data.description)}}function z(a,c){1&a&&t.nrm(0,"mat-spinner",8)}function W(a,c){if(1&a){const o=t.RV6();t.j41(0,"mat-checkbox",19),t.mxI("ngModelChange",function(n){t.eBV(o);const i=t.XpG().$implicit;return t.DH7(i.data.completed,n)||(i.data.completed=n),t.Njj(n)}),t.bIt("change",function(){t.eBV(o);const n=t.XpG().$implicit,i=t.XpG(2).$implicit,r=t.XpG();return t.Njj(r.saveTodo(n,i))}),t.k0s()}if(2&a){const o=t.XpG().$implicit;t.R50("ngModel",o.data.completed)}}function U(a,c){if(1&a){const o=t.RV6();t.j41(0,"div",15),t.DNE(1,w,5,1)(2,Y,2,4,"span",16),t.nrm(3,"div",17),t.DNE(4,z,1,0,"mat-spinner",8)(5,W,1,1,"mat-checkbox",18),t.j41(6,"button",7)(7,"mat-icon"),t.EFF(8,"more_vert"),t.k0s()()(),t.j41(9,"mat-menu",null,1)(11,"button",9),t.bIt("click",function(){const n=t.eBV(o).$implicit,i=t.XpG(3);return t.Njj(i.editTodo(n))}),t.j41(12,"mat-icon"),t.EFF(13,"edit"),t.k0s(),t.j41(14,"span"),t.EFF(15,"Edit"),t.k0s()(),t.nrm(16,"mat-divider"),t.j41(17,"button",9),t.bIt("click",function(){const n=t.eBV(o).$implicit,i=t.XpG(2).$implicit,r=t.XpG();return t.Njj(r.deleteTodo(n.record,i))}),t.j41(18,"mat-icon"),t.EFF(19,"delete"),t.k0s(),t.j41(20,"span"),t.EFF(21,"Delete"),t.k0s()()()}if(2&a){const o=c.$implicit,e=t.sdS(10);t.Y8G("cdkDragData",o),t.R7$(),t.vxM(o.editing?1:2),t.R7$(3),t.vxM(o.loading?4:5),t.R7$(2),t.Y8G("matMenuTriggerFor",e)}}function H(a,c){if(1&a){const o=t.RV6();t.j41(0,"div",4)(1,"h2",5),t.DNE(2,S,5,1)(3,B,5,4),t.j41(4,"button",6),t.bIt("click",function(){t.eBV(o);const n=t.XpG().$implicit,i=t.XpG();return t.Njj(i.addTodo(n))}),t.j41(5,"mat-icon"),t.EFF(6,"add_box"),t.k0s()(),t.j41(7,"button",7)(8,"mat-icon"),t.EFF(9,"more_vert"),t.k0s()(),t.DNE(10,Q,1,0,"mat-spinner",8),t.j41(11,"mat-menu",null,0)(13,"button",9),t.bIt("click",function(){t.eBV(o);const n=t.XpG().$implicit,i=t.XpG();return t.Njj(i.collaboratorDialog(n))}),t.j41(14,"mat-icon"),t.EFF(15,"person_add_alt"),t.k0s(),t.j41(16,"span"),t.EFF(17,"Collaborators"),t.k0s()(),t.nrm(18,"mat-divider"),t.j41(19,"button",9),t.bIt("click",function(){t.eBV(o);const n=t.XpG().$implicit,i=t.XpG();return t.Njj(i.deleteList(n))}),t.j41(20,"mat-icon"),t.EFF(21,"delete"),t.k0s(),t.j41(22,"span"),t.EFF(23,"Delete"),t.k0s()()()(),t.j41(24,"div",10),t.bIt("cdkDropListDropped",function(n){t.eBV(o);const i=t.XpG(2);return t.Njj(i.drop(n))}),t.Z7z(25,U,22,4,null,null,t.fX1),t.k0s()()}if(2&a){const o=t.sdS(12),e=t.XpG().$implicit;t.R7$(2),t.vxM(e.editing?2:3),t.R7$(5),t.Y8G("matMenuTriggerFor",o),t.R7$(3),t.vxM(e.loading?10:-1),t.R7$(14),t.Y8G("cdkDropListData",e),t.R7$(),t.Dyx(e.todos)}}function J(a,c){if(1&a&&t.DNE(0,H,27,4,"div",4),2&a){const o=c.$implicit,e=t.XpG();t.vxM(e.selectedList()&&e.selectedList()!==o.id?-1:0)}}let Z=(()=>{class a{constructor(){var o=this;this.list=[],this.layout=(0,t.WQX)(X.Y),this.app=(0,t.WQX)(M.d),this.identity=(0,t.WQX)(R.K),this.route=(0,t.WQX)(T.nX),this.changeRef=(0,t.WQX)(t.gRc),this.dialog=(0,t.WQX)(_.bZ),this.selectedList=(0,t.vPA)(null),this.selectedRecord=(0,t.vPA)(null),(0,t.QZP)((0,d.A)(function*(){o.app.initialized()&&(yield o.load())}),{allowSignalWrites:!0}),this.route.paramMap.subscribe(e=>{this.layout.marginOn(),this.layout.resetActions();const n=e.get("id");this.selectedList.set(n&&":id"!=n?e.get("id"):null)})}getList(o){var e=this;return(0,d.A)(function*(){const{records:n}=yield e.identity.web5.dwn.records.query({message:{filter:{parentId:o}}});let i=[];for(let r of n){const m=yield e.getTodoEntryFromRecord(r);i.push(m)}return i=i.sort((r,m)=>r.data.index-m.data.index),i})()}getTodoEntryFromRecord(o){return(0,d.A)(function*(){const e=yield o.data.json();return{record:o,data:e,id:o.id}})()}load(){var o=this;return(0,d.A)(function*(){o.list=[];const{records:e}=yield o.identity.web5.dwn.records.query({message:{filter:{protocol:p.Q.protocol,schema:p.Q.types.list.schema},dateSort:$.U0.CreatedAscending}});for(let n of e){const i=yield n.data.json();let r={record:n,data:i,id:n.id};r.todos=yield o.getList(r.id),o.list.push(r)}})()}collaboratorDialog(o){var e=this;let n={title:o.data.title,id:o.id,collaborators:o.data.collaborators};null==n.collaborators&&(n.collaborators=[]);const i=JSON.parse(JSON.stringify(n)),r=this.dialog.open(P,{data:n});return r.afterClosed().subscribe(function(){var m=(0,d.A)(function*(u){if(u){o.data.collaborators=n.collaborators;const{status:g}=yield o.record.update({data:o.data});console.log("Save status for collaborators:",g),yield e.sendToCollaborators(o.record,o.data.collaborators)}else n=i});return function(u){return m.apply(this,arguments)}}()),r.afterClosed()}sendToCollaborators(o,e){return(0,d.A)(function*(){for(let n of e){const{status:i}=yield o.send(n);console.log("Send status to collaborator:",i)}})()}editList(o){o.editing=!0}saveList(o){var e=this;return(0,d.A)(function*(){o.editing=!1;const{status:n}=yield o.record.update({data:o.data});console.log("Update status:",n),e.sendToCollaborators(o.record,o.data.collaborators)})()}editTodo(o){o.editing=!0}saveTodo(o,e){var n=this;return(0,d.A)(function*(){o.editing=!1;const{status:i}=yield o.record.update({data:o.data});console.log("Update status:",i),n.sendToCollaborators(o.record,e.data.collaborators)})()}deleteList(o){var e=this;return(0,d.A)(function*(){yield o.record.delete({prune:!0}),e.list=e.list.filter(n=>n.id!==o.id)})()}deleteTodo(o,e){var n=this;return(0,d.A)(function*(){yield o.delete(),e.todos=e.todos.filter(i=>i.id!==o.id),n.sendToCollaborators(o,e.data.collaborators)})()}initializeIndices(o){o.forEach((e,n)=>{e.index=n+1})}calculateNewIndex(o,e){return(o+e)/2}addTodo(o){var e=this;return(0,d.A)(function*(){o.todos||(o.todos=[]);const n={completed:!1,description:"New todo...",author:e.identity.did,parentId:o.id,index:o.todos.length+1},{record:i}=yield e.identity.web5.dwn.records.create({data:n,message:{protocol:p.Q.protocol,protocolPath:"list/todo",schema:p.Q.types.todo.schema,dataFormat:p.Q.types.todo.dataFormats[0],parentContextId:n.parentId}}),u=(yield i.data.json(),yield e.getTodoEntryFromRecord(i));o.todos.push(u),console.log(o),e.changeRef.markForCheck()})()}newList(){var o=this;return(0,d.A)(function*(){const e="did:dht:bi3bzoke6rq6fbkojpo5ebtg45eqx1owqrb4esex8t9nz14ugnao",n={type:"list",title:"New list",description:"What to do?",author:o.identity.did,recipient:e},{record:i}=yield o.identity.web5.dwn.records.create({data:n,message:{protocol:p.Q.protocol,protocolPath:"list",schema:p.Q.types.list.schema,dataFormat:p.Q.types.list.dataFormats[0],recipient:e}}),r=yield i.data.json();o.list.push({record:i,data:r,id:i.id});const{status:u}=yield i.send(e);console.log("Send status:",u)})()}drop(o){var e=this;return(0,d.A)(function*(){console.log("DROP:",o);const n=o.item.data;n.loading=!0;const i=o.container.data,r=i.todos,u=o.previousContainer.data.todos;if(o.previousContainer===o.container){(0,C.HD)(r,o.previousIndex,o.currentIndex);const g=o.currentIndex>0?r[o.currentIndex-1].data.index:0,h=o.currentIndex<r.length-1?r[o.currentIndex+1].data.index:r.length+1;n.data.index=e.calculateNewIndex(g,h),console.log(g,h,n.data.index);const{status:F}=yield n.record.update({data:n.data});console.log("Status:",F),n.loading=!1}else{(0,C.eg)(u,r,o.previousIndex,o.currentIndex),n.data.parentId=i.id;const g=o.currentIndex>0?r[o.currentIndex-1].data.index:0,h=o.currentIndex<r.length-1?r[o.currentIndex+1].data.index:r.length+1;n.data.index=e.calculateNewIndex(g,h),console.log(g,h,n.data.index);const{record:F,status:K}=yield e.identity.web5.dwn.records.create({data:n.data,message:{protocol:p.Q.protocol,protocolPath:"list/todo",schema:p.Q.types.todo.schema,dataFormat:p.Q.types.todo.dataFormats[0],parentContextId:n.data.parentId}});console.log("Create status:",K),yield n.record.delete(),n.record=F,n.id=F?.id,n.loading=!1}})()}static#t=this.\u0275fac=function(e){return new(e||a)};static#o=this.\u0275cmp=t.VBU({type:a,selectors:[["app-todo"]],standalone:!0,features:[t.aNF],decls:11,vars:0,consts:[["menuListActions","matMenu"],["menuActions","matMenu"],["mat-flat-button","",3,"click"],["cdkDropListGroup",""],[1,"container"],[1,"list-header"],["mat-icon-button","","matTooltip","Add new todo",3,"click"],["mat-icon-button","",3,"matMenuTriggerFor"],["diameter","20"],["mat-menu-item","",3,"click"],["cdkDropList","",1,"list",3,"cdkDropListDropped","cdkDropListData"],["subscriptSizing","dynamic"],["matInput","",3,"ngModelChange","keydown.enter","ngModel"],["mat-icon-button","",3,"click"],[1,"list-selection",3,"routerLink"],["cdkDrag","",1,"list-item",3,"cdkDragData"],[3,"ngClass"],[1,"spacer"],["color","primary",3,"ngModel"],["color","primary",3,"ngModelChange","change","ngModel"]],template:function(e,n){1&e&&(t.j41(0,"div")(1,"button",2),t.bIt("click",function(){return n.newList()}),t.j41(2,"mat-icon"),t.EFF(3,"add"),t.k0s(),t.EFF(4," New list"),t.k0s(),t.nrm(5,"br"),t.j41(6,"div",3),t.Z7z(7,J,1,1,null,null,t.fX1),t.k0s(),t.nrm(9,"br")(10,"br"),t.k0s()),2&e&&(t.R7$(7),t.Dyx(n.list))},dependencies:[j.RG,j.rl,l.X1,l.me,l.BC,x.fS,x.fg,l.YN,l.vS,I.g7,I.So,C.T1,C.O7,C.RK,y.MD,y.YU,f.Hl,f.$z,f.iY,T.iI,T.Wk,E.RI,k.m_,k.An,b.Cn,b.kk,b.fb,b.Cp,D.w,D.q,G.D6,G.LG],styles:[".container[_ngcontent-%COMP%]{width:400px;max-width:100%;margin-right:1em;display:inline-block;vertical-align:top}.list[_ngcontent-%COMP%]{border:solid 1px #ccc;min-height:60px;border-radius:4px;display:block;overflow:hidden}.list-item[_ngcontent-%COMP%]{padding:20px 10px;border-bottom:solid 1px #ccc;box-sizing:border-box;cursor:move;background-color:#00000080;font-size:14px;display:flex;align-items:center}.list-header[_ngcontent-%COMP%]{display:flex;align-items:center}.list-selection[_ngcontent-%COMP%]{text-decoration:none;padding-right:.2em}.list-selection[_ngcontent-%COMP%]:hover{text-decoration:underline}.strikeout[_ngcontent-%COMP%]{text-decoration:line-through}.list-item[_ngcontent-%COMP%]:last-child{border:none}.cdk-drag-preview[_ngcontent-%COMP%]{border-radius:4px;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .cdk-drag[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .3s cubic-bezier(0,0,.2,1)}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.todo-list[_ngcontent-%COMP%]{margin-bottom:1em;border:1px solid silver;padding:1em;box-sizing:border-box;cursor:pointer}.todo-list[_ngcontent-%COMP%]:hover{border:1px solid gray}"]})}return a})()}}]);